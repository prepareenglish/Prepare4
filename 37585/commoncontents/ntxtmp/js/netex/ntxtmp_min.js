/*! whenlive 2014-02-13 */
!function(d,c){"function"==typeof define&&define.amd?define(["jquery"],c):c(jQuery)}(this,function(b){!function(a){var h=window.MutationObserver||window.WebKitMutationObserver,g=function(d,e){return a(d).data("whenlive_processed")?!1:a(d).is(":visible")?(e(d),a(d).data("whenlive_processed",!0),!0):!1},f=function(d){d||(d=document.documentElement);for(var e in a.whenLiveElements){a.whenLiveElements[e].selector?a(a.whenLiveElements[e].selector,d).each(function(c,i){g(i,a.whenLiveElements[e].fn)}):(a.contains(d,a.whenLiveElements[e].elem[0])||d===a.whenLiveElements[e].elem[0])&&(a.whenLiveElements[e].options.visibility?a.whenLiveElements[e].elem.is(":visible")&&(a.whenLiveElements[e].fn.call(a.whenLiveElements[e].elem),a.whenLiveElements.splice(e,1)):(a.whenLiveElements[e].fn.call(a.whenLiveElements[e].elem),a.whenLiveElements.splice(e,1)))}};a.fn.whenLive=function(j,e){var d=this;if("function"==typeof j?(e=j,j={}):"object"!=typeof j&&(j={}),"boolean"!=typeof j.visibility&&(j.visibility=!0),"function"==typeof e){if(a.whenLiveElements||(a.whenLiveElements=[]),!a.whenLiveInit){if(a.whenLiveInit=!0,h){var c=new h(function(i){for(var n=0;n<i.length;n++){var m=i[n];if(f(m.target),a.whenLiveElements.length&&null!=m.addedNodes){for(var l=0;l<m.addedNodes.length;l++){var k=m.addedNodes[l];f(k)}}}});c.observe(document,{childList:!0,subtree:!0,attributes:!0})}else{!function(){for(var k=0,i=["webkit","moz"],l=0;l<i.length&&!window.requestAnimationFrame;++l){window.requestAnimationFrame=window[i[l]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[l]+"CancelAnimationFrame"]||window[i[l]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(m){var p=(new Date).getTime(),o=Math.max(0,16-(p-k)),n=window.setTimeout(function(){m(p+o)},o);return k=p+o,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(m){clearTimeout(m)})}(),a.whenLiveLoop=function(){f(),a.whenLiveElements.length>0&&requestAnimationFrame(a.whenLiveLoop)}}}this.selector?(a(this.selector).filter(":visible").each(function(k,i){g(i,e)}),a.whenLiveElements.push({elem:null,selector:this.selector,fn:e,options:j}),h||1===a.whenLiveElements.length&&requestAnimationFrame(a.whenLiveLoop)):b.contains(document.documentElement,this[0])?j.visibility?a(this).is(":visible")?e():(a.whenLiveElements.push({elem:d,selector:null,fn:e,options:j}),h||1===a.whenLiveElements.length&&requestAnimationFrame(a.whenLiveLoop)):e():(a.whenLiveElements.push({elem:d,selector:null,fn:e,options:j}),h||1===a.whenLiveElements.length&&requestAnimationFrame(a.whenLiveLoop))}}}(b)});
/*! jQuery UI - v1.11.2 - 2015-01-08
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, draggable.js, resizable.js, effect.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */
(function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(h){function d(i,l){var e,q,p,m=i.nodeName.toLowerCase();return"area"===m?(e=i.parentNode,q=e.name,i.href&&q&&"map"===e.nodeName.toLowerCase()?(p=h("img[usemap='#"+q+"']")[0],!!p&&c(p)):!1):(/input|select|textarea|button|object/.test(m)?!i.disabled:"a"===m?i.href||l:l)&&c(i)}function c(a){return h.expr.filters.visible(a)&&!h(a).parents().addBack().filter(function(){return"hidden"===h.css(this,"visibility")}).length}h.ui=h.ui||{},h.extend(h.ui,{version:"1.11.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),h.fn.extend({scrollParent:function(m){var l=this.css("position"),o="absolute"===l,e=m?/(auto|scroll|hidden)/:/(auto|scroll)/,p=this.parents().filter(function(){var a=h(this);return o&&"static"===a.css("position")?!1:e.test(a.css("overflow")+a.css("overflow-y")+a.css("overflow-x"))}).eq(0);return"fixed"!==l&&p.length?p:h(this[0].ownerDocument||document)},uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&h(this).removeAttr("id")})}}),h.extend(h.expr[":"],{data:h.expr.createPseudo?h.expr.createPseudo(function(a){return function(e){return !!h.data(e,a)}}):function(e,a,l){return !!h.data(e,l[3])},focusable:function(a){return d(a,!isNaN(h.attr(a,"tabindex")))},tabbable:function(l){var m=h.attr(l,"tabindex"),e=isNaN(m);return(e||m>=0)&&d(l,!e)}}),h("<a>").outerWidth(1).jquery||h.each(["Width","Height"],function(m,l){function p(o,a,u,v){return h.each(e,function(){a-=parseFloat(h.css(o,"padding"+this))||0,u&&(a-=parseFloat(h.css(o,"border"+this+"Width"))||0),v&&(a-=parseFloat(h.css(o,"margin"+this))||0)}),a}var e="Width"===l?["Left","Right"]:["Top","Bottom"],r=l.toLowerCase(),q={innerWidth:h.fn.innerWidth,innerHeight:h.fn.innerHeight,outerWidth:h.fn.outerWidth,outerHeight:h.fn.outerHeight};h.fn["inner"+l]=function(a){return void 0===a?q["inner"+l].call(this):this.each(function(){h(this).css(r,p(this,a)+"px")})},h.fn["outer"+l]=function(n,i){return"number"!=typeof n?q["outer"+l].call(this,n):this.each(function(){h(this).css(r,p(this,n,!0,i)+"px")})}}),h.fn.addBack||(h.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),h("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(h.fn.removeData=function(a){return function(e){return arguments.length?a.call(this,h.camelCase(e)):a.call(this)}}(h.fn.removeData)),h.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),h.fn.extend({focus:function(a){return function(e,l){return"number"==typeof e?this.each(function(){var i=this;setTimeout(function(){h(i).focus(),l&&l.call(i)},e)}):a.apply(this,arguments)}}(h.fn.focus),disableSelection:function(){var a="onselectstart" in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(a+".ui-disableSelection",function(i){i.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(m){if(void 0!==m){return this.css("zIndex",m)}if(this.length){for(var l,n,e=h(this[0]);e.length&&e[0]!==document;){if(l=e.css("position"),("absolute"===l||"relative"===l||"fixed"===l)&&(n=parseInt(e.css("zIndex"),10),!isNaN(n)&&0!==n)){return n}e=e.parent()}}return 0}}),h.ui.plugin={add:function(m,l,o){var e,p=h.ui[m].prototype;for(e in o){p.plugins[e]=p.plugins[e]||[],p.plugins[e].push([l,o[e]])}},call:function(q,o,m,p){var l,r=q.plugins[o];if(r&&(p||q.element[0].parentNode&&11!==q.element[0].parentNode.nodeType)){for(l=0;r.length>l;l++){q.options[r[l][0]]&&r[l][1].apply(q.element,m)}}}};var f=0,b=Array.prototype.slice;h.cleanData=function(a){return function(l){var m,e,q;for(q=0;null!=(e=l[q]);q++){try{m=h._data(e,"events"),m&&m.remove&&h(e).triggerHandler("remove")}catch(p){}}a(l)}}(h.cleanData),h.widget=function(x,u,y){var w,p,m,e,v={},q=x.split(".")[0];return x=x.split(".")[1],w=q+"-"+x,y||(y=u,u=h.Widget),h.expr[":"][w.toLowerCase()]=function(a){return !!h.data(a,w)},h[q]=h[q]||{},p=h[q][x],m=h[q][x]=function(i,a){return this._createWidget?(arguments.length&&this._createWidget(i,a),void 0):new m(i,a)},h.extend(m,p,{version:y.version,_proto:h.extend({},y),_childConstructors:[]}),e=new u,e.options=h.widget.extend({},e.options),h.each(y,function(a,i){return h.isFunction(i)?(v[a]=function(){var n=function(){return u.prototype[a].apply(this,arguments)},l=function(o){return u.prototype[a].apply(this,o)};return function(){var r,o=this._super,s=this._superApply;return this._super=n,this._superApply=l,r=i.apply(this,arguments),this._super=o,this._superApply=s,r}}(),void 0):(v[a]=i,void 0)}),m.prototype=h.widget.extend(e,{widgetEventPrefix:p?e.widgetEventPrefix||x:x},v,{constructor:m,namespace:q,widgetName:x,widgetFullName:w}),p?(h.each(p._childConstructors,function(l,a){var n=a.prototype;h.widget(n.namespace+"."+n.widgetName,m,a._proto)}),delete p._childConstructors):u._childConstructors.push(m),h.widget.bridge(x,m),m},h.widget.extend=function(e){for(var a,l,q=b.call(arguments,1),p=0,m=q.length;m>p;p++){for(a in q[p]){l=q[p][a],q[p].hasOwnProperty(a)&&void 0!==l&&(e[a]=h.isPlainObject(l)?h.isPlainObject(e[a])?h.widget.extend({},e[a],l):h.widget.extend({},l):l)}}return e},h.widget.bridge=function(e,a){var l=a.prototype.widgetFullName||e;h.fn[e]=function(q){var p="string"==typeof q,m=b.call(arguments,1),i=this;return q=!p&&m.length?h.widget.extend.apply(null,[q].concat(m)):q,p?this.each(function(){var o,n=h.data(this,l);return"instance"===q?(i=n,!1):n?h.isFunction(n[q])&&"_"!==q.charAt(0)?(o=n[q].apply(n,m),o!==n&&void 0!==o?(i=o&&o.jquery?i.pushStack(o.get()):o,!1):void 0):h.error("no such method '"+q+"' for "+e+" widget instance"):h.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+q+"'")}):this.each(function(){var n=h.data(this,l);n?(n.option(q||{}),n._init&&n._init()):h.data(this,l,new a(q,this))}),i}},h.Widget=function(){},h.Widget._childConstructors=[],h.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,a){a=h(a||this.defaultElement||this)[0],this.element=h(a),this.uuid=f++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=h(),this.hoverable=h(),this.focusable=h(),a!==this&&(h.data(a,this.widgetFullName,this),this._on(!0,this.element,{remove:function(i){i.target===a&&this.destroy()}}),this.document=h(a.style?a.ownerDocument:a.document||a),this.window=h(this.document[0].defaultView||this.document[0].parentWindow)),this.options=h.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:h.noop,_getCreateEventData:h.noop,_create:h.noop,_init:h.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(h.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:h.noop,widget:function(){return this.element},option:function(m,l){var p,e,r,q=m;if(0===arguments.length){return h.widget.extend({},this.options)}if("string"==typeof m){if(q={},p=m.split("."),m=p.shift(),p.length){for(e=q[m]=h.widget.extend({},this.options[m]),r=0;p.length-1>r;r++){e[p[r]]=e[p[r]]||{},e=e[p[r]]}if(m=p.pop(),1===arguments.length){return void 0===e[m]?null:e[m]}e[m]=l}else{if(1===arguments.length){return void 0===this.options[m]?null:this.options[m]}q[m]=l}}return this._setOptions(q),this},_setOptions:function(i){var a;for(a in i){this._setOption(a,i[a])}return this},_setOption:function(i,a){return this.options[i]=a,"disabled"===i&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!a),a&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(m,l,o){var e,p=this;"boolean"!=typeof m&&(o=l,l=m,m=!1),o?(l=e=h(l),this.bindings=this.bindings.add(l)):(o=l,l=this.element,e=this.widget()),h.each(o,function(q,v){function t(){return m||p.options.disabled!==!0&&!h(this).hasClass("ui-state-disabled")?("string"==typeof v?p[v]:v).apply(p,arguments):void 0}"string"!=typeof v&&(t.guid=v.guid=v.guid||t.guid||h.guid++);var n=q.match(/^([\w:-]*)\s*(.*)$/),a=n[1]+p.eventNamespace,i=n[2];i?e.delegate(i,a,t):l.bind(a,t)})},_off:function(e,a){a=(a||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(a).undelegate(a),this.bindings=h(this.bindings.not(e).get()),this.focusable=h(this.focusable.not(e).get()),this.hoverable=h(this.hoverable.not(e).get())},_delay:function(n,l){function a(){return("string"==typeof n?m[n]:n).apply(m,arguments)}var m=this;return setTimeout(a,l||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a),this._on(a,{mouseenter:function(e){h(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){h(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a),this._on(a,{focusin:function(e){h(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){h(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(m,l,p){var e,r,q=this.options[m];if(p=p||{},l=h.Event(l),l.type=(m===this.widgetEventPrefix?m:this.widgetEventPrefix+m).toLowerCase(),l.target=this.element[0],r=l.originalEvent){for(e in r){e in l||(l[e]=r[e])}}return this.element.trigger(l,p),!(h.isFunction(q)&&q.apply(this.element[0],[l].concat(p))===!1||l.isDefaultPrevented())}},h.each({show:"fadeIn",hide:"fadeOut"},function(e,a){h.Widget.prototype["_"+e]=function(l,i,q){"string"==typeof i&&(i={effect:i});var p,m=i?i===!0||"number"==typeof i?a:i.effect||a:e;i=i||{},"number"==typeof i&&(i={duration:i}),p=!h.isEmptyObject(i),i.complete=q,i.delay&&l.delay(i.delay),p&&h.effects&&h.effects.effect[m]?l[e](i):m!==e&&l[m]?l[m](i.duration,i.easing,q):l.queue(function(n){h(this)[e](),q&&q.call(l[0]),n()})}}),h.widget;var k=!1;h(document).mouseup(function(){k=!1}),h.widget("ui.mouse",{version:"1.11.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.bind("mousedown."+this.widgetName,function(i){return a._mouseDown(i)}).bind("click."+this.widgetName,function(e){return !0===h.data(e.target,a.widgetName+".preventClickEvent")?(h.removeData(e.target,a.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(m){if(!k){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(m),this._mouseDownEvent=m;var l=this,n=1===m.which,e="string"==typeof this.options.cancel&&m.target.nodeName?h(m.target).closest(this.options.cancel).length:!1;return n&&!e&&this._mouseCapture(m)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){l.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(m)&&this._mouseDelayMet(m)&&(this._mouseStarted=this._mouseStart(m)!==!1,!this._mouseStarted)?(m.preventDefault(),!0):(!0===h.data(m.target,this.widgetName+".preventClickEvent")&&h.removeData(m.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return l._mouseMove(a)},this._mouseUpDelegate=function(a){return l._mouseUp(a)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),m.preventDefault(),k=!0,!0)):!0}},_mouseMove:function(a){if(this._mouseMoved){if(h.ui.ie&&(!document.documentMode||9>document.documentMode)&&!a.button){return this._mouseUp(a)}if(!a.which){return this._mouseUp(a)}}return(a.which||a.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(a),a.preventDefault()):(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,a)!==!1,this._mouseStarted?this._mouseDrag(a):this._mouseUp(a)),!this._mouseStarted)},_mouseUp:function(a){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,a.target===this._mouseDownEvent.target&&h.data(a.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(a)),k=!1,!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return !0}}),h.widget("ui.draggable",h.ui.mouse,{version:"1.11.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(i,a){this._super(i,a),"handle"===i&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var a=this.options;return this._blurActiveElement(e),this.helper||a.disabled||h(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blockFrames(a.iframeFix===!0?"iframe":a.iframeFix),!0):!1)},_blockFrames:function(a){this.iframeBlocks=this.document.find(a).map(function(){var e=h(this);return h("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var a=this.document[0];if(this.handleElement.is(e.target)){try{a.activeElement&&"body"!==a.activeElement.nodeName.toLowerCase()&&h(a.activeElement).blur()}catch(l){}}},_mouseStart:function(e){var a=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),h.ui.ddmanager&&(h.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===h(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),h.ui.ddmanager&&!a.dropBehaviour&&h.ui.ddmanager.prepareOffsets(this,e),this._normalizeRightBottom(),this._mouseDrag(e,!0),h.ui.ddmanager&&h.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(a){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:a.pageX-this.offset.left,top:a.pageY-this.offset.top}},_mouseDrag:function(e,a){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!a){var l=this._uiHash();if(this._trigger("drag",e,l)===!1){return this._mouseUp({}),!1}this.position=l.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",h.ui.ddmanager&&h.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var a=this,l=!1;return h.ui.ddmanager&&!this.options.dropBehaviour&&(l=h.ui.ddmanager.drop(this,e)),this.dropped&&(l=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!l||"valid"===this.options.revert&&l||this.options.revert===!0||h.isFunction(this.options.revert)&&this.options.revert.call(this.element,l)?h(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){a._trigger("stop",e)!==!1&&a._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(a){return this._unblockFrames(),h.ui.ddmanager&&h.ui.ddmanager.dragStop(this,a),this.handleElement.is(a.target)&&this.element.focus(),h.ui.mouse.prototype._mouseUp.call(this,a)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(a){return this.options.handle?!!h(a.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(m){var l=this.options,n=h.isFunction(l.helper),e=n?h(l.helper.apply(this.element[0],[m])):"clone"===l.helper?this.element.clone().removeAttr("id"):this.element;return e.parents("body").length||e.appendTo("parent"===l.appendTo?this.element[0].parentNode:l.appendTo),n&&e[0]===this.element[0]&&this._setPositionRelative(),e[0]===this.element[0]||/(fixed|absolute)/.test(e.css("position"))||e.css("position","absolute"),e},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(a){"string"==typeof a&&(a=a.split(" ")),h.isArray(a)&&(a={left:+a[0],top:+a[1]||0}),"left" in a&&(this.offset.click.left=a.left+this.margins.left),"right" in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left),"top" in a&&(this.offset.click.top=a.top+this.margins.top),"bottom" in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_isRootNode:function(a){return/(html|body)/i.test(a.tagName)||a===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),a=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==a&&h.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition){return{top:0,left:0}}var i=this.element.position(),a=this._isRootNode(this.scrollParent[0]);return{top:i.top-(parseInt(this.helper.css("top"),10)||0)+(a?0:this.scrollParent.scrollTop()),left:i.left-(parseInt(this.helper.css("left"),10)||0)+(a?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var m,l,o,e=this.options,p=this.document[0];return this.relativeContainer=null,e.containment?"window"===e.containment?(this.containment=[h(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,h(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,h(window).scrollLeft()+h(window).width()-this.helperProportions.width-this.margins.left,h(window).scrollTop()+(h(window).height()||p.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===e.containment?(this.containment=[0,0,h(p).width()-this.helperProportions.width-this.margins.left,(h(p).height()||p.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):e.containment.constructor===Array?(this.containment=e.containment,void 0):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),l=h(e.containment),o=l[0],o&&(m=/(scroll|auto)/.test(l.css("overflow")),this.containment=[(parseInt(l.css("borderLeftWidth"),10)||0)+(parseInt(l.css("paddingLeft"),10)||0),(parseInt(l.css("borderTopWidth"),10)||0)+(parseInt(l.css("paddingTop"),10)||0),(m?Math.max(o.scrollWidth,o.offsetWidth):o.offsetWidth)-(parseInt(l.css("borderRightWidth"),10)||0)-(parseInt(l.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(m?Math.max(o.scrollHeight,o.offsetHeight):o.offsetHeight)-(parseInt(l.css("borderBottomWidth"),10)||0)-(parseInt(l.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=l),void 0):(this.containment=null,void 0)},_convertPositionTo:function(n,l){l||(l=this.position);var a="absolute"===n?1:-1,m=this._isRootNode(this.scrollParent[0]);return{top:l.top+this.offset.relative.top*a+this.offset.parent.top*a-("fixed"===this.cssPosition?-this.offset.scroll.top:m?0:this.offset.scroll.top)*a,left:l.left+this.offset.relative.left*a+this.offset.parent.left*a-("fixed"===this.cssPosition?-this.offset.scroll.left:m?0:this.offset.scroll.left)*a}},_generatePosition:function(x,z){var v,A,y,q,p=this.options,m=this._isRootNode(this.scrollParent[0]),w=x.pageX,u=x.pageY;return m&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),z&&(this.containment&&(this.relativeContainer?(A=this.relativeContainer.offset(),v=[this.containment[0]+A.left,this.containment[1]+A.top,this.containment[2]+A.left,this.containment[3]+A.top]):v=this.containment,x.pageX-this.offset.click.left<v[0]&&(w=v[0]+this.offset.click.left),x.pageY-this.offset.click.top<v[1]&&(u=v[1]+this.offset.click.top),x.pageX-this.offset.click.left>v[2]&&(w=v[2]+this.offset.click.left),x.pageY-this.offset.click.top>v[3]&&(u=v[3]+this.offset.click.top)),p.grid&&(y=p.grid[1]?this.originalPageY+Math.round((u-this.originalPageY)/p.grid[1])*p.grid[1]:this.originalPageY,u=v?y-this.offset.click.top>=v[1]||y-this.offset.click.top>v[3]?y:y-this.offset.click.top>=v[1]?y-p.grid[1]:y+p.grid[1]:y,q=p.grid[0]?this.originalPageX+Math.round((w-this.originalPageX)/p.grid[0])*p.grid[0]:this.originalPageX,w=v?q-this.offset.click.left>=v[0]||q-this.offset.click.left>v[2]?q:q-this.offset.click.left>=v[0]?q-p.grid[0]:q+p.grid[0]:q),"y"===p.axis&&(w=this.originalPageX),"x"===p.axis&&(u=this.originalPageY)),{top:u-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:m?0:this.offset.scroll.top),left:w-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:m?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(e,a,l){return l=l||this._uiHash(),h.ui.plugin.call(this,e,[a,l,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),l.offset=this.positionAbs),h.Widget.prototype._trigger.call(this,e,a,l)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),h.ui.plugin.add("draggable","connectToSortable",{start:function(m,l,n){var e=h.extend({},l,{item:n.element});n.sortables=[],h(n.options.connectToSortable).each(function(){var a=h(this).sortable("instance");a&&!a.options.disabled&&(n.sortables.push(a),a.refreshPositions(),a._trigger("activate",m,e))})},stop:function(m,l,n){var e=h.extend({},l,{item:n.element});n.cancelHelperRemoval=!1,h.each(n.sortables,function(){var a=this;a.isOver?(a.isOver=0,n.cancelHelperRemoval=!0,a.cancelHelperRemoval=!1,a._storedCSS={position:a.placeholder.css("position"),top:a.placeholder.css("top"),left:a.placeholder.css("left")},a._mouseStop(m),a.options.helper=a.options._helper):(a.cancelHelperRemoval=!0,a._trigger("deactivate",m,e))})},drag:function(e,a,l){h.each(l.sortables,function(){var i=!1,m=this;m.positionAbs=l.positionAbs,m.helperProportions=l.helperProportions,m.offset.click=l.offset.click,m._intersectsWith(m.containerCache)&&(i=!0,h.each(l.sortables,function(){return this.positionAbs=l.positionAbs,this.helperProportions=l.helperProportions,this.offset.click=l.offset.click,this!==m&&this._intersectsWith(this.containerCache)&&h.contains(m.element[0],this.element[0])&&(i=!1),i})),i?(m.isOver||(m.isOver=1,m.currentItem=a.helper.appendTo(m.element).data("ui-sortable-item",!0),m.options._helper=m.options.helper,m.options.helper=function(){return a.helper[0]},e.target=m.currentItem[0],m._mouseCapture(e,!0),m._mouseStart(e,!0,!0),m.offset.click.top=l.offset.click.top,m.offset.click.left=l.offset.click.left,m.offset.parent.left-=l.offset.parent.left-m.offset.parent.left,m.offset.parent.top-=l.offset.parent.top-m.offset.parent.top,l._trigger("toSortable",e),l.dropped=m.element,h.each(l.sortables,function(){this.refreshPositions()}),l.currentItem=l.element,m.fromOutside=l),m.currentItem&&(m._mouseDrag(e),a.position=m.position)):m.isOver&&(m.isOver=0,m.cancelHelperRemoval=!0,m.options._revert=m.options.revert,m.options.revert=!1,m._trigger("out",e,m._uiHash(m)),m._mouseStop(e,!0),m.options.revert=m.options._revert,m.options.helper=m.options._helper,m.placeholder&&m.placeholder.remove(),l._refreshOffsets(e),a.position=l._generatePosition(e,!0),l._trigger("fromSortable",e),l.dropped=!1,h.each(l.sortables,function(){this.refreshPositions()}))})}}),h.ui.plugin.add("draggable","cursor",{start:function(m,l,o){var e=h("body"),p=o.options;e.css("cursor")&&(p._cursor=e.css("cursor")),e.css("cursor",p.cursor)},stop:function(m,l,n){var e=n.options;e._cursor&&h("body").css("cursor",e._cursor)}}),h.ui.plugin.add("draggable","opacity",{start:function(m,l,o){var e=h(l.helper),p=o.options;e.css("opacity")&&(p._opacity=e.css("opacity")),e.css("opacity",p.opacity)},stop:function(m,l,n){var e=n.options;e._opacity&&h(l.helper).css("opacity",e._opacity)}}),h.ui.plugin.add("draggable","scroll",{start:function(m,l,a){a.scrollParentNotHidden||(a.scrollParentNotHidden=a.helper.scrollParent(!1)),a.scrollParentNotHidden[0]!==a.document[0]&&"HTML"!==a.scrollParentNotHidden[0].tagName&&(a.overflowOffset=a.scrollParentNotHidden.offset())},drag:function(m,l,p){var e=p.options,v=!1,u=p.scrollParentNotHidden[0],q=p.document[0];u!==q&&"HTML"!==u.tagName?(e.axis&&"x"===e.axis||(p.overflowOffset.top+u.offsetHeight-m.pageY<e.scrollSensitivity?u.scrollTop=v=u.scrollTop+e.scrollSpeed:m.pageY-p.overflowOffset.top<e.scrollSensitivity&&(u.scrollTop=v=u.scrollTop-e.scrollSpeed)),e.axis&&"y"===e.axis||(p.overflowOffset.left+u.offsetWidth-m.pageX<e.scrollSensitivity?u.scrollLeft=v=u.scrollLeft+e.scrollSpeed:m.pageX-p.overflowOffset.left<e.scrollSensitivity&&(u.scrollLeft=v=u.scrollLeft-e.scrollSpeed))):(e.axis&&"x"===e.axis||(m.pageY-h(q).scrollTop()<e.scrollSensitivity?v=h(q).scrollTop(h(q).scrollTop()-e.scrollSpeed):h(window).height()-(m.pageY-h(q).scrollTop())<e.scrollSensitivity&&(v=h(q).scrollTop(h(q).scrollTop()+e.scrollSpeed))),e.axis&&"y"===e.axis||(m.pageX-h(q).scrollLeft()<e.scrollSensitivity?v=h(q).scrollLeft(h(q).scrollLeft()-e.scrollSpeed):h(window).width()-(m.pageX-h(q).scrollLeft())<e.scrollSensitivity&&(v=h(q).scrollLeft(h(q).scrollLeft()+e.scrollSpeed)))),v!==!1&&h.ui.ddmanager&&!e.dropBehaviour&&h.ui.ddmanager.prepareOffsets(p,m)}}),h.ui.plugin.add("draggable","snap",{start:function(m,l,n){var e=n.options;n.snapElements=[],h(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var o=h(this),a=o.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:o.outerWidth(),height:o.outerHeight(),top:a.top,left:a.left})})},drag:function(x,G,z){var N,D,C,A,H,F,w,K,L,B,J=z.options,E=J.snapTolerance,I=G.offset.left,q=I+z.helperProportions.width,e=G.offset.top,M=e+z.helperProportions.height;for(L=z.snapElements.length-1;L>=0;L--){H=z.snapElements[L].left-z.margins.left,F=H+z.snapElements[L].width,w=z.snapElements[L].top-z.margins.top,K=w+z.snapElements[L].height,H-E>q||I>F+E||w-E>M||e>K+E||!h.contains(z.snapElements[L].item.ownerDocument,z.snapElements[L].item)?(z.snapElements[L].snapping&&z.options.snap.release&&z.options.snap.release.call(z.element,x,h.extend(z._uiHash(),{snapItem:z.snapElements[L].item})),z.snapElements[L].snapping=!1):("inner"!==J.snapMode&&(N=E>=Math.abs(w-M),D=E>=Math.abs(K-e),C=E>=Math.abs(H-q),A=E>=Math.abs(F-I),N&&(G.position.top=z._convertPositionTo("relative",{top:w-z.helperProportions.height,left:0}).top),D&&(G.position.top=z._convertPositionTo("relative",{top:K,left:0}).top),C&&(G.position.left=z._convertPositionTo("relative",{top:0,left:H-z.helperProportions.width}).left),A&&(G.position.left=z._convertPositionTo("relative",{top:0,left:F}).left)),B=N||D||C||A,"outer"!==J.snapMode&&(N=E>=Math.abs(w-e),D=E>=Math.abs(K-M),C=E>=Math.abs(H-I),A=E>=Math.abs(F-q),N&&(G.position.top=z._convertPositionTo("relative",{top:w,left:0}).top),D&&(G.position.top=z._convertPositionTo("relative",{top:K-z.helperProportions.height,left:0}).top),C&&(G.position.left=z._convertPositionTo("relative",{top:0,left:H}).left),A&&(G.position.left=z._convertPositionTo("relative",{top:0,left:F-z.helperProportions.width}).left)),!z.snapElements[L].snapping&&(N||D||C||A||B)&&z.options.snap.snap&&z.options.snap.snap.call(z.element,x,h.extend(z._uiHash(),{snapItem:z.snapElements[L].item})),z.snapElements[L].snapping=N||D||C||A||B)}}}),h.ui.plugin.add("draggable","stack",{start:function(m,l,p){var e,r=p.options,q=h.makeArray(h(r.stack)).sort(function(n,a){return(parseInt(h(n).css("zIndex"),10)||0)-(parseInt(h(a).css("zIndex"),10)||0)});q.length&&(e=parseInt(h(q[0]).css("zIndex"),10)||0,h(q).each(function(a){h(this).css("zIndex",e+a)}),this.css("zIndex",e+q.length))}}),h.ui.plugin.add("draggable","zIndex",{start:function(m,l,o){var e=h(l.helper),p=o.options;e.css("zIndex")&&(p._zIndex=e.css("zIndex")),e.css("zIndex",p.zIndex)},stop:function(m,l,n){var e=n.options;e._zIndex&&h(l.helper).css("zIndex",e._zIndex)}}),h.ui.draggable,h.widget("ui.resizable",h.ui.mouse,{version:"1.11.2",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(a){return parseInt(a,10)||0},_isNumber:function(a){return !isNaN(parseInt(a,10))},_hasScroll:function(m,l){if("hidden"===h(m).css("overflow")){return !1}var n=l&&"left"===l?"scrollLeft":"scrollTop",e=!1;return m[n]>0?!0:(m[n]=1,e=m[n]>0,m[n]=0,e)},_create:function(){var m,l,p,e,v,u=this,q=this.options;if(this.element.addClass("ui-resizable"),h.extend(this,{_aspectRatio:!!q.aspectRatio,aspectRatio:q.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:q.helper||q.ghost||q.animate?q.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(h("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=q.handles||(h(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String){for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),m=this.handles.split(","),this.handles={},l=0;m.length>l;l++){p=h.trim(m[l]),v="ui-resizable-"+p,e=h("<div class='ui-resizable-handle "+v+"'></div>"),e.css({zIndex:q.zIndex}),"se"===p&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[p]=".ui-resizable-"+p,this.element.append(e)}}this._renderAxis=function(w){var r,x,o,y;w=w||this.element;for(r in this.handles){this.handles[r].constructor===String&&(this.handles[r]=this.element.children(this.handles[r]).first().show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(x=h(this.handles[r],this.element),y=/sw|ne|nw|se|n|s/.test(r)?x.outerHeight():x.outerWidth(),o=["padding",/ne|nw|n/.test(r)?"Top":/se|sw|s/.test(r)?"Bottom":/^e$/.test(r)?"Right":"Left"].join(""),w.css(o,y),this._proportionallyResize()),h(this.handles[r]).length}},this._renderAxis(this.element),this._handles=h(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){u.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),u.axis=e&&e[1]?e[1]:"se")}),q.autoHide&&(this._handles.hide(),h(this.element).addClass("ui-resizable-autohide").mouseenter(function(){q.disabled||(h(this).removeClass("ui-resizable-autohide"),u._handles.show())}).mouseleave(function(){q.disabled||u.resizing||(h(this).addClass("ui-resizable-autohide"),u._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,a=function(i){h(i).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(a(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),a(this.originalElement),this},_mouseCapture:function(m){var l,n,e=!1;for(l in this.handles){n=h(this.handles[l])[0],(n===m.target||h.contains(n,m.target))&&(e=!0)}return !this.options.disabled&&e},_mouseStart:function(m){var l,p,e,r=this.options,q=this.element;return this.resizing=!0,this._renderProxy(),l=this._num(this.helper.css("left")),p=this._num(this.helper.css("top")),r.containment&&(l+=h(r.containment).scrollLeft()||0,p+=h(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:l,top:p},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:q.width(),height:q.height()},this.originalSize=this._helper?{width:q.outerWidth(),height:q.outerHeight()}:{width:q.width(),height:q.height()},this.sizeDiff={width:q.outerWidth()-q.width(),height:q.outerHeight()-q.height()},this.originalPosition={left:l,top:p},this.originalMousePosition={left:m.pageX,top:m.pageY},this.aspectRatio="number"==typeof r.aspectRatio?r.aspectRatio:this.originalSize.width/this.originalSize.height||1,e=h(".ui-resizable-"+this.axis).css("cursor"),h("body").css("cursor","auto"===e?this.axis+"-resize":e),q.addClass("ui-resizable-resizing"),this._propagate("start",m),!0},_mouseDrag:function(m){var l,q,e=this.originalMousePosition,w=this.axis,v=m.pageX-e.left||0,u=m.pageY-e.top||0,p=this._change[w];return this._updatePrevProperties(),p?(l=p.apply(this,[m,v,u]),this._updateVirtualBoundaries(m.shiftKey),(this._aspectRatio||m.shiftKey)&&(l=this._updateRatio(l,m)),l=this._respectSize(l,m),this._updateCache(l),this._propagate("resize",m),q=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),h.isEmptyObject(q)||(this._updatePrevProperties(),this._trigger("resize",m,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(z){this.resizing=!1;var v,A,x,p,m,e,w,q=this.options,y=this;return this._helper&&(v=this._proportionallyResizeElements,A=v.length&&/textarea/i.test(v[0].nodeName),x=A&&this._hasScroll(v[0],"left")?0:y.sizeDiff.height,p=A?0:y.sizeDiff.width,m={width:y.helper.width()-p,height:y.helper.height()-x},e=parseInt(y.element.css("left"),10)+(y.position.left-y.originalPosition.left)||null,w=parseInt(y.element.css("top"),10)+(y.position.top-y.originalPosition.top)||null,q.animate||this.element.css(h.extend(m,{top:w,left:e})),y.helper.height(y.size.height),y.helper.width(y.size.width),this._helper&&!q.animate&&this._proportionallyResize()),h("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",z),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var a={};return this.position.top!==this.prevPosition.top&&(a.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(a.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(a.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(a.height=this.size.height+"px"),this.helper.css(a),a},_updateVirtualBoundaries:function(r){var p,m,q,l,v,u=this.options;v={minWidth:this._isNumber(u.minWidth)?u.minWidth:0,maxWidth:this._isNumber(u.maxWidth)?u.maxWidth:1/0,minHeight:this._isNumber(u.minHeight)?u.minHeight:0,maxHeight:this._isNumber(u.maxHeight)?u.maxHeight:1/0},(this._aspectRatio||r)&&(p=v.minHeight*this.aspectRatio,q=v.minWidth/this.aspectRatio,m=v.maxHeight*this.aspectRatio,l=v.maxWidth/this.aspectRatio,p>v.minWidth&&(v.minWidth=p),q>v.minHeight&&(v.minHeight=q),v.maxWidth>m&&(v.maxWidth=m),v.maxHeight>l&&(v.maxHeight=l)),this._vBoundaries=v},_updateCache:function(a){this.offset=this.helper.offset(),this._isNumber(a.left)&&(this.position.left=a.left),this._isNumber(a.top)&&(this.position.top=a.top),this._isNumber(a.height)&&(this.size.height=a.height),this._isNumber(a.width)&&(this.size.width=a.width)},_updateRatio:function(n){var l=this.position,a=this.size,m=this.axis;return this._isNumber(n.height)?n.width=n.height*this.aspectRatio:this._isNumber(n.width)&&(n.height=n.width/this.aspectRatio),"sw"===m&&(n.left=l.left+(a.width-n.width),n.top=null),"nw"===m&&(n.top=l.top+(a.height-n.height),n.left=l.left+(a.width-n.width)),n},_respectSize:function(y){var B=this._vBoundaries,w=this.axis,C=this._isNumber(y.width)&&B.maxWidth&&B.maxWidth<y.width,z=this._isNumber(y.height)&&B.maxHeight&&B.maxHeight<y.height,q=this._isNumber(y.width)&&B.minWidth&&B.minWidth>y.width,p=this._isNumber(y.height)&&B.minHeight&&B.minHeight>y.height,m=this.originalPosition.left+this.originalSize.width,x=this.position.top+this.size.height,v=/sw|nw|w/.test(w),A=/nw|ne|n/.test(w);return q&&(y.width=B.minWidth),p&&(y.height=B.minHeight),C&&(y.width=B.maxWidth),z&&(y.height=B.maxHeight),q&&v&&(y.left=m-B.minWidth),C&&v&&(y.left=m-B.maxWidth),p&&A&&(y.top=x-B.minHeight),z&&A&&(y.top=x-B.maxHeight),y.width||y.height||y.left||!y.top?y.width||y.height||y.top||!y.left||(y.left=null):y.top=null,y},_getPaddingPlusBorderDimensions:function(p){for(var n=0,m=[],o=[p.css("borderTopWidth"),p.css("borderRightWidth"),p.css("borderBottomWidth"),p.css("borderLeftWidth")],l=[p.css("paddingTop"),p.css("paddingRight"),p.css("paddingBottom"),p.css("paddingLeft")];4>n;n++){m[n]=parseInt(o[n],10)||0,m[n]+=parseInt(l[n],10)||0}return{height:m[0]+m[2],width:m[1]+m[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){for(var m,l=0,a=this.helper||this.element;this._proportionallyResizeElements.length>l;l++){m=this._proportionallyResizeElements[l],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(m)),m.css({height:a.height()-this.outerDimensions.height||0,width:a.width()-this.outerDimensions.width||0})}}},_renderProxy:function(){var e=this.element,a=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||h("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++a.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(i,a){return{width:this.originalSize.width+a}},w:function(n,l){var a=this.originalSize,m=this.originalPosition;return{left:m.left+l,width:a.width-l}},n:function(p,n,m){var o=this.originalSize,l=this.originalPosition;return{top:l.top+m,height:o.height-m}},s:function(m,l,a){return{height:this.originalSize.height+a}},se:function(e,a,l){return h.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,a,l]))},sw:function(e,a,l){return h.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,a,l]))},ne:function(e,a,l){return h.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,a,l]))},nw:function(e,a,l){return h.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,a,l]))}},_propagate:function(e,a){h.ui.plugin.call(this,e,[a,this.ui()]),"resize"!==e&&this._trigger(e,a,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),h.ui.plugin.add("resizable","animate",{stop:function(z){var v=h(this).resizable("instance"),A=v.options,x=v._proportionallyResizeElements,p=x.length&&/textarea/i.test(x[0].nodeName),m=p&&v._hasScroll(x[0],"left")?0:v.sizeDiff.height,e=p?0:v.sizeDiff.width,w={width:v.size.width-e,height:v.size.height-m},q=parseInt(v.element.css("left"),10)+(v.position.left-v.originalPosition.left)||null,y=parseInt(v.element.css("top"),10)+(v.position.top-v.originalPosition.top)||null;v.element.animate(h.extend(w,y&&q?{top:y,left:q}:{}),{duration:A.animateDuration,easing:A.animateEasing,step:function(){var a={width:parseInt(v.element.css("width"),10),height:parseInt(v.element.css("height"),10),top:parseInt(v.element.css("top"),10),left:parseInt(v.element.css("left"),10)};x&&x.length&&h(x[0]).css({width:a.width,height:a.height}),v._updateCache(a),v._propagate("resize",z)}})}}),h.ui.plugin.add("resizable","containment",{start:function(){var B,v,C,z,p,m,e,w=h(this).resizable("instance"),q=w.options,A=w.element,x=q.containment,y=x instanceof h?x.get(0):/parent/.test(x)?A.parent().get(0):x;y&&(w.containerElement=h(y),/document/.test(x)||x===document?(w.containerOffset={left:0,top:0},w.containerPosition={left:0,top:0},w.parentData={element:h(document),left:0,top:0,width:h(document).width(),height:h(document).height()||document.body.parentNode.scrollHeight}):(B=h(y),v=[],h(["Top","Right","Left","Bottom"]).each(function(i,a){v[i]=w._num(B.css("padding"+a))}),w.containerOffset=B.offset(),w.containerPosition=B.position(),w.containerSize={height:B.innerHeight()-v[3],width:B.innerWidth()-v[1]},C=w.containerOffset,z=w.containerSize.height,p=w.containerSize.width,m=w._hasScroll(y,"left")?y.scrollWidth:p,e=w._hasScroll(y)?y.scrollHeight:z,w.parentData={element:y,left:C.left,top:C.top,width:m,height:e}))},resize:function(D){var x,E,B,v,q=h(this).resizable("instance"),e=q.options,y=q.containerOffset,w=q.position,C=q._aspectRatio||D.shiftKey,z={top:0,left:0},A=q.containerElement,m=!0;A[0]!==document&&/static/.test(A.css("position"))&&(z=y),w.left<(q._helper?y.left:0)&&(q.size.width=q.size.width+(q._helper?q.position.left-y.left:q.position.left-z.left),C&&(q.size.height=q.size.width/q.aspectRatio,m=!1),q.position.left=e.helper?y.left:0),w.top<(q._helper?y.top:0)&&(q.size.height=q.size.height+(q._helper?q.position.top-y.top:q.position.top),C&&(q.size.width=q.size.height*q.aspectRatio,m=!1),q.position.top=q._helper?y.top:0),B=q.containerElement.get(0)===q.element.parent().get(0),v=/relative|absolute/.test(q.containerElement.css("position")),B&&v?(q.offset.left=q.parentData.left+q.position.left,q.offset.top=q.parentData.top+q.position.top):(q.offset.left=q.element.offset().left,q.offset.top=q.element.offset().top),x=Math.abs(q.sizeDiff.width+(q._helper?q.offset.left-z.left:q.offset.left-y.left)),E=Math.abs(q.sizeDiff.height+(q._helper?q.offset.top-z.top:q.offset.top-y.top)),x+q.size.width>=q.parentData.width&&(q.size.width=q.parentData.width-x,C&&(q.size.height=q.size.width/q.aspectRatio,m=!1)),E+q.size.height>=q.parentData.height&&(q.size.height=q.parentData.height-E,C&&(q.size.width=q.size.height*q.aspectRatio,m=!1)),m||(q.position.left=q.prevPosition.left,q.position.top=q.prevPosition.top,q.size.width=q.prevSize.width,q.size.height=q.prevSize.height)},stop:function(){var x=h(this).resizable("instance"),u=x.options,y=x.containerOffset,w=x.containerPosition,p=x.containerElement,m=h(x.helper),e=m.offset(),v=m.outerWidth()-x.sizeDiff.width,q=m.outerHeight()-x.sizeDiff.height;x._helper&&!u.animate&&/relative/.test(p.css("position"))&&h(this).css({left:e.left-w.left-y.left,width:v,height:q}),x._helper&&!u.animate&&/static/.test(p.css("position"))&&h(this).css({left:e.left-w.left-y.left,width:v,height:q})}}),h.ui.plugin.add("resizable","alsoResize",{start:function(){var e=h(this).resizable("instance"),a=e.options,l=function(i){h(i).each(function(){var m=h(this);m.data("ui-resizable-alsoresize",{width:parseInt(m.width(),10),height:parseInt(m.height(),10),left:parseInt(m.css("left"),10),top:parseInt(m.css("top"),10)})})};"object"!=typeof a.alsoResize||a.alsoResize.parentNode?l(a.alsoResize):a.alsoResize.length?(a.alsoResize=a.alsoResize[0],l(a.alsoResize)):h.each(a.alsoResize,function(i){l(i)})},resize:function(m,l){var q=h(this).resizable("instance"),e=q.options,w=q.originalSize,v=q.originalPosition,u={height:q.size.height-w.height||0,width:q.size.width-w.width||0,top:q.position.top-v.top||0,left:q.position.left-v.left||0},p=function(a,i){h(a).each(function(){var s=h(this),r=h(this).data("ui-resizable-alsoresize"),y={},x=i&&i.length?i:s.parents(l.originalElement[0]).length?["width","height"]:["width","height","top","left"];h.each(x,function(z,o){var n=(r[o]||0)+(u[o]||0);n&&n>=0&&(y[o]=n||null)}),s.css(y)})};"object"!=typeof e.alsoResize||e.alsoResize.nodeType?p(e.alsoResize):h.each(e.alsoResize,function(i,a){p(i,a)})},stop:function(){h(this).removeData("resizable-alsoresize")}}),h.ui.plugin.add("resizable","ghost",{start:function(){var e=h(this).resizable("instance"),a=e.options,l=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:0.25,display:"block",position:"relative",height:l.height,width:l.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof a.ghost?a.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var a=h(this).resizable("instance");a.ghost&&a.ghost.css({position:"relative",height:a.size.height,width:a.size.width})},stop:function(){var a=h(this).resizable("instance");a.ghost&&a.helper&&a.helper.get(0).removeChild(a.ghost.get(0))}}),h.ui.plugin.add("resizable","grid",{resize:function(){var x,G=h(this).resizable("instance"),z=G.options,M=G.size,D=G.originalSize,C=G.originalPosition,A=G.axis,H="number"==typeof z.grid?[z.grid,z.grid]:z.grid,F=H[0]||1,w=H[1]||1,K=Math.round((M.width-D.width)/F)*F,L=Math.round((M.height-D.height)/w)*w,B=D.width+K,J=D.height+L,E=z.maxWidth&&B>z.maxWidth,I=z.maxHeight&&J>z.maxHeight,q=z.minWidth&&z.minWidth>B,e=z.minHeight&&z.minHeight>J;z.grid=H,q&&(B+=F),e&&(J+=w),E&&(B-=F),I&&(J-=w),/^(se|s|e)$/.test(A)?(G.size.width=B,G.size.height=J):/^(ne)$/.test(A)?(G.size.width=B,G.size.height=J,G.position.top=C.top-L):/^(sw)$/.test(A)?(G.size.width=B,G.size.height=J,G.position.left=C.left-K):((0>=J-w||0>=B-F)&&(x=G._getPaddingPlusBorderDimensions(this)),J-w>0?(G.size.height=J,G.position.top=C.top-L):(J=w-x.height,G.size.height=J,G.position.top=C.top+D.height-J),B-F>0?(G.size.width=B,G.position.left=C.left-K):(B=w-x.height,G.size.width=B,G.position.left=C.left+D.width-B))}}),h.ui.resizable;var j="ui-effects-",g=h;h.effects={effect:{}},function(B,G){function y(o,l,a){var n=C[l.type]||{};return null==o?a||!l.def?null:l.def:(o=n.floor?~~o:parseFloat(o),isNaN(o)?l.def:n.mod?(o+n.mod)%n.mod:0>o?0:o>n.max?n.max:o)}function H(l){var n=x(),e=n._rgba=[];return l=l.toLowerCase(),A(z,function(s,u){var t,p=u.re.exec(l),i=p&&u.parse(p),a=u.space||"rgba";return i?(t=n[a](i),n[F[a].cache]=t[F[a].cache],e=n._rgba=t._rgba,!1):G}),e.length?("0,0,0,0"===e.join()&&B.extend(e,w.transparent),n):w[l]}function E(n,l,a){return a=(a+1)%1,1>6*a?n+6*(l-n)*a:1>2*a?l:2>3*a?n+6*(l-n)*(2/3-a):n}var w,v="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",m=/^([\-+])=\s*(\d+\.?\d*)/,z=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],x=B.Color=function(n,l,o,e){return new B.Color.fn.parse(n,l,o,e)},F={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},C={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},D=x.support={},q=B("<p>")[0],A=B.each;q.style.cssText="background-color:rgba(1,1,1,.5)",D.rgba=q.style.backgroundColor.indexOf("rgba")>-1,A(F,function(i,a){a.cache="_"+i,a.props.alpha={idx:3,type:"percent",def:1}}),x.fn=B.extend(x.prototype,{parse:function(e,t,l,i){if(e===G){return this._rgba=[null,null,null,null],this}(e.jquery||e.nodeType)&&(e=B(e).css(t),t=G);var s=this,u=B.type(e),n=this._rgba=[];return t!==G&&(e=[e,t,l,i],u="array"),"string"===u?this.parse(H(e)||w._default):"array"===u?(A(F.rgba.props,function(o,a){n[a.idx]=y(e[a.idx],a)}),this):"object"===u?(e instanceof x?A(F,function(o,a){e[a.cache]&&(s[a.cache]=e[a.cache].slice())}):A(F,function(a,o){var p=o.cache;A(o.props,function(I,r){if(!s[p]&&o.to){if("alpha"===I||null==e[I]){return}s[p]=o.to(s._rgba)}s[p][r.idx]=y(e[I],r,!0)}),s[p]&&0>B.inArray(null,s[p].slice(0,3))&&(s[p][3]=1,o.from&&(s._rgba=o.from(s[p])))}),this):G},is:function(p){var n=x(p),o=!0,l=this;return A(F,function(i,t){var s,a=n[t.cache];return a&&(s=l[t.cache]||t.to&&t.to(l._rgba)||[],A(t.props,function(u,r){return null!=a[r.idx]?o=a[r.idx]===s[r.idx]:G})),o}),o},_space:function(){var i=[],a=this;return A(F,function(e,l){a[l.cache]&&i.push(e)}),i.pop()},transition:function(J,l){var u=x(J),i=u._space(),L=F[i],K=0===this.alpha()?x("transparent"):this,I=K[L.cache]||L.to(K._rgba),p=I.slice();return u=u[L.cache],A(L.props,function(M,s){var O=s.idx,N=I[O],r=u[O],t=C[s.type]||{};null!==r&&(null===N?p[O]=r:(t.mod&&(r-N>t.mod/2?N+=t.mod:N-r>t.mod/2&&(N-=t.mod)),p[O]=y((r-N)*l+N,s)))}),this[i](p)},blend:function(n){if(1===this._rgba[3]){return this}var l=this._rgba.slice(),o=l.pop(),e=x(n)._rgba;return x(B.map(l,function(i,a){return(1-o)*e[a]+o*i}))},toRgbaString:function(){var e="rgba(",a=B.map(this._rgba,function(l,i){return null==l?i>2?1:0:l});return 1===a[3]&&(a.pop(),e="rgb("),e+a.join()+")"},toHslaString:function(){var e="hsla(",a=B.map(this.hsla(),function(l,i){return null==l&&(l=i>2?1:0),i&&3>i&&(l=Math.round(100*l)+"%"),l});return 1===a[3]&&(a.pop(),e="hsl("),e+a.join()+")"},toHexString:function(e){var a=this._rgba.slice(),l=a.pop();return e&&a.push(~~(255*l)),"#"+B.map(a,function(i){return i=(i||0).toString(16),1===i.length?"0"+i:i}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),x.fn.parse.prototype=x.fn,F.hsla.to=function(N){if(null==N[0]||null==N[1]||null==N[2]){return[null,null,null,N[3]]}var R,L,S=N[0]/255,P=N[1]/255,J=N[2]/255,I=N[3],p=Math.max(S,P,J),M=Math.min(S,P,J),K=p-M,Q=p+M,O=0.5*Q;return R=M===p?0:S===p?60*(P-J)/K+360:P===p?60*(J-S)/K+120:60*(S-P)/K+240,L=0===K?0:0.5>=O?K/Q:K/(2-Q),[Math.round(R)%360,L,O,null==I?1:I]},F.hsla.from=function(I){if(null==I[0]||null==I[1]||null==I[2]){return[null,null,null,I[3]]}var l=I[0]/360,a=I[1],p=I[2],K=I[3],J=0.5>=p?p*(1+a):p+a-p*a,u=2*p-J;return[Math.round(255*E(u,J,l+1/3)),Math.round(255*E(u,J,l)),Math.round(255*E(u,J,l-1/3)),K]},A(F,function(p,e){var t=e.props,r=e.cache,l=e.to,i=e.from;x.fn[p]=function(o){if(l&&!this[r]&&(this[r]=l(this._rgba)),o===G){return this[r].slice()}var n,u=B.type(o),I="array"===u||"object"===u?o:arguments,J=this[r].slice();return A(t,function(L,a){var K=I["object"===u?L:a.idx];null==K&&(K=J[a.idx]),J[a.idx]=y(K,a)}),i?(n=x(i(J)),n[r]=J,n):x(J)},A(t,function(n,a){x.fn[n]||(x.fn[n]=function(I){var M,L=B.type(I),K="alpha"===n?this._hsla?"hsla":"rgba":p,s=this[K](),J=s[a.idx];return"undefined"===L?J:("function"===L&&(I=I.call(this,J),L=B.type(I)),null==I&&a.empty?this:("string"===L&&(M=m.exec(I),M&&(I=J+parseFloat(M[2])*("+"===M[1]?1:-1))),s[a.idx]=I,this[K](s)))})})}),x.hook=function(e){var a=e.split(" ");A(a,function(n,l){B.cssHooks[l]={set:function(p,i){var J,I,u="";if("transparent"!==i&&("string"!==B.type(i)||(J=H(i)))){if(i=x(J||i),!D.rgba&&1!==i._rgba[3]){for(I="backgroundColor"===l?p.parentNode:p;(""===u||"transparent"===u)&&I&&I.style;){try{u=B.css(I,"backgroundColor"),I=I.parentNode}catch(s){}}i=i.blend(u&&"transparent"!==u?u:"_default")}i=i.toRgbaString()}try{p.style[l]=i}catch(s){}}},B.fx.step[l]=function(i){i.colorInit||(i.start=x(i.elem,l),i.end=x(i.end),i.colorInit=!0),B.cssHooks[l].set(i.elem,i.start.transition(i.end,i.pos))}})},x.hook(v),B.cssHooks.borderColor={expand:function(i){var a={};return A(["Top","Right","Bottom","Left"],function(e,l){a["border"+l+"Color"]=i}),a}},w=B.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(g),function(){function m(q){var p,r,o=q.ownerDocument.defaultView?q.ownerDocument.defaultView.getComputedStyle(q,null):q.currentStyle,u={};if(o&&o.length&&o[0]&&o[o[0]]){for(r=o.length;r--;){p=o[r],"string"==typeof o[p]&&(u[h.camelCase(p)]=o[p])}}else{for(p in o){"string"==typeof o[p]&&(u[p]=o[p])}}return u}function l(p,a){var q,u,r={};for(q in a){u=a[q],p[q]!==u&&(e[q]||(h.fx.step[q]||!isNaN(parseFloat(u)))&&(r[q]=u))}return r}var n=["add","remove","toggle"],e={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};h.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(o,a){h.fx.step[a]=function(i){("none"!==i.end&&!i.setAttr||1===i.pos&&!i.setAttr)&&(g.style(i.elem,a,i.end),i.setAttr=!0)}}),h.fn.addBack||(h.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),h.effects.animateClass=function(i,t,s,q){var p=h.speed(t,s,q);return this.queue(function(){var w,v=h(this),u=v.attr("class")||"",a=p.children?v.find("*").addBack():v;a=a.map(function(){var o=h(this);return{el:o,start:m(this)}}),w=function(){h.each(n,function(r,o){i[o]&&v[o+"Class"](i[o])})},w(),a=a.map(function(){return this.end=m(this.el[0]),this.diff=l(this.start,this.end),this}),v.attr("class",u),a=a.map(function(){var r=this,o=h.Deferred(),x=h.extend({},p,{queue:!1,complete:function(){o.resolve(r)}});return this.el.animate(this.diff,x),o.promise()}),h.when.apply(h,a.get()).done(function(){w(),h.each(arguments,function(){var o=this.el;h.each(this.diff,function(r){o.css(r,"")})}),p.complete.call(v[0])})})},h.fn.extend({addClass:function(a){return function(p,q,o,r){return q?h.effects.animateClass.call(this,{add:p},q,o,r):a.apply(this,arguments)}}(h.fn.addClass),removeClass:function(a){return function(p,q,o,r){return arguments.length>1?h.effects.animateClass.call(this,{remove:p},q,o,r):a.apply(this,arguments)}}(h.fn.removeClass),toggleClass:function(a){return function(q,r,p,u,t){return"boolean"==typeof r||void 0===r?p?h.effects.animateClass.call(this,r?{add:q}:{remove:q},p,u,t):a.apply(this,arguments):h.effects.animateClass.call(this,{toggle:q},r,p,u)}}(h.fn.toggleClass),switchClass:function(q,p,r,o,u){return h.effects.animateClass.call(this,{add:p,remove:q},r,o,u)}})}(),function(){function e(n,m,o,l){return h.isPlainObject(n)&&(m=n,n=n.effect),n={effect:n},null==m&&(m={}),h.isFunction(m)&&(l=m,o=null,m={}),("number"==typeof m||h.fx.speeds[m])&&(l=o,o=m,m={}),h.isFunction(o)&&(l=o,o=null),m&&h.extend(n,m),o=o||m.duration,n.duration=h.fx.off?0:"number"==typeof o?o:o in h.fx.speeds?h.fx.speeds[o]:h.fx.speeds._default,n.complete=l||m.complete,n}function a(i){return !i||"number"==typeof i||h.fx.speeds[i]?!0:"string"!=typeof i||h.effects.effect[i]?h.isFunction(i)?!0:"object"!=typeof i||i.effect?!1:!0:!0}h.extend(h.effects,{version:"1.11.2",save:function(n,m){for(var l=0;m.length>l;l++){null!==m[l]&&n.data(j+m[l],n[0].style[m[l]])}},restore:function(o,m){var l,n;for(n=0;m.length>n;n++){null!==m[n]&&(l=o.data(j+m[n]),void 0===l&&(l=""),o.css(m[n],l))}},setMode:function(l,i){return"toggle"===i&&(i=l.is(":hidden")?"show":"hide"),i},getBaseline:function(o,m){var l,n;switch(o[0]){case"top":l=0;break;case"middle":l=0.5;break;case"bottom":l=1;break;default:l=o[0]/m.height}switch(o[1]){case"left":n=0;break;case"center":n=0.5;break;case"right":n=1;break;default:n=o[1]/m.width}return{x:n,y:l}},createWrapper:function(p){if(p.parent().is(".ui-effects-wrapper")){return p.parent()}var m={width:p.outerWidth(!0),height:p.outerHeight(!0),"float":p.css("float")},q=h("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),l={width:p.width(),height:p.height()},u=document.activeElement;try{u.id}catch(r){u=document.body}return p.wrap(q),(p[0]===u||h.contains(p[0],u))&&h(u).focus(),q=p.parent(),"static"===p.css("position")?(q.css({position:"relative"}),p.css({position:"relative"})):(h.extend(m,{position:p.css("position"),zIndex:p.css("z-index")}),h.each(["top","left","bottom","right"],function(n,i){m[i]=p.css(i),isNaN(parseInt(m[i],10))&&(m[i]="auto")}),p.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),p.css(l),q.css(m).show()},removeWrapper:function(m){var l=document.activeElement;return m.parent().is(".ui-effects-wrapper")&&(m.parent().replaceWith(m),(m[0]===l||h.contains(m[0],l))&&h(l).focus()),m},setTransition:function(n,m,o,l){return l=l||{},h.each(m,function(q,p){var r=n.cssUnit(p);r[0]>0&&(l[p]=r[0]*o+r[1])}),l}}),h.fn.extend({effect:function(){function m(u){function s(){h.isFunction(w)&&w.call(o[0]),h.isFunction(u)&&u()}var o=h(this),w=p.complete,v=p.mode;(o.is(":hidden")?"hide"===v:"show"===v)?(o[v](),s()):q.call(o[0],p,s)}var p=e.apply(this,arguments),l=p.mode,r=p.queue,q=h.effects.effect[p.effect];return h.fx.off||!q?l?this[l](p.duration,p.complete):this.each(function(){p.complete&&p.complete.call(this)}):r===!1?this.each(m):this.queue(r||"fx",m)},show:function(i){return function(m){if(a(m)){return i.apply(this,arguments)}var l=e.apply(this,arguments);return l.mode="show",this.effect.call(this,l)}}(h.fn.show),hide:function(i){return function(m){if(a(m)){return i.apply(this,arguments)}var l=e.apply(this,arguments);return l.mode="hide",this.effect.call(this,l)}}(h.fn.hide),toggle:function(i){return function(m){if(a(m)||"boolean"==typeof m){return i.apply(this,arguments)}var l=e.apply(this,arguments);return l.mode="toggle",this.effect.call(this,l)}}(h.fn.toggle),cssUnit:function(m){var l=this.css(m),n=[];return h.each(["em","px","%","pt"],function(o,i){l.indexOf(i)>0&&(n=[parseFloat(l),i])}),n}})}(),function(){var a={};h.each(["Quad","Cubic","Quart","Quint","Expo"],function(m,l){a[l]=function(e){return Math.pow(e,m+2)}}),h.extend(a,{Sine:function(i){return 1-Math.cos(i*Math.PI/2)},Circ:function(i){return 1-Math.sqrt(1-i*i)},Elastic:function(i){return 0===i||1===i?i:-Math.pow(2,8*(i-1))*Math.sin((80*(i-1)-7.5)*Math.PI/15)},Back:function(i){return i*i*(3*i-2)},Bounce:function(n){for(var m,l=4;((m=Math.pow(2,--l))-1)/11>n;){}return 1/Math.pow(4,3-l)-7.5625*Math.pow((3*m-2)/22-n,2)}}),h.each(a,function(l,e){h.easing["easeIn"+l]=e,h.easing["easeOut"+l]=function(i){return 1-e(1-i)},h.easing["easeInOut"+l]=function(i){return 0.5>i?e(2*i)/2:1-e(-2*i+2)/2}})}(),h.effects});
/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 20112014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(h){function i(f,e){if(!(f.originalEvent.touches.length>1)){f.preventDefault();var n=f.originalEvent.changedTouches[0],m=document.createEvent("MouseEvents");m.initMouseEvent(e,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),f.target.dispatchEvent(m)}}if(h.support.touch="ontouchend" in document,h.support.touch){var j,g=h.ui.mouse.prototype,l=g._mouseInit,k=g._mouseDestroy;g._touchStart=function(d){var c=this;!j&&c._mouseCapture(d.originalEvent.changedTouches[0])&&(j=!0,c._touchMoved=!1,i(d,"mouseover"),i(d,"mousemove"),i(d,"mousedown"))},g._touchMove=function(b){j&&(this._touchMoved=!0,i(b,"mousemove"))},g._touchEnd=function(b){j&&(i(b,"mouseup"),i(b,"mouseout"),this._touchMoved||i(b,"click"),j=!1)},g._mouseInit=function(){var a=this;a.element.bind({touchstart:h.proxy(a,"_touchStart"),touchmove:h.proxy(a,"_touchMove"),touchend:h.proxy(a,"_touchEnd")}),l.call(a)},g._mouseDestroy=function(){var a=this;a.element.unbind({touchstart:h.proxy(a,"_touchStart"),touchmove:h.proxy(a,"_touchMove"),touchend:h.proxy(a,"_touchEnd")}),k.call(a)}}}(jQuery);
window.Modernizr=function(an,am,al){function H(b){ae.cssText=b}function Y(d,c){return H(ab.join(d+";")+(c||""))}function W(d,c){return typeof d===c}function U(d,c){return !!~(""+d).indexOf(c)}function S(f,c){for(var h in f){var g=f[h];if(!U(g,"-")&&ae[g]!==al){return c=="pfx"?g:!0}}return !1}function Q(g,c,j){for(var i in g){var h=c[g[i]];if(h!==al){return j===!1?g[i]:W(h,"function")?h.bind(j||c):h}}return !1}function O(g,f,j){var i=g.charAt(0).toUpperCase()+g.slice(1),h=(g+" "+Z.join(i+" ")+i).split(" ");return W(f,"string")||W(f,"undefined")?S(h,f):(h=(g+" "+X.join(i+" ")+i).split(" "),Q(h,f,j))}var ak="2.8.3",aj={},ai=!0,ah=am.documentElement,ag="modernizr",af=am.createElement(ag),ae=af.style,ad,ac={}.toString,ab=" -webkit- -moz- -o- -ms- ".split(" "),aa="Webkit Moz O ms",Z=aa.split(" "),X=aa.toLowerCase().split(" "),V={},T={},R={},P=[],N=P.slice,M,K=function(v,u,t,s){var r,q,p,o,h=am.createElement("div"),g=am.body,b=g||am.createElement("body");if(parseInt(t,10)){while(t--){p=am.createElement("div"),p.id=s?s[t]:ag+(t+1),h.appendChild(p)}}return r=["&#173;",'<style id="s',ag,'">',v,"</style>"].join(""),h.id=ag,(g?h:b).innerHTML+=r,b.appendChild(h),g||(b.style.background="",b.style.overflow="hidden",o=ah.style.overflow,ah.style.overflow="hidden",ah.appendChild(b)),q=u(h,v),g?h.parentNode.removeChild(h):(b.parentNode.removeChild(b),ah.style.overflow=o),!!q},J={}.hasOwnProperty,I;!W(J,"undefined")&&!W(J.call,"undefined")?I=function(d,c){return J.call(d,c)}:I=function(d,c){return c in d&&W(d.constructor.prototype[c],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var h=this;if(typeof h!="function"){throw new TypeError}var g=N.call(arguments,1),f=function(){if(this instanceof f){var b=function(){};b.prototype=h.prototype;var d=new b,c=h.apply(d,g.concat(N.call(arguments)));return Object(c)===c?c:d}return h.apply(a,g.concat(N.call(arguments)))};return f}),V.canvas=function(){var b=am.createElement("canvas");return !!b.getContext&&!!b.getContext("2d")},V.touch=function(){var a;return"ontouchstart" in an||an.DocumentTouch&&am instanceof DocumentTouch?a=!0:K(["@media (",ab.join("touch-enabled),("),ag,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(b){a=b.offsetTop===9}),a},V.cssanimations=function(){return O("animationName")},V.csstransforms=function(){return !!O("transform")},V.csstransforms3d=function(){var b=!!O("perspective");return b&&"webkitPerspective" in ah.style&&K("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(a,d){b=a.offsetLeft===9&&a.offsetHeight===3}),b},V.csstransitions=function(){return O("transition")},V.video=function(){var b=am.createElement("video"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),f.h264=b.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),f.webm=b.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(e){}return f},V.audio=function(){var b=am.createElement("audio"),f=!1;try{if(f=!!b.canPlayType){f=new Boolean(f),f.ogg=b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),f.mp3=b.canPlayType("audio/mpeg;").replace(/^no$/,""),f.wav=b.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),f.m4a=(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(e){}return f};for(var L in V){I(V,L)&&(M=L.toLowerCase(),aj[M]=V[L](),P.push((aj[M]?"":"no-")+M))}return aj.addTest=function(e,c){if(typeof e=="object"){for(var f in e){I(e,f)&&aj.addTest(f,e[f])}}else{e=e.toLowerCase();if(aj[e]!==al){return aj}c=typeof c=="function"?c():c,typeof ai!="undefined"&&ai&&(ah.className+=" "+(c?"":"no-")+e),aj[e]=c}return aj},H(""),af=ad=null,function(at,ar){function A(f,e){var h=f.createElement("p"),g=f.getElementsByTagName("head")[0]||f.documentElement;return h.innerHTML="x<style>"+e+"</style>",g.insertBefore(h.lastChild,g.firstChild)}function z(){var b=t.elements;return typeof b=="string"?b.split(" "):b}function y(d){var c=C[d[E]];return c||(c={},D++,d[E]=D,C[D]=c),c}function x(b,h,f){h||(h=ar);if(B){return h.createElement(b)}f||(f=y(h));var e;return f.cache[b]?e=f.cache[b].cloneNode():G.test(b)?e=(f.cache[b]=f.createElem(b)).cloneNode():e=f.createElem(b),e.canHaveChildren&&!ao.test(b)&&!e.tagUrn?f.frag.appendChild(e):e}function w(b,l){b||(b=ar);if(B){return b.createDocumentFragment()}l=l||y(b);var k=l.frag.cloneNode(),j=0,i=z(),h=i.length;for(;j<h;j++){k.createElement(i[j])}return k}function v(d,c){c.cache||(c.cache={},c.createElem=d.createElement,c.createFrag=d.createDocumentFragment,c.frag=c.createFrag()),d.createElement=function(a){return t.shivMethods?x(a,d,c):c.createElem(a)},d.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+z().join().replace(/[\w\-]+/g,function(b){return c.createElem(b),c.frag.createElement(b),'c("'+b+'")'})+");return n}")(t,c.frag)}function u(b){b||(b=ar);var d=y(b);return t.shivCSS&&!F&&!d.hasCSS&&(d.hasCSS=!!A(b,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),B||v(b,d),b}var aq="3.7.0",ap=at.html5||{},ao=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,G=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,F,E="_html5shiv",D=0,C={},B;(function(){try{var b=ar.createElement("a");b.innerHTML="<xyz></xyz>",F="hidden" in b,B=b.childNodes.length==1||function(){ar.createElement("a");var c=ar.createDocumentFragment();return typeof c.cloneNode=="undefined"||typeof c.createDocumentFragment=="undefined"||typeof c.createElement=="undefined"}()}catch(d){F=!0,B=!0}})();var t={elements:ap.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:aq,shivCSS:ap.shivCSS!==!1,supportsUnknownElements:B,shivMethods:ap.shivMethods!==!1,type:"default",shivDocument:u,createElement:x,createDocumentFragment:w};at.html5=t,u(ar)}(this,am),aj._version=ak,aj._prefixes=ab,aj._domPrefixes=X,aj._cssomPrefixes=Z,aj.testProp=function(b){return S([b])},aj.testAllProps=O,aj.testStyles=K,ah.className=ah.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(ai?" js "+P.join(" "):""),aj}(this,this.document),function(ad,ac,ab){function aa(b){return"[object Function]"==P.call(b)}function Z(b){return"string"==typeof b}function Y(){}function X(b){return !b||"loaded"==b||"complete"==b||"uninitialized"==b}function W(){var b=O.shift();M=1,b?b.t?R(function(){("c"==b.t?L.injectCss:L.injectJs)(b.s,0,b.a,b.x,b.e,1)},0):(b(),W()):M=0}function V(w,v,t,s,q,p,n){function m(a){if(!g&&X(h.readyState)&&(x.r=g=1,!M&&W(),h.onload=h.onreadystatechange=null,a)){"img"!=w&&R(function(){I.removeChild(h)},50);for(var c in D[v]){D[v].hasOwnProperty(c)&&D[v][c].onload()}}}var n=n||L.errorTimeout,h=ac.createElement(w),g=0,b=0,x={t:t,s:v,e:q,a:p,x:n};1===D[v]&&(b=1,D[v]=[]),"object"==w?h.data=v:(h.src=v,h.type=w),h.width=h.height="0",h.onerror=h.onload=h.onreadystatechange=function(){m.call(this,b)},O.splice(s,0,x),"img"!=w&&(b||2===D[v]?(I.insertBefore(h,J?null:Q),R(m,n)):D[v].push(h))}function U(g,e,j,i,h){return M=0,e=e||"j",Z(g)?V("c"==e?G:H,g,e,this.i++,j,i,h):(O.splice(this.i++,0,g),1==O.length&&W()),this}function T(){var b=L;return b.loader={load:U,i:0},b}var S=ac.documentElement,R=ad.setTimeout,Q=ac.getElementsByTagName("script")[0],P={}.toString,O=[],M=0,K="MozAppearance" in S.style,J=K&&!!ac.createRange().compareNode,I=J?S:Q.parentNode,S=ad.opera&&"[object Opera]"==P.call(ad.opera),S=!!ac.attachEvent&&!S,H=K?"object":S?"script":"img",G=S?"script":H,F=Array.isArray||function(b){return"[object Array]"==P.call(b)},E=[],D={},C={timeout:function(d,c){return c.length&&(d.timeout=c[0]),d}},N,L;L=function(e){function c(i){var i=i.split("!"),h=E.length,q=i.pop(),p=i.length,q={url:q,origUrl:q,prefixes:i},o,l,j;for(l=0;l<p;l++){j=i[l].split("="),(o=C[j.shift()])&&(q=o(q,j))}for(l=0;l<h;l++){q=E[l](q)}return q}function n(b,s,r,q,p){var o=c(b),l=o.autoCallback;o.url.split(".").pop().split("?").shift(),o.bypass||(s&&(s=aa(s)?s:s[b]||s[q]||s[b.split("/").pop().split("?")[0]]),o.instead?o.instead(b,s,r,q,p):(D[o.url]?o.noexec=!0:D[o.url]=1,r.load(o.url,o.forceCSS||!o.forceJS&&"css"==o.url.split(".").pop().split("?").shift()?"c":ab,o.noexec,o.attrs,o.timeout),(aa(s)||aa(l))&&r.load(function(){T(),s&&s(o.origUrl,p,q),l&&l(o.origUrl,p,q),D[o.url]=2})))}function m(w,v){function u(b,h){if(b){if(Z(b)){h||(r=function(){var i=[].slice.call(arguments);q.apply(this,i),p()}),n(b,r,v,0,t)}else{if(Object(b)===b){for(g in o=function(){var a=0,i;for(i in b){b.hasOwnProperty(i)&&a++}return a}(),b){b.hasOwnProperty(g)&&(!h&&!--o&&(aa(r)?r=function(){var i=[].slice.call(arguments);q.apply(this,i),p()}:r[g]=function(i){return function(){var a=[].slice.call(arguments);i&&i.apply(this,a),p()}}(q[g])),n(b[g],r,v,g,t))}}}}else{!h&&p()}}var t=!!w.test,s=w.load||w.both,r=w.callback||Y,q=r,p=w.complete||Y,o,g;u(t?w.yep:w.nope,!!s),s&&u(s)}var k,f,d=this.yepnope.loader;if(Z(e)){n(e,0,d,0)}else{if(F(e)){for(k=0;k<e.length;k++){f=e[k],Z(f)?n(f,0,d,0):F(f)?L(f):Object(f)===f&&m(f,d)}}else{Object(e)===e&&m(e,d)}}},L.addPrefix=function(d,c){C[d]=c},L.addFilter=function(b){E.push(b)},L.errorTimeout=10000,null==ac.readyState&&ac.addEventListener&&(ac.readyState="loading",ac.addEventListener("DOMContentLoaded",N=function(){ac.removeEventListener("DOMContentLoaded",N,0),ac.readyState="complete"},0)),ad.yepnope=T(),ad.yepnope.executeStack=W,ad.yepnope.injectJs=function(r,q,p,n,m,h){var g=ac.createElement("script"),f,b,n=n||L.errorTimeout;g.src=r;for(b in p){g.setAttribute(b,p[b])}q=h?W:q||Y,g.onreadystatechange=g.onload=function(){!f&&X(g.readyState)&&(f=1,q(),g.onload=g.onreadystatechange=null)},R(function(){f||(f=1,q(1))},n),m?g.onload():Q.parentNode.insertBefore(g,Q)},ad.yepnope.injectCss=function(b,n,m,l,k,h){var l=ac.createElement("link"),f,n=h?W:n||Y;l.href=b,l.rel="stylesheet",l.type="text/css";for(f in m){l.setAttribute(f,m[f])}k||(Q.parentNode.insertBefore(l,Q),R(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};
(function(b,a){if(typeof define=="function"&&define.amd){define(b)}else{if(typeof module!="undefined"&&typeof exports=="object"){module.exports=b()}else{a.rangy=b()}}})(function(){var u="object",d="function",A="undefined";var a=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var q=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var l=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var H=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function D(O,N){var M=typeof O[N];return M==d||(!!(M==u&&O[N]))||M=="unknown"}function y(N,M){return !!(typeof N[M]==u&&N[M])}function f(N,M){return typeof N[M]!=A}function w(M){return function(P,O){var N=O.length;while(N--){if(!M(P,O[N])){return false}}return true}}var j=w(D);var t=w(y);var g=w(f);function z(M){return M&&j(M,H)&&g(M,l)}function K(M){return y(M,"body")?M.body:M.getElementsByTagName("body")[0]}var b=[].forEach?function(M,N){M.forEach(N)}:function(N,P){for(var O=0,M=N.length;O<M;++O){P(N[O],O)}};var v={};var C=(typeof window!=A&&typeof document!=A);var k={isHostMethod:D,isHostObject:y,isHostProperty:f,areHostMethods:j,areHostObjects:t,areHostProperties:g,isTextRange:z,getBody:K,forEach:b};var h={version:"1.3.0-beta.2",initialized:false,isBrowser:C,supported:true,util:k,features:{},modules:v,config:{alertOnFail:false,alertOnWarn:false,preferTextRange:false,autoInitialize:(typeof rangyAutoInitialize==A)?true:rangyAutoInitialize}};function G(M){if(typeof console!=A&&D(console,"log")){console.log(M)}}function p(N,M){if(C&&M){alert(N)}else{G(N)}}function m(M){h.initialized=true;h.supported=false;p("Rangy is not supported in this environment. Reason: "+M,h.config.alertOnFail)}h.fail=m;function n(M){p("Rangy warning: "+M,h.config.alertOnWarn)}h.warn=n;var o;if({}.hasOwnProperty){k.extend=o=function(Q,O,M){var R,P;for(var N in O){if(O.hasOwnProperty(N)){R=Q[N];P=O[N];if(M&&R!==null&&typeof R=="object"&&P!==null&&typeof P=="object"){o(R,P,true)}Q[N]=P}}if(O.hasOwnProperty("toString")){Q.toString=O.toString}return Q};k.createOptions=function(M,O){var N={};o(N,O);if(M){o(N,M)}return N}}else{m("hasOwnProperty not supported")}if(!C){m("Rangy can only run in a browser")}(function(){var M;if(C){var N=document.createElement("div");N.appendChild(document.createElement("span"));var P=[].slice;try{if(P.call(N.childNodes,0)[0].nodeType==1){M=function(Q){return P.call(Q,0)}}}catch(O){}}if(!M){M=function(S){var R=[];for(var T=0,Q=S.length;T<Q;++T){R[T]=S[T]}return R}}k.toArray=M})();var i;if(C){if(D(document,"addEventListener")){i=function(O,M,N){O.addEventListener(M,N,false)}}else{if(D(document,"attachEvent")){i=function(O,M,N){O.attachEvent("on"+M,N)}}else{m("Document does not have required addEventListener or attachEvent method")}}k.addListener=i}var L=[];function c(M){return M.message||M.description||String(M)}function I(){if(!C||h.initialized){return}var O;var V=false,P=false;if(D(document,"createRange")){O=document.createRange();if(j(O,q)&&g(O,a)){V=true}}var R=K(document);if(!R||R.nodeName.toLowerCase()!="body"){m("No body element found");return}if(R&&D(R,"createTextRange")){O=R.createTextRange();if(z(O)){P=true}}if(!V&&!P){m("Neither Range nor TextRange are available");return}h.initialized=true;h.features={implementsDomRange:V,implementsTextRange:P};var N,T;for(var M in v){if((N=v[M]) instanceof x){N.init(N,h)}}for(var Q=0,S=L.length;Q<S;++Q){try{L[Q](h)}catch(U){T="Rangy init listener threw an exception. Continuing. Detail: "+c(U);G(T)}}}h.init=I;h.addInitListener=function(M){if(h.initialized){M(h)}else{L.push(M)}};var s=[];h.addShimListener=function(M){s.push(M)};function E(O){O=O||window;I();for(var N=0,M=s.length;N<M;++N){s[N](O)}}if(C){h.shim=h.createMissingNativeApi=E}function x(M,O,N){this.name=M;this.dependencies=O;this.initialized=false;this.supported=false;this.initializer=N}x.prototype={init:function(){var P=this.dependencies||[];for(var O=0,M=P.length,Q,N;O<M;++O){N=P[O];Q=v[N];if(!Q||!(Q instanceof x)){throw new Error("required module '"+N+"' not found")}Q.init();if(!Q.supported){throw new Error("required module '"+N+"' not supported")}}this.initializer(this)},fail:function(M){this.initialized=true;this.supported=false;throw new Error(M)},warn:function(M){h.warn("Module "+this.name+": "+M)},deprecationNotice:function(M,N){h.warn("DEPRECATED: "+M+" in module "+this.name+"is deprecated. Please use "+N+" instead")},createError:function(M){return new Error("Error in Rangy "+this.name+" module: "+M)}};function r(M,O,P){var N=new x(M,O,function(S){if(!S.initialized){S.initialized=true;try{P(h,S);S.supported=true}catch(R){var Q="Module '"+M+"' failed to load: "+c(R);G(Q);if(R.stack){G(R.stack)}}}});v[M]=N;return N}h.createModule=function(M){var P,O;if(arguments.length==2){P=arguments[1];O=[]}else{P=arguments[2];O=arguments[1]}var N=r(M,O,P);if(h.initialized&&h.supported){N.init()}};h.createCoreModule=function(M,N,O){r(M,N,O)};function F(){}h.RangePrototype=F;h.rangePrototype=new F();function B(){}h.selectionPrototype=new B();h.createCoreModule("DomUtil",[],function(P,N){var af="undefined";var R=P.util;var av=R.getBody;if(!R.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){N.fail("document missing a Node creation method")}if(!R.isHostMethod(document,"getElementsByTagName")){N.fail("document missing getElementsByTagName method")}var at=document.createElement("div");if(!R.areHostMethods(at,["insertBefore","appendChild","cloneNode"]||!R.areHostObjects(at,["previousSibling","nextSibling","childNodes","parentNode"]))){N.fail("Incomplete Element implementation")}if(!R.isHostProperty(at,"innerHTML")){N.fail("Element is missing innerHTML property")}var aw=document.createTextNode("test");if(!R.areHostMethods(aw,["splitText","deleteData","insertData","appendData","cloneNode"]||!R.areHostObjects(at,["previousSibling","nextSibling","childNodes","parentNode"])||!R.areHostProperties(aw,["data"]))){N.fail("Incomplete Text Node implementation")}var az=function(aA,aC){var aB=aA.length;while(aB--){if(aA[aB]===aC){return true}}return false};function T(aB){var aA;return typeof aB.namespaceURI==af||((aA=aB.namespaceURI)===null||aA=="http://www.w3.org/1999/xhtml")}function ag(aB){var aA=aB.parentNode;return(aA.nodeType==1)?aA:null}function aa(aB){var aA=0;while((aB=aB.previousSibling)){++aA}return aA}function ai(aA){switch(aA.nodeType){case 7:case 10:return 0;case 3:case 8:return aA.length;default:return aA.childNodes.length}}function X(aB,aA){var aC=[],aD;for(aD=aB;aD;aD=aD.parentNode){aC.push(aD)}for(aD=aA;aD;aD=aD.parentNode){if(az(aC,aD)){return aD}}return null}function W(aA,aB,aD){var aC=aD?aB:aB.parentNode;while(aC){if(aC===aA){return true}else{aC=aC.parentNode}}return false}function aq(aA,aB){return W(aA,aB,true)}function an(aB,aA,aE){var aC,aD=aE?aB:aB.parentNode;while(aD){aC=aD.parentNode;if(aC===aA){return aD}aD=aC}return null}function O(aB){var aA=aB.nodeType;return aA==3||aA==4||aA==8}function M(aB){if(!aB){return false}var aA=aB.nodeType;return aA==3||aA==8}function S(aD,aB){var aA=aB.nextSibling,aC=aB.parentNode;if(aA){aC.insertBefore(aD,aA)}else{aC.appendChild(aD)}return aD}function ah(aF,aC,aB){var aE=aF.cloneNode(false);aE.deleteData(0,aC);aF.deleteData(aC,aF.length-aC);S(aE,aF);if(aB){for(var aD=0,aA;aA=aB[aD++];){if(aA.node==aF&&aA.offset>aC){aA.node=aE;aA.offset-=aC}else{if(aA.node==aF.parentNode&&aA.offset>aa(aF)){++aA.offset}}}}return aE}function ax(aA){if(aA.nodeType==9){return aA}else{if(typeof aA.ownerDocument!=af){return aA.ownerDocument}else{if(typeof aA.document!=af){return aA.document}else{if(aA.parentNode){return ax(aA.parentNode)}else{throw N.createError("getDocument: no document found for node")}}}}}function Z(aA){var aB=ax(aA);if(typeof aB.defaultView!=af){return aB.defaultView}else{if(typeof aB.parentWindow!=af){return aB.parentWindow}else{throw N.createError("Cannot get a window object for node")}}}function ay(aA){if(typeof aA.contentDocument!=af){return aA.contentDocument}else{if(typeof aA.contentWindow!=af){return aA.contentWindow.document}else{throw N.createError("getIframeDocument: No Document object found for iframe element")}}}function au(aA){if(typeof aA.contentWindow!=af){return aA.contentWindow}else{if(typeof aA.contentDocument!=af){return aA.contentDocument.defaultView}else{throw N.createError("getIframeWindow: No Window object found for iframe element")}}}function al(aA){return aA&&R.isHostMethod(aA,"setTimeout")&&R.isHostObject(aA,"document")}function ak(aD,aB,aA){var aC;if(!aD){aC=document}else{if(R.isHostProperty(aD,"nodeType")){aC=(aD.nodeType==1&&aD.tagName.toLowerCase()=="iframe")?ay(aD):ax(aD)}else{if(al(aD)){aC=aD.document}}}if(!aC){throw aB.createError(aA+"(): Parameter must be a Window object or DOM node")}return aC}function U(aB){var aA;while((aA=aB.parentNode)){aB=aA}return aB}function ao(aD,aF,aC,aE){var aA,aG,aI,aH,aB;if(aD==aC){return aF===aE?0:(aF<aE)?-1:1}else{if((aA=an(aC,aD,true))){return aF<=aa(aA)?-1:1}else{if((aA=an(aD,aC,true))){return aa(aA)<aE?-1:1}else{aG=X(aD,aC);if(!aG){throw new Error("comparePoints error: nodes have no common ancestor")}aI=(aD===aG)?aG:an(aD,aG,true);aH=(aC===aG)?aG:an(aC,aG,true);if(aI===aH){throw N.createError("comparePoints got to case 4 and childA and childB are the same!")}else{aB=aG.firstChild;while(aB){if(aB===aI){return -1}else{if(aB===aH){return 1}}aB=aB.nextSibling}}}}}}var ad=false;function ac(aA){var aC;try{aC=aA.parentNode;return false}catch(aB){return true}}(function(){var aA=document.createElement("b");aA.innerHTML="1";var aB=aA.firstChild;aA.innerHTML="<br />";ad=ac(aB);P.features.crashyTextNodes=ad})();function ae(aA){if(!aA){return"[No node]"}if(ad&&ac(aA)){return"[Broken node]"}if(O(aA)){return'"'+aA.data+'"'}if(aA.nodeType==1){var aB=aA.id?' id="'+aA.id+'"':"";return"<"+aA.nodeName+aB+">[index:"+aa(aA)+",length:"+aA.childNodes.length+"]["+(aA.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return aA.nodeName}function am(aB){var aA=ax(aB).createDocumentFragment(),aC;while((aC=aB.firstChild)){aA.appendChild(aC)}return aA}var Y;if(typeof window.getComputedStyle!=af){Y=function(aA,aB){return Z(aA).getComputedStyle(aA,null)[aB]}}else{if(typeof document.documentElement.currentStyle!=af){Y=function(aA,aB){return aA.currentStyle[aB]}}else{N.fail("No means of obtaining computed style properties found")}}function ap(aF,aC,aE){var aA=av(aF);var aD=aF.createElement("div");aD.contentEditable=""+!!aE;if(aC){aD.innerHTML=aC}var aB=aA.firstChild;if(aB){aA.insertBefore(aD,aB)}else{aA.appendChild(aD)}return aD}function V(aA){return aA.parentNode.removeChild(aA)}function Q(aA){this.root=aA;this._next=aA}Q.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var aC=this._current=this._next;var aB,aA;if(this._current){aB=aC.firstChild;if(aB){this._next=aB}else{aA=null;while((aC!==this.root)&&!(aA=aC.nextSibling)){aC=aC.parentNode}this._next=aA}}return this._current},detach:function(){this._current=this._next=this.root=null}};function ar(aA){return new Q(aA)}function ab(aA,aB){this.node=aA;this.offset=aB}ab.prototype={equals:function(aA){return !!aA&&this.node===aA.node&&this.offset==aA.offset},inspect:function(){return"[DomPosition("+ae(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function aj(aA){this.code=this[aA];this.codeName=aA;this.message="DOMException: "+this.codeName}aj.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};aj.prototype.toString=function(){return this.message};P.dom={arrayContains:az,isHtmlNamespace:T,parentElement:ag,getNodeIndex:aa,getNodeLength:ai,getCommonAncestor:X,isAncestorOf:W,isOrIsAncestorOf:aq,getClosestAncestorIn:an,isCharacterDataNode:O,isTextOrCommentNode:M,insertAfter:S,splitDataNode:ah,getDocument:ax,getWindow:Z,getIframeWindow:au,getIframeDocument:ay,getBody:av,isWindow:al,getContentDocument:ak,getRootContainer:U,comparePoints:ao,isBrokenNode:ac,inspectNode:ae,getComputedStyleProperty:Y,createTestElement:ap,removeNode:V,fragmentFromNodeChildren:am,createIterator:ar,DomPosition:ab};P.DOMException=aj});h.createCoreModule("DomRange",["DomUtil"],function(aa,a5){var ad=aa.dom;var aT=aa.util;var ar=ad.DomPosition;var aJ=aa.DOMException;var aw=ad.isCharacterDataNode;var O=ad.getNodeIndex;var av=ad.isOrIsAncestorOf;var a6=ad.getDocument;var aV=ad.comparePoints;var a1=ad.splitDataNode;var aM=ad.getClosestAncestorIn;var az=ad.getNodeLength;var a3=ad.arrayContains;var ae=ad.getRootContainer;var ah=aa.features.crashyTextNodes;var aY=ad.removeNode;function aP(a8,a7){return(a8.nodeType!=3)&&(av(a8,a7.startContainer)||av(a8,a7.endContainer))}function aW(a7){return a7.document||a6(a7.startContainer)}function ai(a7){return new ar(a7.parentNode,O(a7))}function T(a7){return new ar(a7.parentNode,O(a7)+1)}function P(a8,ba,a9){var a7=a8.nodeType==11?a8.firstChild:a8;if(aw(ba)){if(a9==ba.length){ad.insertAfter(a8,ba)}else{ba.parentNode.insertBefore(a8,a9==0?ba:a1(ba,a9))}}else{if(a9>=ba.childNodes.length){ba.appendChild(a8)}else{ba.insertBefore(a8,ba.childNodes[a9])}}return a7}function U(ba,a9,a7){M(ba);M(a9);if(aW(a9)!=aW(ba)){throw new aJ("WRONG_DOCUMENT_ERR")}var bb=aV(ba.startContainer,ba.startOffset,a9.endContainer,a9.endOffset),a8=aV(ba.endContainer,ba.endOffset,a9.startContainer,a9.startOffset);return a7?bb<=0&&a8>=0:bb<0&&a8>0}function ab(a9){var a8;for(var ba,bb=aW(a9.range).createDocumentFragment(),a7;ba=a9.next();){a8=a9.isPartiallySelectedSubtree();ba=ba.cloneNode(!a8);if(a8){a7=a9.getSubtreeIterator();ba.appendChild(ab(a7));a7.detach()}if(ba.nodeType==10){throw new aJ("HIERARCHY_REQUEST_ERR")}bb.appendChild(ba)}return bb}function aX(a8,bb,a7){var a9,bd;a7=a7||{stop:false};for(var ba,bc;ba=a8.next();){if(a8.isPartiallySelectedSubtree()){if(bb(ba)===false){a7.stop=true;return}else{bc=a8.getSubtreeIterator();aX(bc,bb,a7);bc.detach();if(a7.stop){return}}}else{a9=ad.createIterator(ba);while((bd=a9.next())){if(bb(bd)===false){a7.stop=true;return}}}}}function ax(a8){var a7;while(a8.next()){if(a8.isPartiallySelectedSubtree()){a7=a8.getSubtreeIterator();ax(a7);a7.detach()}else{a8.remove()}}}function aS(a8){for(var a9,ba=aW(a8.range).createDocumentFragment(),a7;a9=a8.next();){if(a8.isPartiallySelectedSubtree()){a9=a9.cloneNode(false);a7=a8.getSubtreeIterator();a9.appendChild(aS(a7));a7.detach()}else{a8.remove()}if(a9.nodeType==10){throw new aJ("HIERARCHY_REQUEST_ERR")}ba.appendChild(a9)}return ba}function aA(a9,a7,ba){var bc=!!(a7&&a7.length),bb;var bd=!!ba;if(bc){bb=new RegExp("^("+a7.join("|")+")$")}var a8=[];aX(new ag(a9,false),function(bf){if(bc&&!bb.test(bf.nodeType)){return}if(bd&&!ba(bf)){return}var bg=a9.startContainer;if(bf==bg&&aw(bg)&&a9.startOffset==bg.length){return}var be=a9.endContainer;if(bf==be&&aw(be)&&a9.endOffset==0){return}a8.push(bf)});return a8}function a0(a7){var a8=(typeof a7.getName=="undefined")?"Range":a7.getName();return"["+a8+"("+ad.inspectNode(a7.startContainer)+":"+a7.startOffset+", "+ad.inspectNode(a7.endContainer)+":"+a7.endOffset+")]"}function ag(a9,a8){this.range=a9;this.clonePartiallySelectedTextNodes=a8;if(!a9.collapsed){this.sc=a9.startContainer;this.so=a9.startOffset;this.ec=a9.endContainer;this.eo=a9.endOffset;var a7=a9.commonAncestorContainer;if(this.sc===this.ec&&aw(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===a7&&!aw(this.sc))?this.sc.childNodes[this.so]:aM(this.sc,a7,true);this._last=(this.ec===a7&&!aw(this.ec))?this.ec.childNodes[this.eo-1]:aM(this.ec,a7,true)}}}ag.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var a7=this._current=this._next;if(a7){this._next=(a7!==this._last)?a7.nextSibling:null;if(aw(a7)&&this.clonePartiallySelectedTextNodes){if(a7===this.ec){(a7=a7.cloneNode(true)).deleteData(this.eo,a7.length-this.eo)}if(this._current===this.sc){(a7=a7.cloneNode(true)).deleteData(0,this.so)}}}return a7},remove:function(){var a8=this._current,a9,a7;if(aw(a8)&&(a8===this.sc||a8===this.ec)){a9=(a8===this.sc)?this.so:0;a7=(a8===this.ec)?this.eo:a8.length;if(a9!=a7){a8.deleteData(a9,a7-a9)}}else{if(a8.parentNode){aY(a8)}else{}}},isPartiallySelectedSubtree:function(){var a7=this._current;return aP(a7,this.range)},getSubtreeIterator:function(){var a8;if(this.isSingleCharacterDataNode){a8=this.range.cloneRange();a8.collapse(false)}else{a8=new am(aW(this.range));var bc=this._current;var ba=bc,a7=0,bb=bc,a9=az(bc);if(av(bc,this.sc)){ba=this.sc;a7=this.so}if(av(bc,this.ec)){bb=this.ec;a9=this.eo}aO(a8,ba,a7,bb,a9)}return new ag(a8,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var aC=[1,3,4,5,7,8,10];var aU=[2,9,11];var V=[5,6,10,12];var ak=[1,3,4,5,7,8,10,11];var a4=[1,3,4,5,7,8];function Y(a7){return function(a9,bb){var a8,ba=bb?a9:a9.parentNode;while(ba){a8=ba.nodeType;if(a3(a7,a8)){return ba}ba=ba.parentNode}return null}}var a2=Y([9,11]);var aq=Y(V);var aj=Y([6,10,12]);function Z(a8,a7){if(aj(a8,a7)){throw new aJ("INVALID_NODE_TYPE_ERR")}}function N(a7,a8){if(!a3(a8,a7.nodeType)){throw new aJ("INVALID_NODE_TYPE_ERR")}}function aD(a7,a8){if(a8<0||a8>(aw(a7)?a7.length:a7.childNodes.length)){throw new aJ("INDEX_SIZE_ERR")}}function aL(a8,a7){if(a2(a8,true)!==a2(a7,true)){throw new aJ("WRONG_DOCUMENT_ERR")}}function ay(a7){if(aq(a7,true)){throw new aJ("NO_MODIFICATION_ALLOWED_ERR")}}function aF(a8,a7){if(!a8){throw new aJ(a7)}}function aN(a7){return(ah&&ad.isBrokenNode(a7))||!a3(aU,a7.nodeType)&&!a2(a7,true)}function S(a7,a8){return a8<=(aw(a7)?a7.length:a7.childNodes.length)}function an(a7){return(!!a7.startContainer&&!!a7.endContainer&&!aN(a7.startContainer)&&!aN(a7.endContainer)&&S(a7.startContainer,a7.startOffset)&&S(a7.endContainer,a7.endOffset))}function M(a7){if(!an(a7)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+a7.inspect()+")")}}var aE=document.createElement("style");var au=false;try{aE.innerHTML="<b>x</b>";au=(aE.firstChild.nodeType==3)}catch(at){}aa.features.htmlParsingConforms=au;var af=au?function(a9){var a8=this.startContainer;var ba=a6(a8);if(!a8){throw new aJ("INVALID_STATE_ERR")}var a7=null;if(a8.nodeType==1){a7=a8}else{if(aw(a8)){a7=ad.parentElement(a8)}}if(a7===null||(a7.nodeName=="HTML"&&ad.isHtmlNamespace(a6(a7).documentElement)&&ad.isHtmlNamespace(a7))){a7=ba.createElement("body")}else{a7=a7.cloneNode(false)}a7.innerHTML=a9;return ad.fragmentFromNodeChildren(a7)}:function(a8){var a9=aW(this);var a7=a9.createElement("body");a7.innerHTML=a8;return ad.fragmentFromNodeChildren(a7)};function al(a9,a7){M(a9);var bd=a9.startContainer,bc=a9.startOffset,ba=a9.endContainer,a8=a9.endOffset;var bb=(bd===ba);if(aw(ba)&&a8>0&&a8<ba.length){a1(ba,a8,a7)}if(aw(bd)&&bc>0&&bc<bd.length){bd=a1(bd,bc,a7);if(bb){a8-=bc;ba=bd}else{if(ba==bd.parentNode&&a8>=O(bd)){a8++}}bc=0}a9.setStartAndEnd(bd,bc,ba,a8)}function Q(a8){M(a8);var a7=a8.commonAncestorContainer.parentNode.cloneNode(false);a7.appendChild(a8.cloneContents());return a7.innerHTML}var aG=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var aK=0,aQ=1,X=2,R=3;var aH=0,aI=1,aR=2,aB=3;aT.extend(aa.rangePrototype,{compareBoundaryPoints:function(bc,a9){M(this);aL(this.startContainer,a9.startContainer);var be,a8,bd,a7;var bb=(bc==R||bc==aK)?"start":"end";var ba=(bc==aQ||bc==aK)?"start":"end";be=this[bb+"Container"];a8=this[bb+"Offset"];bd=a9[ba+"Container"];a7=a9[ba+"Offset"];return aV(be,a8,bd,a7)},insertNode:function(a8){M(this);N(a8,ak);ay(this.startContainer);if(av(a8,this.startContainer)){throw new aJ("HIERARCHY_REQUEST_ERR")}var a7=P(a8,this.startContainer,this.startOffset);this.setStartBefore(a7)},cloneContents:function(){M(this);var a9,a8;if(this.collapsed){return aW(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&aw(this.startContainer)){a9=this.startContainer.cloneNode(true);a9.data=a9.data.slice(this.startOffset,this.endOffset);a8=aW(this).createDocumentFragment();a8.appendChild(a9);return a8}else{var a7=new ag(this,true);a9=ab(a7);a7.detach()}return a9}},canSurroundContents:function(){M(this);ay(this.startContainer);ay(this.endContainer);var a7=new ag(this,true);var a8=(a7._first&&(aP(a7._first,this))||(a7._last&&aP(a7._last,this)));a7.detach();return !a8},surroundContents:function(a8){N(a8,a4);if(!this.canSurroundContents()){throw new aJ("INVALID_STATE_ERR")}var a7=this.extractContents();if(a8.hasChildNodes()){while(a8.lastChild){a8.removeChild(a8.lastChild)}}P(a8,this.startContainer,this.startOffset);a8.appendChild(a7);this.selectNode(a8)},cloneRange:function(){M(this);var a7=new am(aW(this));var a8=aG.length,a9;while(a8--){a9=aG[a8];a7[a9]=this[a9]}return a7},toString:function(){M(this);var a9=this.startContainer;if(a9===this.endContainer&&aw(a9)){return(a9.nodeType==3||a9.nodeType==4)?a9.data.slice(this.startOffset,this.endOffset):""}else{var a7=[],a8=new ag(this,true);aX(a8,function(ba){if(ba.nodeType==3||ba.nodeType==4){a7.push(ba.data)}});a8.detach();return a7.join("")}},compareNode:function(a9){M(this);var a8=a9.parentNode;var bb=O(a9);if(!a8){throw new aJ("NOT_FOUND_ERR")}var ba=this.comparePoint(a8,bb),a7=this.comparePoint(a8,bb+1);if(ba<0){return(a7>0)?aR:aH}else{return(a7>0)?aI:aB}},comparePoint:function(a7,a8){M(this);aF(a7,"HIERARCHY_REQUEST_ERR");aL(a7,this.startContainer);if(aV(a7,a8,this.startContainer,this.startOffset)<0){return -1}else{if(aV(a7,a8,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:af,toHtml:function(){return Q(this)},intersectsNode:function(ba,a7){M(this);aF(ba,"NOT_FOUND_ERR");if(a6(ba)!==aW(this)){return false}var a9=ba.parentNode,bc=O(ba);aF(a9,"NOT_FOUND_ERR");var bb=aV(a9,bc,this.endContainer,this.endOffset),a8=aV(a9,bc+1,this.startContainer,this.startOffset);return a7?bb<=0&&a8>=0:bb<0&&a8>0},isPointInRange:function(a7,a8){M(this);aF(a7,"HIERARCHY_REQUEST_ERR");aL(a7,this.startContainer);return(aV(a7,a8,this.startContainer,this.startOffset)>=0)&&(aV(a7,a8,this.endContainer,this.endOffset)<=0)},intersectsRange:function(a7){return U(this,a7,false)},intersectsOrTouchesRange:function(a7){return U(this,a7,true)},intersection:function(a7){if(this.intersectsRange(a7)){var ba=aV(this.startContainer,this.startOffset,a7.startContainer,a7.startOffset),a8=aV(this.endContainer,this.endOffset,a7.endContainer,a7.endOffset);var a9=this.cloneRange();if(ba==-1){a9.setStart(a7.startContainer,a7.startOffset)}if(a8==1){a9.setEnd(a7.endContainer,a7.endOffset)}return a9}return null},union:function(a7){if(this.intersectsOrTouchesRange(a7)){var a8=this.cloneRange();if(aV(a7.startContainer,a7.startOffset,this.startContainer,this.startOffset)==-1){a8.setStart(a7.startContainer,a7.startOffset)}if(aV(a7.endContainer,a7.endOffset,this.endContainer,this.endOffset)==1){a8.setEnd(a7.endContainer,a7.endOffset)}return a8}else{throw new aJ("Ranges do not intersect")}},containsNode:function(a8,a7){if(a7){return this.intersectsNode(a8,false)}else{return this.compareNode(a8)==aB}},containsNodeContents:function(a7){return this.comparePoint(a7,0)>=0&&this.comparePoint(a7,az(a7))<=0},containsRange:function(a7){var a8=this.intersection(a7);return a8!==null&&a7.equals(a8)},containsNodeText:function(a9){var ba=this.cloneRange();ba.selectNode(a9);var a8=ba.getNodes([3]);if(a8.length>0){ba.setStart(a8[0],0);var a7=a8.pop();ba.setEnd(a7,a7.length);return this.containsRange(ba)}else{return this.containsNodeContents(a9)}},getNodes:function(a7,a8){M(this);return aA(this,a7,a8)},getDocument:function(){return aW(this)},collapseBefore:function(a7){this.setEndBefore(a7);this.collapse(false)},collapseAfter:function(a7){this.setStartAfter(a7);this.collapse(true)},getBookmark:function(a7){var bb=aW(this);var a9=aa.createRange(bb);a7=a7||ad.getBody(bb);a9.selectNodeContents(a7);var ba=this.intersection(a9);var bc=0,a8=0;if(ba){a9.setEnd(ba.startContainer,ba.startOffset);bc=a9.toString().length;a8=bc+ba.toString().length}return{start:bc,end:a8,containerNode:a7}},moveToBookmark:function(be){var ba=be.containerNode;var a7=0;this.setStart(ba,0);this.collapse(true);var bc=[ba],a8,a9=false,bf=false;var bd,bb,bg;while(!bf&&(a8=bc.pop())){if(a8.nodeType==3){bd=a7+a8.length;if(!a9&&be.start>=a7&&be.start<=bd){this.setStart(a8,be.start-a7);a9=true}if(a9&&be.end>=a7&&be.end<=bd){this.setEnd(a8,be.end-a7);bf=true}a7=bd}else{bg=a8.childNodes;bb=bg.length;while(bb--){bc.push(bg[bb])}}}},getName:function(){return"DomRange"},equals:function(a7){return am.rangesEqual(this,a7)},isValid:function(){return an(this)},inspect:function(){return a0(this)},detach:function(){}});function ao(a7){a7.START_TO_START=aK;a7.START_TO_END=aQ;a7.END_TO_END=X;a7.END_TO_START=R;a7.NODE_BEFORE=aH;a7.NODE_AFTER=aI;a7.NODE_BEFORE_AND_AFTER=aR;a7.NODE_INSIDE=aB}function ac(a7){ao(a7);ao(a7.prototype)}function aZ(a7,a8){return function(){M(this);var be=this.startContainer,bd=this.startOffset,a9=this.commonAncestorContainer;var bb=new ag(this,true);var bc,bf;if(be!==a9){bc=aM(be,a9,true);bf=T(bc);be=bf.node;bd=bf.offset}aX(bb,ay);bb.reset();var ba=a7(bb);bb.detach();a8(this,be,bd,be,bd);return ba}}function W(a8,bc){function bb(be,bd){return function(bf){N(bf,aC);N(ae(bf),aU);var bg=(be?ai:T)(bf);(bd?a7:ba)(this,bg.node,bg.offset)}}function a7(be,bg,bh){var bf=be.endContainer,bd=be.endOffset;if(bg!==be.startContainer||bh!==be.startOffset){if(ae(bg)!=ae(bf)||aV(bg,bh,bf,bd)==1){bf=bg;bd=bh}bc(be,bg,bh,bf,bd)}}function ba(bd,be,bh){var bg=bd.startContainer,bf=bd.startOffset;if(be!==bd.endContainer||bh!==bd.endOffset){if(ae(be)!=ae(bg)||aV(be,bh,bg,bf)==-1){bg=be;bf=bh}bc(bd,bg,bf,be,bh)}}var a9=function(){};a9.prototype=aa.rangePrototype;a8.prototype=new a9();aT.extend(a8.prototype,{setStart:function(bd,be){Z(bd,true);aD(bd,be);a7(this,bd,be)},setEnd:function(bd,be){Z(bd,true);aD(bd,be);ba(this,bd,be)},setStartAndEnd:function(){var bf=arguments;var bh=bf[0],bg=bf[1],be=bh,bd=bg;switch(bf.length){case 3:bd=bf[2];break;case 4:be=bf[2];bd=bf[3];break}bc(this,bh,bg,be,bd)},setBoundary:function(be,bf,bd){this["set"+(bd?"Start":"End")](be,bf)},setStartBefore:bb(true,true),setStartAfter:bb(false,true),setEndBefore:bb(true,false),setEndAfter:bb(false,false),collapse:function(bd){M(this);if(bd){bc(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{bc(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(bd){Z(bd,true);bc(this,bd,0,bd,az(bd))},selectNode:function(be){Z(be,false);N(be,aC);var bf=ai(be),bd=T(be);bc(this,bf.node,bf.offset,bd.node,bd.offset)},extractContents:aZ(aS,bc),deleteContents:aZ(ax,bc),canSurroundContents:function(){M(this);ay(this.startContainer);ay(this.endContainer);var bd=new ag(this,true);var be=(bd._first&&aP(bd._first,this)||(bd._last&&aP(bd._last,this)));bd.detach();return !be},splitBoundaries:function(){al(this)},splitBoundariesPreservingPositions:function(bd){al(this,bd)},normalizeBoundaries:function(){M(this);var bk=this.startContainer,bf=this.startOffset,bj=this.endContainer,bd=this.endOffset;var bg=function(bn){var bm=bn.nextSibling;if(bm&&bm.nodeType==bn.nodeType){bj=bn;bd=bn.length;bn.appendData(bm.data);aY(bm)}};var bl=function(bo){var bn=bo.previousSibling;if(bn&&bn.nodeType==bo.nodeType){bk=bo;var bm=bo.length;bf=bn.length;bo.insertData(0,bn.data);aY(bn);if(bk==bj){bd+=bf;bj=bk}else{if(bj==bo.parentNode){var bp=O(bo);if(bd==bp){bj=bo;bd=bm}else{if(bd>bp){bd--}}}}}};var bi=true;if(aw(bj)){if(bj.length==bd){bg(bj)}}else{if(bd>0){var bh=bj.childNodes[bd-1];if(bh&&aw(bh)){bg(bh)}}bi=!this.collapsed}if(bi){if(aw(bk)){if(bf==0){bl(bk)}}else{if(bf<bk.childNodes.length){var be=bk.childNodes[bf];if(be&&aw(be)){bl(be)}}}}else{bk=bj;bf=bd}bc(this,bk,bf,bj,bd)},collapseToPoint:function(bd,be){Z(bd,true);aD(bd,be);this.setStartAndEnd(bd,be)}});ac(a8)}function ap(a7){a7.collapsed=(a7.startContainer===a7.endContainer&&a7.startOffset===a7.endOffset);a7.commonAncestorContainer=a7.collapsed?a7.startContainer:ad.getCommonAncestor(a7.startContainer,a7.endContainer)}function aO(a8,ba,a7,bb,a9){a8.startContainer=ba;a8.startOffset=a7;a8.endContainer=bb;a8.endOffset=a9;a8.document=ad.getDocument(ba);ap(a8)}function am(a7){this.startContainer=a7;this.startOffset=0;this.endContainer=a7;this.endOffset=0;this.document=a7;ap(this)}W(am,aO);aT.extend(am,{rangeProperties:aG,RangeIterator:ag,copyComparisonConstants:ac,createPrototypeRange:W,inspect:a0,toHtml:Q,getRangeDocument:aW,rangesEqual:function(a8,a7){return a8.startContainer===a7.startContainer&&a8.startOffset===a7.startOffset&&a8.endContainer===a7.endContainer&&a8.endOffset===a7.endOffset}});aa.DomRange=am});h.createCoreModule("WrappedRange",["DomRange"],function(Y,Q){var M,N;var U=Y.dom;var V=Y.util;var P=U.DomPosition;var aa=Y.DomRange;var W=U.getBody;var ac=U.getContentDocument;var X=U.isCharacterDataNode;if(Y.features.implementsDomRange){(function(){var ag;var an=aa.rangeProperties;function ad(ap){var aq=an.length,ar;while(aq--){ar=an[aq];ap[ar]=ap.nativeRange[ar]}ap.collapsed=(ap.startContainer===ap.endContainer&&ap.startOffset===ap.endOffset)}function ai(ar,av,aq,aw,at){var ap=(ar.startContainer!==av||ar.startOffset!=aq);var ax=(ar.endContainer!==aw||ar.endOffset!=at);var au=!ar.equals(ar.nativeRange);if(ap||ax||au){ar.setEnd(aw,at);ar.setStart(av,aq)}}var af;M=function(ap){if(!ap){throw Q.createError("WrappedRange: Range must be specified")}this.nativeRange=ap;ad(this)};aa.createPrototypeRange(M,ai);ag=M.prototype;ag.selectNode=function(ap){this.nativeRange.selectNode(ap);ad(this)};ag.cloneContents=function(){return this.nativeRange.cloneContents()};ag.surroundContents=function(ap){this.nativeRange.surroundContents(ap);ad(this)};ag.collapse=function(ap){this.nativeRange.collapse(ap);ad(this)};ag.cloneRange=function(){return new M(this.nativeRange.cloneRange())};ag.refresh=function(){ad(this)};ag.toString=function(){return this.nativeRange.toString()};var am=document.createTextNode("test");W(document).appendChild(am);var aj=document.createRange();aj.setStart(am,0);aj.setEnd(am,0);try{aj.setStart(am,1);ag.setStart=function(ap,aq){this.nativeRange.setStart(ap,aq);ad(this)};ag.setEnd=function(ap,aq){this.nativeRange.setEnd(ap,aq);ad(this)};af=function(ap){return function(aq){this.nativeRange[ap](aq);ad(this)}}}catch(al){ag.setStart=function(aq,ar){try{this.nativeRange.setStart(aq,ar)}catch(ap){this.nativeRange.setEnd(aq,ar);this.nativeRange.setStart(aq,ar)}ad(this)};ag.setEnd=function(aq,ar){try{this.nativeRange.setEnd(aq,ar)}catch(ap){this.nativeRange.setStart(aq,ar);this.nativeRange.setEnd(aq,ar)}ad(this)};af=function(ap,aq){return function(at){try{this.nativeRange[ap](at)}catch(ar){this.nativeRange[aq](at);this.nativeRange[ap](at)}ad(this)}}}ag.setStartBefore=af("setStartBefore","setEndBefore");ag.setStartAfter=af("setStartAfter","setEndAfter");ag.setEndBefore=af("setEndBefore","setStartBefore");ag.setEndAfter=af("setEndAfter","setStartAfter");ag.selectNodeContents=function(ap){this.setStartAndEnd(ap,0,U.getNodeLength(ap))};aj.selectNodeContents(am);aj.setEnd(am,3);var ao=document.createRange();ao.selectNodeContents(am);ao.setEnd(am,4);ao.setStart(am,2);if(aj.compareBoundaryPoints(aj.START_TO_END,ao)==-1&&aj.compareBoundaryPoints(aj.END_TO_START,ao)==1){ag.compareBoundaryPoints=function(aq,ap){ap=ap.nativeRange||ap;if(aq==ap.START_TO_END){aq=ap.END_TO_START}else{if(aq==ap.END_TO_START){aq=ap.START_TO_END}}return this.nativeRange.compareBoundaryPoints(aq,ap)}}else{ag.compareBoundaryPoints=function(aq,ap){return this.nativeRange.compareBoundaryPoints(aq,ap.nativeRange||ap)}}var ae=document.createElement("div");ae.innerHTML="123";var ah=ae.firstChild;var ak=W(document);ak.appendChild(ae);aj.setStart(ah,1);aj.setEnd(ah,2);aj.deleteContents();if(ah.data=="13"){ag.deleteContents=function(){this.nativeRange.deleteContents();ad(this)};ag.extractContents=function(){var ap=this.nativeRange.extractContents();ad(this);return ap}}else{}ak.removeChild(ae);ak=null;if(V.isHostMethod(aj,"createContextualFragment")){ag.createContextualFragment=function(ap){return this.nativeRange.createContextualFragment(ap)}}W(document).removeChild(am);ag.getName=function(){return"WrappedRange"};Y.WrappedRange=M;Y.createNativeRange=function(ap){ap=ac(ap,Q,"createNativeRange");return ap.createRange()}})()}if(Y.features.implementsTextRange){var R=function(ai){var ag=ai.parentElement();var ae=ai.duplicate();ae.collapse(true);var ah=ae.parentElement();ae=ai.duplicate();ae.collapse(false);var af=ae.parentElement();var ad=(ah==af)?ah:U.getCommonAncestor(ah,af);return ad==ag?ad:U.getCommonAncestor(ag,ad)};var O=function(ad){return ad.compareEndPoints("StartToEnd",ad)==0};var S=function(ad,ap,an,ae,ah){var aq=ad.duplicate();aq.collapse(an);var af=aq.parentElement();if(!U.isOrIsAncestorOf(ap,af)){af=ap}if(!af.canHaveHTML){var am=new P(af.parentNode,U.getNodeIndex(af));return{boundaryPosition:am,nodeInfo:{nodeIndex:am.offset,containerElement:am.node}}}var ag=U.getDocument(af).createElement("span");if(ag.parentNode){U.removeNode(ag)}var az,ax=an?"StartToStart":"StartToEnd";var ar,ai,ao,at;var ak=(ah&&ah.containerElement==af)?ah.nodeIndex:0;var au=af.childNodes.length;var aj=au;var aw=aj;while(true){if(aw==au){af.appendChild(ag)}else{af.insertBefore(ag,af.childNodes[aw])}aq.moveToElementText(ag);az=aq.compareEndPoints(ax,ad);if(az==0||ak==aj){break}else{if(az==-1){if(aj==ak+1){break}else{ak=aw}}else{aj=(aj==ak+1)?ak:aw}}aw=Math.floor((ak+aj)/2);af.removeChild(ag)}at=ag.nextSibling;if(az==-1&&at&&X(at)){aq.setEndPoint(an?"EndToStart":"EndToEnd",ad);var al;if(/[\r\n]/.test(at.data)){var av=aq.duplicate();var ay=av.text.replace(/\r\n/g,"\r").length;al=av.moveStart("character",ay);while((az=av.compareEndPoints("StartToEnd",av))==-1){al++;av.moveStart("character",1)}}else{al=aq.text.length}ao=new P(at,al)}else{ar=(ae||!an)&&ag.previousSibling;ai=(ae||an)&&ag.nextSibling;if(ai&&X(ai)){ao=new P(ai,0)}else{if(ar&&X(ar)){ao=new P(ar,ar.data.length)}else{ao=new P(af,U.getNodeIndex(ag))}}}U.removeNode(ag);return{boundaryPosition:ao,nodeInfo:{nodeIndex:aw,containerElement:af}}};var ab=function(ad,af){var ag,aj,ah=ad.offset;var ak=U.getDocument(ad.node);var ae,al,am=W(ak).createTextRange();var ai=X(ad.node);if(ai){ag=ad.node;aj=ag.parentNode}else{al=ad.node.childNodes;ag=(ah<al.length)?al[ah]:null;aj=ad.node}ae=ak.createElement("span");ae.innerHTML="&#feff;";if(ag){aj.insertBefore(ae,ag)}else{aj.appendChild(ae)}am.moveToElementText(ae);am.collapse(!af);aj.removeChild(ae);if(ai){am[af?"moveStart":"moveEnd"]("character",ah)}return am};N=function(ad){this.textRange=ad;this.refresh()};N.prototype=new aa(document);N.prototype.refresh=function(){var ag,ad,af;var ae=R(this.textRange);if(O(this.textRange)){ad=ag=S(this.textRange,ae,true,true).boundaryPosition}else{af=S(this.textRange,ae,true,false);ag=af.boundaryPosition;ad=S(this.textRange,ae,false,false,af.nodeInfo).boundaryPosition}this.setStart(ag.node,ag.offset);this.setEnd(ad.node,ad.offset)};N.prototype.getName=function(){return"WrappedTextRange"};aa.copyComparisonConstants(N);var Z=function(ad){if(ad.collapsed){return ab(new P(ad.startContainer,ad.startOffset),true)}else{var ag=ab(new P(ad.startContainer,ad.startOffset),true);var af=ab(new P(ad.endContainer,ad.endOffset),false);var ae=W(aa.getRangeDocument(ad)).createTextRange();ae.setEndPoint("StartToStart",ag);ae.setEndPoint("EndToEnd",af);return ae}};N.rangeToTextRange=Z;N.prototype.toTextRange=function(){return Z(this)};Y.WrappedTextRange=N;if(!Y.features.implementsDomRange||Y.config.preferTextRange){var T=(function(ad){return ad("return this;")()})(Function);if(typeof T.Range=="undefined"){T.Range=N}Y.createNativeRange=function(ad){ad=ac(ad,Q,"createNativeRange");return W(ad).createTextRange()};Y.WrappedRange=N}}Y.createRange=function(ad){ad=ac(ad,Q,"createRange");return new Y.WrappedRange(Y.createNativeRange(ad))};Y.createRangyRange=function(ad){ad=ac(ad,Q,"createRangyRange");return new aa(ad)};Y.createIframeRange=function(ad){Q.deprecationNotice("createIframeRange()","createRange(iframeEl)");return Y.createRange(ad)};Y.createIframeRangyRange=function(ad){Q.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)");return Y.createRangyRange(ad)};Y.addShimListener(function(ae){var ad=ae.document;if(typeof ad.createRange=="undefined"){ad.createRange=function(){return Y.createRange(ad)}}ad=ae=null})});h.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(V,P){V.config.checkSelectionRanges=true;var av="boolean";var ay="number";var O=V.dom;var aa=V.util;var aJ=aa.isHostMethod;var aN=V.DomRange;var R=V.WrappedRange;var aI=V.DOMException;var ap=O.DomPosition;var aF;var ac;var Z=V.features;var aV="Control";var aU=O.getDocument;var aT=O.getBody;var aA=aN.rangesEqual;function S(aX){return(typeof aX=="string")?/^backward(s)?$/i.test(aX):!!aX}function al(aZ,aX){if(!aZ){return window}else{if(O.isWindow(aZ)){return aZ}else{if(aZ instanceof ar){return aZ.win}else{var aY=O.getContentDocument(aZ,P,aX);return O.getWindow(aY)}}}}function ab(aX){return al(aX,"getWinSelection").getSelection()}function af(aX){return al(aX,"getDocSelection").document.selection}function aS(aX){var aY=false;if(aX.anchorNode){aY=(O.comparePoints(aX.anchorNode,aX.anchorOffset,aX.focusNode,aX.focusOffset)==1)}return aY}var aQ=aJ(window,"getSelection"),aH=aa.isHostObject(document,"selection");Z.implementsWinGetSelection=aQ;Z.implementsDocSelection=aH;var ai=aH&&(!aQ||V.config.preferTextRange);if(ai){aF=af;V.isSelectionValid=function(aY){var aZ=al(aY,"isSelectionValid").document,aX=aZ.selection;return(aX.type!="None"||aU(aX.createRange().parentElement())==aZ)}}else{if(aQ){aF=ab;V.isSelectionValid=function(){return true}}else{P.fail("Neither document.selection or window.getSelection() detected.");return false}}V.getNativeSelection=aF;var aG=aF();if(!aG){P.fail("Native selection was null (possibly issue 138?)");return false}var at=V.createNativeRange(document);var au=aT(document);var aD=aa.areHostProperties(aG,["anchorNode","focusNode","anchorOffset","focusOffset"]);Z.selectionHasAnchorAndFocus=aD;var ae=aJ(aG,"extend");Z.selectionHasExtend=ae;var aW=(typeof aG.rangeCount==ay);Z.selectionHasRangeCount=aW;var aM=false;var aK=true;var am=ae?function(a0,aX){var aZ=aN.getRangeDocument(aX);var aY=V.createRange(aZ);aY.collapseToPoint(aX.endContainer,aX.endOffset);a0.addRange(aC(aY));a0.extend(aX.startContainer,aX.startOffset)}:null;if(aa.areHostMethods(aG,["addRange","getRangeAt","removeAllRanges"])&&typeof aG.rangeCount==ay&&Z.implementsDomRange){(function(){var aY=window.getSelection();if(aY){var a2=aY.rangeCount;var a4=(a2>1);var a5=[];var a7=aS(aY);for(var a3=0;a3<a2;++a3){a5[a3]=aY.getRangeAt(a3)}var a0=O.createTestElement(document,"",false);var a1=a0.appendChild(document.createTextNode("\u00a0\u00a0\u00a0"));var aZ=document.createRange();aZ.setStart(a1,1);aZ.collapse(true);aY.removeAllRanges();aY.addRange(aZ);aK=(aY.rangeCount==1);aY.removeAllRanges();if(!a4){var a6=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(a6&&parseInt(a6[1])>=36){aM=false}else{var aX=aZ.cloneRange();aZ.setStart(a1,0);aX.setEnd(a1,3);aX.setStart(a1,2);aY.addRange(aZ);aY.addRange(aX);aM=(aY.rangeCount==2)}}O.removeNode(a0);aY.removeAllRanges();for(a3=0;a3<a2;++a3){if(a3==0&&a7){if(am){am(aY,a5[a3])}else{V.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");aY.addRange(a5[a3])}}else{aY.addRange(a5[a3])}}}})()}Z.selectionSupportsMultipleRanges=aM;Z.collapsedNonEditableSelectionsSupported=aK;var U=false,X;if(au&&aJ(au,"createControlRange")){X=au.createControlRange();if(aa.areHostProperties(X,["item","add"])){U=true}}Z.implementsControlRange=U;if(aD){ac=function(aX){return aX.anchorNode===aX.focusNode&&aX.anchorOffset===aX.focusOffset}}else{ac=function(aX){return aX.rangeCount?aX.getRangeAt(aX.rangeCount-1).collapsed:false}}function N(aZ,aX,a0){var aY=a0?"end":"start",a1=a0?"start":"end";aZ.anchorNode=aX[aY+"Container"];aZ.anchorOffset=aX[aY+"Offset"];aZ.focusNode=aX[a1+"Container"];aZ.focusOffset=aX[a1+"Offset"]}function ak(aY){var aX=aY.nativeSelection;aY.anchorNode=aX.anchorNode;aY.anchorOffset=aX.anchorOffset;aY.focusNode=aX.focusNode;aY.focusOffset=aX.focusOffset}function az(aX){aX.anchorNode=aX.focusNode=null;aX.anchorOffset=aX.focusOffset=0;aX.rangeCount=0;aX.isCollapsed=true;aX._ranges.length=0}function aC(aX){var aY;if(aX instanceof aN){aY=V.createNativeRange(aX.getDocument());aY.setEnd(aX.endContainer,aX.endOffset);aY.setStart(aX.startContainer,aX.startOffset)}else{if(aX instanceof R){aY=aX.nativeRange}else{if(Z.implementsDomRange&&(aX instanceof O.getWindow(aX.startContainer).Range)){aY=aX}}}return aY}function Y(aZ){if(!aZ.length||aZ[0].nodeType!=1){return false}for(var aY=1,aX=aZ.length;aY<aX;++aY){if(!O.isAncestorOf(aZ[0],aZ[aY])){return false}}return true}function aE(aY){var aX=aY.getNodes();if(!Y(aX)){throw P.createError("getSingleElementFromRange: range "+aY.inspect()+" did not consist of a single element")}return aX[0]}function ax(aX){return !!aX&&typeof aX.text!="undefined"}function aB(aZ,aY){var aX=new R(aY);aZ._ranges=[aX];N(aZ,aX,false);aZ.rangeCount=1;aZ.isCollapsed=aX.collapsed}function ah(a0){a0._ranges.length=0;if(a0.docSelection.type=="None"){az(a0)}else{var aZ=a0.docSelection.createRange();if(ax(aZ)){aB(a0,aZ)}else{a0.rangeCount=aZ.length;var aX,a1=aU(aZ.item(0));for(var aY=0;aY<a0.rangeCount;++aY){aX=V.createRange(a1);aX.selectNode(aZ.item(aY));a0._ranges.push(aX)}a0.isCollapsed=a0.rangeCount==1&&a0._ranges[0].collapsed;N(a0,a0._ranges[a0.rangeCount-1],false)}}}function ao(aY,a1){var aZ=aY.docSelection.createRange();var aX=aE(a1);var a5=aU(aZ.item(0));var a2=aT(a5).createControlRange();for(var a0=0,a3=aZ.length;a0<a3;++a0){a2.add(aZ.item(a0))}try{a2.add(aX)}catch(a4){throw P.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a2.select();ah(aY)}var ad;if(aJ(aG,"getRangeAt")){ad=function(aZ,aX){try{return aZ.getRangeAt(aX)}catch(aY){return null}}}else{if(aD){ad=function(aY){var aZ=aU(aY.anchorNode);var aX=V.createRange(aZ);aX.setStartAndEnd(aY.anchorNode,aY.anchorOffset,aY.focusNode,aY.focusOffset);if(aX.collapsed!==this.isCollapsed){aX.setStartAndEnd(aY.focusNode,aY.focusOffset,aY.anchorNode,aY.anchorOffset)}return aX}}}function ar(aX,aZ,aY){this.nativeSelection=aX;this.docSelection=aZ;this._ranges=[];this.win=aY;this.refresh()}ar.prototype=V.selectionPrototype;function an(aX){aX.win=aX.anchorNode=aX.focusNode=aX._ranges=null;aX.rangeCount=aX.anchorOffset=aX.focusOffset=0;aX.detached=true}var aR=[];function aL(a1,a0){var aX=aR.length,aY,aZ;while(aX--){aY=aR[aX];aZ=aY.selection;if(a0=="deleteAll"){an(aZ)}else{if(aY.win==a1){if(a0=="delete"){aR.splice(aX,1);return true}else{return aZ}}}}if(a0=="deleteAll"){aR.length=0}return null}var aj=function(aZ){if(aZ&&aZ instanceof ar){aZ.refresh();return aZ}aZ=al(aZ,"getNativeSelection");var aY=aL(aZ);var aX=aF(aZ),a0=aH?af(aZ):null;if(aY){aY.nativeSelection=aX;aY.docSelection=a0;aY.refresh()}else{aY=new ar(aX,a0,aZ);aR.push({win:aZ,selection:aY})}return aY};V.getSelection=aj;V.getIframeSelection=function(aX){P.deprecationNotice("getIframeSelection()","getSelection(iframeEl)");return V.getSelection(O.getIframeWindow(aX))};var M=ar.prototype;function W(a3,aY){var a4=aU(aY[0].startContainer);var a1=aT(a4).createControlRange();for(var a0=0,a2,aX=aY.length;a0<aX;++a0){a2=aE(aY[a0]);try{a1.add(a2)}catch(aZ){throw P.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}a1.select();ah(a3)}if(!ai&&aD&&aa.areHostMethods(aG,["removeAllRanges","addRange"])){M.removeAllRanges=function(){this.nativeSelection.removeAllRanges();az(this)};var Q=function(aY,aX){am(aY.nativeSelection,aX);aY.refresh()};if(aW){M.addRange=function(aY,a2){if(U&&aH&&this.docSelection.type==aV){ao(this,aY)}else{if(S(a2)&&ae){Q(this,aY)}else{var a0;if(aM){a0=this.rangeCount}else{this.removeAllRanges();a0=0}var aX=aC(aY).cloneRange();try{this.nativeSelection.addRange(aX)}catch(aZ){}this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==a0+1){if(V.config.checkSelectionRanges){var a1=ad(this.nativeSelection,this.rangeCount-1);if(a1&&!aA(a1,aY)){aY=new R(a1)}}this._ranges[this.rangeCount-1]=aY;N(this,aY,T(this.nativeSelection));this.isCollapsed=ac(this)}else{this.refresh()}}}}}else{M.addRange=function(aX,aY){if(S(aY)&&ae){Q(this,aX)}else{this.nativeSelection.addRange(aC(aX));this.refresh()}}}M.setRanges=function(aY){if(U&&aH&&aY.length>1){W(this,aY)}else{this.removeAllRanges();for(var aZ=0,aX=aY.length;aZ<aX;++aZ){this.addRange(aY[aZ])}}}}else{if(aJ(aG,"empty")&&aJ(at,"select")&&U&&ai){M.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a0;if(this.anchorNode){a0=aU(this.anchorNode)}else{if(this.docSelection.type==aV){var aY=this.docSelection.createRange();if(aY.length){a0=aU(aY.item(0))}}}if(a0){var aZ=aT(a0).createTextRange();aZ.select();this.docSelection.empty()}}}catch(aX){}az(this)};M.addRange=function(aX){if(this.docSelection.type==aV){ao(this,aX)}else{V.WrappedTextRange.rangeToTextRange(aX).select();this._ranges[0]=aX;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;N(this,aX,false)}};M.setRanges=function(aX){this.removeAllRanges();var aY=aX.length;if(aY>1){W(this,aX)}else{if(aY){this.addRange(aX[0])}}}}else{P.fail("No means of selecting a Range or TextRange was found");return false}}M.getRangeAt=function(aX){if(aX<0||aX>=this.rangeCount){throw new aI("INDEX_SIZE_ERR")}else{return this._ranges[aX].cloneRange()}};var aw;if(ai){aw=function(aY){var aX;if(V.isSelectionValid(aY.win)){aX=aY.docSelection.createRange()}else{aX=aT(aY.win.document).createTextRange();aX.collapse(true)}if(aY.docSelection.type==aV){ah(aY)}else{if(ax(aX)){aB(aY,aX)}else{az(aY)}}}}else{if(aJ(aG,"getRangeAt")&&typeof aG.rangeCount==ay){aw=function(aZ){if(U&&aH&&aZ.docSelection.type==aV){ah(aZ)}else{aZ._ranges.length=aZ.rangeCount=aZ.nativeSelection.rangeCount;if(aZ.rangeCount){for(var aY=0,aX=aZ.rangeCount;aY<aX;++aY){aZ._ranges[aY]=new V.WrappedRange(aZ.nativeSelection.getRangeAt(aY))}N(aZ,aZ._ranges[aZ.rangeCount-1],T(aZ.nativeSelection));aZ.isCollapsed=ac(aZ)}else{az(aZ)}}}}else{if(aD&&typeof aG.isCollapsed==av&&typeof at.collapsed==av&&Z.implementsDomRange){aw=function(aZ){var aX,aY=aZ.nativeSelection;if(aY.anchorNode){aX=ad(aY,0);aZ._ranges=[aX];aZ.rangeCount=1;ak(aZ);aZ.isCollapsed=ac(aZ)}else{az(aZ)}}}else{P.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}M.refresh=function(aY){var aX=aY?this._ranges.slice(0):null;var a0=this.anchorNode,a1=this.anchorOffset;aw(this);if(aY){var aZ=aX.length;if(aZ!=this._ranges.length){return true}if(this.anchorNode!=a0||this.anchorOffset!=a1){return true}while(aZ--){if(!aA(aX[aZ],this._ranges[aZ])){return true}}return false}};var aq=function(a1,aZ){var aY=a1.getAllRanges();a1.removeAllRanges();for(var a0=0,aX=aY.length;a0<aX;++a0){if(!aA(aZ,aY[a0])){a1.addRange(aY[a0])}}if(!a1.rangeCount){az(a1)}};if(U&&aH){M.removeRange=function(a1){if(this.docSelection.type==aV){var aZ=this.docSelection.createRange();var aX=aE(a1);var a5=aU(aZ.item(0));var a3=aT(a5).createControlRange();var aY,a4=false;for(var a0=0,a2=aZ.length;a0<a2;++a0){aY=aZ.item(a0);if(aY!==aX||a4){a3.add(aZ.item(a0))}else{a4=true}}a3.select();ah(this)}else{aq(this,a1)}}}else{M.removeRange=function(aX){aq(this,aX)}}var T;if(!ai&&aD&&Z.implementsDomRange){T=aS;M.isBackward=function(){return T(this)}}else{T=M.isBackward=function(){return false}}M.isBackwards=M.isBackward;M.toString=function(){var aZ=[];for(var aY=0,aX=this.rangeCount;aY<aX;++aY){aZ[aY]=""+this._ranges[aY]}return aZ.join("")};function aO(aY,aX){if(aY.win.document!=aU(aX)){throw new aI("WRONG_DOCUMENT_ERR")}}M.collapse=function(aY,aZ){aO(this,aY);var aX=V.createRange(aY);aX.collapseToPoint(aY,aZ);this.setSingleRange(aX);this.isCollapsed=true};M.collapseToStart=function(){if(this.rangeCount){var aX=this._ranges[0];this.collapse(aX.startContainer,aX.startOffset)}else{throw new aI("INVALID_STATE_ERR")}};M.collapseToEnd=function(){if(this.rangeCount){var aX=this._ranges[this.rangeCount-1];this.collapse(aX.endContainer,aX.endOffset)}else{throw new aI("INVALID_STATE_ERR")}};M.selectAllChildren=function(aY){aO(this,aY);var aX=V.createRange(aY);aX.selectNodeContents(aY);this.setSingleRange(aX)};M.deleteFromDocument=function(){if(U&&aH&&this.docSelection.type==aV){var a1=this.docSelection.createRange();var a0;while(a1.length){a0=a1.item(0);a1.remove(a0);O.removeNode(a0)}this.refresh()}else{if(this.rangeCount){var aY=this.getAllRanges();if(aY.length){this.removeAllRanges();for(var aZ=0,aX=aY.length;aZ<aX;++aZ){aY[aZ].deleteContents()}this.addRange(aY[aX-1])}}}};M.eachRange=function(a0,aZ){for(var aY=0,aX=this._ranges.length;aY<aX;++aY){if(a0(this.getRangeAt(aY))){return aZ}}};M.getAllRanges=function(){var aX=[];this.eachRange(function(aY){aX.push(aY)});return aX};M.setSingleRange=function(aX,aY){this.removeAllRanges();this.addRange(aX,aY)};M.callMethodOnEachRange=function(aX,aZ){var aY=[];this.eachRange(function(a0){aY.push(a0[aX].apply(a0,aZ))});return aY};function aP(aX){return function(aZ,a0){var aY;if(this.rangeCount){aY=this.getRangeAt(0);aY["set"+(aX?"Start":"End")](aZ,a0)}else{aY=V.createRange(this.win.document);aY.setStartAndEnd(aZ,a0)}this.setSingleRange(aY,this.isBackward())}}M.setStart=aP(true);M.setEnd=aP(false);V.rangePrototype.select=function(aX){aj(this.getDocument()).setSingleRange(this,aX)};M.changeEachRange=function(aY){var aX=[];var aZ=this.isBackward();this.eachRange(function(a0){aY(a0);aX.push(a0)});this.removeAllRanges();if(aZ&&aX.length==1){this.addRange(aX[0],"backward")}else{this.setRanges(aX)}};M.containsNode=function(aY,aX){return this.eachRange(function(aZ){return aZ.containsNode(aY,aX)},true)||false};M.getBookmark=function(aX){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[aX])}};M.moveToBookmark=function(a1){var aX=[];for(var a0=0,aZ,aY;aZ=a1.rangeBookmarks[a0++];){aY=V.createRange(this.win);aY.moveToBookmark(aZ);aX.push(aY)}if(a1.backward){this.setSingleRange(aX[0],"backward")}else{this.setRanges(aX)}};M.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}};M.restoreRanges=function(aX){this.removeAllRanges();for(var aZ=0,aY;aY=aX.ranges[aZ];++aZ){this.addRange(aY,(aX.backward&&aZ==0))}};M.toHtml=function(){var aX=[];this.eachRange(function(aY){aX.push(aN.toHtml(aY))});return aX.join("")};if(Z.implementsTextRange){M.getNativeTextRange=function(){var aZ,aY;if((aZ=this.docSelection)){var aX=aZ.createRange();if(ax(aX)){return aX}else{throw P.createError("getNativeTextRange: selection is a control selection")}}else{if(this.rangeCount>0){return V.WrappedTextRange.rangeToTextRange(this.getRangeAt(0))}else{throw P.createError("getNativeTextRange: selection contains no range")}}}}function ag(a3){var a2=[];var a0=new ap(a3.anchorNode,a3.anchorOffset);var aY=new ap(a3.focusNode,a3.focusOffset);var aZ=(typeof a3.getName=="function")?a3.getName():"Selection";if(typeof a3.rangeCount!="undefined"){for(var a1=0,aX=a3.rangeCount;a1<aX;++a1){a2[a1]=aN.inspect(a3.getRangeAt(a1))}}return"["+aZ+"(Ranges: "+a2.join(", ")+")(anchor: "+a0.inspect()+", focus: "+aY.inspect()+"]"}M.getName=function(){return"WrappedSelection"};M.inspect=function(){return ag(this)};M.detach=function(){aL(this.win,"delete");an(this)};ar.detachAll=function(){aL(null,"deleteAll")};ar.inspect=ag;ar.isDirectionBackward=S;V.Selection=ar;V.selectionPrototype=M;V.addShimListener(function(aX){if(typeof aX.getSelection=="undefined"){aX.getSelection=function(){return aj(aX)}}aX=null})});var e=false;var J=function(M){if(!e){e=true;if(!h.initialized&&h.config.autoInitialize){I()}}};if(C){if(document.readyState=="complete"){J()}else{if(D(document,"addEventListener")){document.addEventListener("DOMContentLoaded",J,false)}i(window,"load",J)}}return h},this);
(function(b,a){if(typeof define=="function"&&define.amd){define(["./rangy-core"],b)}else{if(typeof module!="undefined"&&typeof exports=="object"){module.exports=b(require("rangy"))}else{b(a.rangy)}}})(function(a){a.createModule("Highlighter",["ClassApplier"],function(j,b){var m=j.dom;var i=m.arrayContains;var s=m.getBody;var l=j.util.createOptions;var n=j.util.forEach;var k=1;function p(u,t){return u.characterRange.start-t.characterRange.start}function g(t,u){return u?t.getElementById(u):s(t)}var d={};function o(t,u){this.type=t;this.converterCreator=u}o.prototype.create=function(){var t=this.converterCreator();t.type=this.type;return t};function q(t,u){d[t]=new o(t,u)}function c(u){var t=d[u];if(t instanceof o){return t.create()}else{throw new Error("Highlighter type '"+u+"' is not valid")}}j.registerHighlighterType=q;function e(u,t){this.start=u;this.end=t}e.prototype={intersects:function(t){return this.start<t.end&&this.end>t.start},isContiguousWith:function(t){return this.start==t.end||this.end==t.start},union:function(t){return new e(Math.min(this.start,t.start),Math.max(this.end,t.end))},intersection:function(t){return new e(Math.max(this.start,t.start),Math.min(this.end,t.end))},getComplements:function(u){var t=[];if(this.start>=u.start){if(this.end<=u.end){return[]}t.push(new e(u.end,this.end))}else{t.push(new e(this.start,Math.min(this.end,u.start)));if(this.end>u.end){t.push(new e(u.end,this.end))}}return t},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}};e.fromCharacterRange=function(t){return new e(t.start,t.end)};var r={rangeToCharacterRange:function(u,t){var v=u.getBookmark(t);return new e(v.start,v.end)},characterRangeToRange:function(v,w,t){var u=j.createRange(v);u.moveToBookmark({start:w.start,end:w.end,containerNode:t});return u},serializeSelection:function(y,u){var v=y.getAllRanges(),w=v.length;var z=[];var A=w==1&&y.isBackward();for(var x=0,t=v.length;x<t;++x){z[x]={characterRange:this.rangeToCharacterRange(v[x],u),backward:A}}return z},restoreSelection:function(z,B,t){z.removeAllRanges();var y=z.win.document;for(var v=0,x=B.length,w,A,u;v<x;++v){A=B[v];u=A.characterRange;w=this.characterRangeToRange(y,A.characterRange,t);z.addRange(w,A.backward)}}};q("textContent",function(){return r});q("TextRange",(function(){var t;return function(){if(!t){var u=j.modules.TextRange;if(!u){throw new Error("TextRange module is missing.")}else{if(!u.supported){throw new Error("TextRange module is present but not supported.")}}t={rangeToCharacterRange:function(w,v){return e.fromCharacterRange(w.toCharacterRange(v))},characterRangeToRange:function(x,y,v){var w=j.createRange(x);w.selectCharacters(v,y.start,y.end);return w},serializeSelection:function(w,v){return w.saveCharacterRanges(v)},restoreSelection:function(x,w,v){x.restoreCharacterRanges(v,w)}}}return t}})());function h(u,v,y,t,x,w){if(x){this.id=x;k=Math.max(k,x+1)}else{this.id=k++}this.characterRange=v;this.doc=u;this.classApplier=y;this.converter=t;this.containerElementId=w||null;this.applied=false}h.prototype={getContainerElement:function(){return g(this.doc,this.containerElementId)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(t){this.characterRange=this.converter.rangeToCharacterRange(t,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(t){return this.getRange().containsNodeContents(t.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange());this.applied=false},apply:function(){this.classApplier.applyToRange(this.getRange());this.applied=true},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.className+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}};function f(u,t){t=t||"textContent";this.doc=u||document;this.classAppliers={};this.highlights=[];this.converter=c(t)}f.prototype={addClassApplier:function(t){this.classAppliers[t.className]=t},getHighlightForElement:function(v){var w=this.highlights;for(var u=0,t=w.length;u<t;++u){if(w[u].containsElement(v)){return w[u]}}return null},removeHighlights:function(w){for(var v=0,t=this.highlights.length,u;v<t;++v){u=this.highlights[v];if(i(w,u)){u.unapply();this.highlights.splice(v--,1)}}},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(t){var u=[],v=this.highlights;n(t,function(w){n(v,function(x){if(w.intersectsRange(x.getRange())&&!i(u,x)){u.push(x)}})});return u},highlightCharacterRanges:function(w,G,y){var J,K,H;var z=this.highlights;var N=this.converter;var P=this.doc;var A=[];var D=w?this.classAppliers[w]:null;y=l(y,{containerElementId:null,exclusive:true});var F=y.containerElementId;var L=y.exclusive;var t,E,M;if(F){t=this.doc.getElementById(F);if(t){E=j.createRange(this.doc);E.selectNodeContents(t);M=new e(0,E.toString().length)}}var v,B,C,O,x,u;for(J=0,K=G.length;J<K;++J){v=G[J];x=[];if(M){v=v.intersection(M)}if(v.start==v.end){continue}for(H=0;H<z.length;++H){C=false;if(F==z[H].containerElementId){B=z[H].characterRange;O=(D==z[H].classApplier);u=!O&&L;if((B.intersects(v)||B.isContiguousWith(v))&&(O||u)){if(u){n(B.getComplements(v),function(Q){x.push(new h(P,Q,z[H].classApplier,N,null,F))})}C=true;if(O){v=B.union(v)}}}if(C){A.push(z[H]);z[H]=new h(P,B.union(v),D,N,null,F)}else{x.push(z[H])}}if(D){x.push(new h(P,v,D,N,null,F))}this.highlights=z=x}n(A,function(Q){Q.unapply()});var I=[];n(z,function(Q){if(!Q.applied){Q.apply();I.push(Q)}});return I},highlightRanges:function(y,t,v){var u=[];var x=this.converter;v=l(v,{containerElement:null,exclusive:true});var A=v.containerElement;var z=A?A.id:null;var w;if(A){w=j.createRange(A);w.selectNodeContents(A)}n(t,function(C){var B=A?w.intersection(C):C;u.push(x.rangeToCharacterRange(B,A||s(C.getDocument())))});return this.highlightCharacterRanges(y,u,{containerElementId:z,exclusive:v.exclusive})},highlightSelection:function(z,E){var x=this.converter;var A=z?this.classAppliers[z]:false;E=l(E,{containerElementId:null,selection:j.getSelection(),exclusive:true});var y=E.containerElementId;var t=E.exclusive;var C=E.selection;var B=C.win.document;var D=g(B,y);if(!A&&z!==false){throw new Error("No class applier found for class '"+z+"'")}var u=x.serializeSelection(C,D);var w=[];n(u,function(F){w.push(e.fromCharacterRange(F.characterRange))});var v=this.highlightCharacterRanges(z,w,{containerElementId:y,exclusive:t});x.restoreSelection(C,u,D);return v},unhighlightSelection:function(u){u=u||j.getSelection();var t=this.getIntersectingHighlights(u.getAllRanges());this.removeHighlights(t);u.removeAllRanges();return t},getHighlightsInSelection:function(t){t=t||j.getSelection();return this.getIntersectingHighlights(t.getAllRanges())},selectionOverlapsHighlight:function(t){return this.getHighlightsInSelection(t).length>0},serialize:function(v){var u=this;var x=u.highlights;var t,z,w,y;x.sort(p);v=l(v,{serializeHighlightText:false,type:u.converter.type});t=v.type;w=(t!=u.converter.type);if(w){y=c(t)}z=["type:"+t];n(x,function(A){var C=A.characterRange;var D;if(w){D=A.getContainerElement();C=y.rangeToCharacterRange(u.converter.characterRangeToRange(u.doc,C,D),D)}var B=[C.start,C.end,A.id,A.classApplier.className,A.containerElementId];if(v.serializeHighlightText){B.push(A.getText())}z.push(B.join("$"))});return z.join("|")},deserialize:function(B){var v=B.split("|");var E=[];var t=v[0];var z;var u,A,G=false;if(t&&(z=/^type:(\w+)$/.exec(t))){u=z[1];if(u!=this.converter.type){A=c(u);G=true}v.shift()}else{throw new Error("Serialized highlights are invalid.")}var F,w,D,x,H;for(var C=v.length,y;C-->0;){y=v[C].split("$");D=new e(+y[0],+y[1]);x=y[4]||null;if(G){H=g(this.doc,x);D=this.converter.rangeToCharacterRange(A.characterRangeToRange(this.doc,D,H),H)}F=this.classAppliers[y[3]];if(!F){throw new Error("No class applier found for class '"+y[3]+"'")}w=new h(this.doc,D,F,this.converter,parseInt(y[2]),x);w.apply();E.push(w)}this.highlights=E}};j.Highlighter=f;j.createHighlighter=function(u,t){return new f(u,t)}});return a},this);
(function(b,a){if(typeof define=="function"&&define.amd){define(["./rangy-core"],b)}else{if(typeof module!="undefined"&&typeof exports=="object"){module.exports=b(require("rangy"))}else{b(a.rangy)}}})(function(a){a.createModule("ClassApplier",["WrappedSelection"],function(k,h){var d=k.dom;var w=d.DomPosition;var F=d.arrayContains;var c=k.util.forEach;var G="span";var q=k.util.isHostMethod(document,"createElementNS");function U(ad,ac){for(var ab in ad){if(ad.hasOwnProperty(ab)){if(ac(ab,ad[ab])===false){return false}}}return true}function b(ab){return ab.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Y(ab,ac){return !!ab&&new RegExp("(?:^|\\s)"+ac+"(?:\\s|$)").test(ab)}function Q(ac,ab){if(typeof ac.classList=="object"){return ac.classList.contains(ab)}else{var ae=(typeof ac.className=="string");var ad=ae?ac.className:ac.getAttribute("class");return Y(ad,ab)}}function z(ac,ab){if(typeof ac.classList=="object"){ac.classList.add(ab)}else{var ae=(typeof ac.className=="string");var ad=ae?ac.className:ac.getAttribute("class");if(ad){if(!Y(ad,ab)){ad+=" "+ab}}else{ad=ab}if(ae){ac.className=ad}else{ac.setAttribute("class",ad)}}}var s=(function(){function ab(ac,ae,ad){return(ae&&ad)?" ":""}return function(ad,ac){if(typeof ad.classList=="object"){ad.classList.remove(ac)}else{var af=(typeof ad.className=="string");var ae=af?ad.className:ad.getAttribute("class");ae=ae.replace(new RegExp("(^|\\s)"+ac+"(\\s|$)"),ab);if(af){ad.className=ae}else{ad.setAttribute("class",ae)}}}})();function m(ab){var ac=(typeof ab.className=="string");return ac?ab.className:ab.getAttribute("class")}function C(ab){return ab&&ab.split(/\s+/).sort().join(" ")}function A(ab){return C(m(ab))}function r(ac,ab){return A(ac)==A(ab)}function y(af,ae){var ad=ae.split(/\s+/);for(var ac=0,ab=ad.length;ac<ab;++ac){if(!Q(af,b(ad[ac]))){return false}}return true}function S(ac){var ab=ac.parentNode;return(ab&&ab.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(ab.nodeName))}function aa(ad,ag,af,aj,ai){var ab=ad.node,ac=ad.offset;var ah=ab,ae=ac;if(ab==aj&&ac>ai){++ae}if(ab==ag&&(ac==af||ac==af+1)){ah=aj;ae+=ai-af}if(ab==ag&&ac>af+1){--ae}ad.node=ah;ad.offset=ae}function n(ac,ab,ad){if(ac.node==ab&&ac.offset>ad){--ac.offset}}function o(af,ae,ad,ab){if(ad==-1){ad=ae.childNodes.length}var ac=af.parentNode;var ag=d.getNodeIndex(af);c(ab,function(ah){aa(ah,ac,ag,ae,ad)});if(ae.childNodes.length==ad){ae.appendChild(af)}else{ae.insertBefore(af,ae.childNodes[ad])}}function K(ad,ab){var ac=ad.parentNode;var ae=d.getNodeIndex(ad);c(ab,function(af){n(af,ac,ae)});d.removeNode(ad)}function P(af,ae,ad,ag,ab){var ah,ac=[];while((ah=af.firstChild)){o(ah,ae,ad++,ab);ac.push(ah)}if(ag){K(af,ab)}return ac}function M(ac,ab){return P(ac,ac.parentNode,d.getNodeIndex(ac),true,ab)}function D(ab,af){var ac=ab.cloneRange();ac.selectNodeContents(af);var ad=ac.intersection(ab);var ae=ad?ad.toString():"";return ae!=""}function J(ad){var ac=ad.getNodes([3]);var af=0,ae;while((ae=ac[af])&&!D(ad,ae)){++af}var ab=ac.length-1;while((ae=ac[ab])&&!D(ad,ae)){--ab}return ac.slice(af,ab+1)}function W(ah,af){if(ah.attributes.length!=af.attributes.length){return false}for(var ag=0,ab=ah.attributes.length,ae,ac,ad;ag<ab;++ag){ae=ah.attributes[ag];ad=ae.name;if(ad!="class"){ac=af.attributes.getNamedItem(ad);if((ae===null)!=(ac===null)){return false}if(ae.specified!=ac.specified){return false}if(ae.specified&&ae.nodeValue!==ac.nodeValue){return false}}}return true}function X(af,ae){for(var ad=0,ab=af.attributes.length,ac;ad<ab;++ad){ac=af.attributes[ad].name;if(!(ae&&F(ae,ac))&&af.attributes[ad].specified&&ac!="class"){return true}}return false}var t=d.getComputedStyleProperty;var v=(function(){var ab=document.createElement("div");return typeof ab.isContentEditable=="boolean"?function(ac){return ac&&ac.nodeType==1&&ac.isContentEditable}:function(ac){if(!ac||ac.nodeType!=1||ac.contentEditable=="false"){return false}return ac.contentEditable=="true"||v(ac.parentNode)}})();function g(ac){var ab;return ac&&ac.nodeType==1&&(((ab=ac.parentNode)&&ab.nodeType==9&&ab.designMode=="on")||(v(ac)&&!v(ac.parentNode)))}function f(ab){return(v(ab)||(ab.nodeType!=1&&v(ab.parentNode)))&&!g(ab)}var T=/^inline(-block|-table)?$/i;function j(ab){return ab&&ab.nodeType==1&&!T.test(t(ab,"display"))}var l=/[^\r\n\t\f \u200B]/;function O(ab){if(ab.data.length==0){return true}if(l.test(ab.data)){return false}var ac=t(ab.parentNode,"whiteSpace");switch(ac){case"pre":case"pre-wrap":case"-moz-pre-wrap":return false;case"pre-line":if(/[\r\n]/.test(ab.data)){return false}}return j(ab.previousSibling)||j(ab.nextSibling)}function N(ac){var ab=[],ae,ad;for(ae=0;ad=ac[ae++];){ab.push(new w(ad.startContainer,ad.startOffset),new w(ad.endContainer,ad.endOffset))}return ab}function V(ae,ad){for(var ag=0,af,ah,ac,ab=ae.length;ag<ab;++ag){af=ae[ag];ah=ad[ag*2];ac=ad[ag*2+1];af.setStartAndEnd(ah.node,ah.offset,ac.node,ac.offset)}}function H(ab,ac){if(d.isCharacterDataNode(ab)){if(ac==0){return !!ab.previousSibling}else{if(ac==ab.length){return !!ab.nextSibling}else{return true}}}return ac>0&&ac<ab.childNodes.length}function R(af,ak,ac,ai){var al,aj;var ad=(ac==0);if(d.isAncestorOf(ak,af)){return af}if(d.isCharacterDataNode(ak)){var ag=d.getNodeIndex(ak);if(ac==0){ac=ag}else{if(ac==ak.length){ac=ag+1}else{throw h.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+ac+" in "+ak.data)}}ak=ak.parentNode}if(H(ak,ac)){al=ak.cloneNode(false);aj=ak.parentNode;if(al.id){al.removeAttribute("id")}var ab,ah=0;while((ab=ak.childNodes[ac])){o(ab,al,ah++,ai)}o(al,aj,d.getNodeIndex(ak)+1,ai);return(ak==af)?al:R(af,aj,d.getNodeIndex(al),ai)}else{if(af!=ak){al=ak.parentNode;var ae=d.getNodeIndex(ak);if(!ad){ae++}return R(af,al,ae,ai)}}return af}function Z(ac,ab){return ac.namespaceURI==ab.namespaceURI&&ac.tagName.toLowerCase()==ab.tagName.toLowerCase()&&r(ac,ab)&&W(ac,ab)&&t(ac,"display")=="inline"&&t(ab,"display")=="inline"}function u(ab){var ac=ab?"nextSibling":"previousSibling";return function(ah,ae){var af=ah.parentNode;var ag=ah[ac];if(ag){if(ag&&ag.nodeType==3){return ag}}else{if(ae){ag=af[ac];if(ag&&ag.nodeType==1&&Z(af,ag)){var ad=ag[ab?"firstChild":"lastChild"];if(ad&&ad.nodeType==3){return ad}}}}return null}}var x=u(false),p=u(true);function B(ac){this.isElementMerge=(ac.nodeType==1);this.textNodes=[];var ab=this.isElementMerge?ac.lastChild:ac;if(ab){this.textNodes[0]=ab}}B.prototype={doMerge:function(ab){var ah=this.textNodes;var ag=ah[0];if(ah.length>1){var ae=d.getNodeIndex(ag);var ac=[],ad=0,ai,af;c(ah,function(ak,aj){af=ak.parentNode;if(aj>0){af.removeChild(ak);if(!af.hasChildNodes()){d.removeNode(af)}if(ab){c(ab,function(al){if(al.node==ak){al.node=ag;al.offset+=ad}if(al.node==af&&al.offset>ae){--al.offset;if(al.offset==ae+1&&aj<len-1){al.node=ag;al.offset=ad}}})}}ac[aj]=ak.data;ad+=ak.data.length});ag.data=ac.join("")}return ag.data},getLength:function(){var ac=this.textNodes.length,ab=0;while(ac--){ab+=this.textNodes[ac].length}return ab},toString:function(){var ab=[];c(this.textNodes,function(ad,ac){ab[ac]="'"+ad.data+"'"});return"[Merge("+ab.join(",")+")]"}};var E=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"];var e={};function I(ai,am,al){var af,ae,ah,ag,ak=this;ak.cssClass=ak.className=ai;var ad=null,ac={};if(typeof am=="object"&&am!==null){if(typeof am.elementTagName!=="undefined"){am.elementTagName=am.elementTagName.toLowerCase()}al=am.tagNames;ad=am.elementProperties;ac=am.elementAttributes;for(ae=0;ag=E[ae++];){if(am.hasOwnProperty(ag)){ak[ag]=am[ag]}}af=am.normalize}else{af=am}ak.normalize=(typeof af=="undefined")?true:af;ak.attrExceptions=[];var ab=document.createElement(ak.elementTagName);ak.elementProperties=ak.copyPropertiesToElement(ad,ab,true);U(ac,function(an){ak.attrExceptions.push(an)});ak.elementAttributes=ac;ak.elementSortedClassName=ak.elementProperties.hasOwnProperty("className")?C(ak.elementProperties.className+" "+ai):ai;ak.applyToAnyTagName=false;var aj=typeof al;if(aj=="string"){if(al=="*"){ak.applyToAnyTagName=true}else{ak.tagNames=b(al.toLowerCase()).split(/\s*,\s*/)}}else{if(aj=="object"&&typeof al.length=="number"){ak.tagNames=[];for(ae=0,ah=al.length;ae<ah;++ae){if(al[ae]=="*"){ak.applyToAnyTagName=true}else{ak.tagNames.push(al[ae].toLowerCase())}}}else{ak.tagNames=[ak.elementTagName]}}}I.prototype={elementTagName:G,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:true,applyToEditableOnly:false,useExistingElements:true,removeEmptyElements:true,onElementCreate:null,copyPropertiesToElement:function(ai,ad,aj){var al,ak,ag={},af,ac,ae,ah;for(var ab in ai){if(ai.hasOwnProperty(ab)){ac=ai[ab];ae=ad[ab];if(ab=="className"){z(ad,ac);z(ad,this.className);ad[ab]=C(ad[ab]);if(aj){ag[ab]=ac}}else{if(ab=="style"){ak=ae;if(aj){ag[ab]=af={}}for(al in ai[ab]){if(ai[ab].hasOwnProperty(al)){ak[al]=ac[al];if(aj){af[al]=ak[al]}}}this.attrExceptions.push(ab)}else{ad[ab]=ac;if(aj){ag[ab]=ad[ab];ah=e.hasOwnProperty(ab)?e[ab]:ab;this.attrExceptions.push(ah)}}}}}return aj?ag:""},copyAttributesToElement:function(ab,ad){for(var ac in ab){if(ab.hasOwnProperty(ac)&&!/^class(?:Name)?$/i.test(ac)){ad.setAttribute(ac,ab[ac])}}},appliesToElement:function(ab){return F(this.tagNames,ab.tagName.toLowerCase())},getEmptyElements:function(ab){var ac=this;return ab.getNodes([1],function(ad){return ac.appliesToElement(ad)&&!ad.hasChildNodes()})},hasClass:function(ab){return ab.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(ab))&&Q(ab,this.className)},getSelfOrAncestorWithClass:function(ab){while(ab){if(this.hasClass(ab)){return ab}ab=ab.parentNode}return null},isModifiable:function(ab){return !this.applyToEditableOnly||f(ab)},isIgnorableWhiteSpaceNode:function(ab){return this.ignoreWhiteSpace&&ab&&ab.nodeType==3&&O(ab)},postApply:function(an,ak,ai,ag){var ab=an[0],ac=an[an.length-1];var ae=[],ao;var ah=ab,ad=ac;var al=0,ap=ac.length;var af,aj;c(an,function(aq){aj=x(aq,!ag);if(aj){if(!ao){ao=new B(aj);ae.push(ao)}ao.textNodes.push(aq);if(aq===ab){ah=ao.textNodes[0];al=ah.length}if(aq===ac){ad=ao.textNodes[0];ap=ao.getLength()}}else{ao=null}});var am=p(ac,!ag);if(am){if(!ao){ao=new B(ac);ae.push(ao)}ao.textNodes.push(am)}if(ae.length){for(i=0,len=ae.length;i<len;++i){ae[i].doMerge(ai)}ak.setStartAndEnd(ah,al,ad,ap)}},createContainer:function(ab){var ae=d.getDocument(ab);var ad;var ac=q&&!d.isHtmlNamespace(ab)&&(ad=ab.namespaceURI)?ae.createElementNS(ab.namespaceURI,this.elementTagName):ae.createElement(this.elementTagName);this.copyPropertiesToElement(this.elementProperties,ac,false);this.copyAttributesToElement(this.elementAttributes,ac);z(ac,this.className);if(this.onElementCreate){this.onElementCreate(ac,this)}return ac},elementHasProperties:function(ad,ac){var ab=this;return U(ac,function(ae,af){if(ae=="className"){return y(ad,af)}else{if(typeof af=="object"){if(!ab.elementHasProperties(ad[ae],af)){return false}}else{if(ad[ae]!==af){return false}}}})},elementHasAttributes:function(ac,ab){return U(ab,function(ad,ae){if(ac.getAttribute(ad)!==ae){return false}})},applyToTextNode:function(af,ab){if(S(af)){var ad=af.parentNode;if(ad.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(ad)&&this.elementHasProperties(ad,this.elementProperties)&&this.elementHasAttributes(ad,this.elementAttributes)){z(ad,this.className)}else{var ae=af.parentNode;var ac=this.createContainer(ae);ae.insertBefore(ac,af);ac.appendChild(af)}}},isRemovable:function(ab){return ab.tagName.toLowerCase()==this.elementTagName&&A(ab)==this.elementSortedClassName&&this.elementHasProperties(ab,this.elementProperties)&&!X(ab,this.attrExceptions)&&this.elementHasAttributes(ab,this.elementAttributes)&&this.isModifiable(ab)},isEmptyContainer:function(ab){var ac=ab.childNodes.length;return ab.nodeType==1&&this.isRemovable(ab)&&(ac==0||(ac==1&&this.isEmptyContainer(ab.firstChild)))},removeEmptyContainers:function(ad){var ae=this;var ac=ad.getNodes([1],function(ag){return ae.isEmptyContainer(ag)});var af=[ad];var ab=N(af);c(ac,function(ag){K(ag,ab)});V(af,ab)},undoToTextNode:function(af,ad,ae,ac){if(!ad.containsNode(ae)){var ab=ad.cloneRange();ab.selectNode(ae);if(ab.isPointInRange(ad.endContainer,ad.endOffset)){R(ae,ad.endContainer,ad.endOffset,ac);ad.setEndAfter(ae)}if(ab.isPointInRange(ad.startContainer,ad.startOffset)){ae=R(ae,ad.startContainer,ad.startOffset,ac)}}if(this.isRemovable(ae)){M(ae,ac)}else{s(ae,this.className)}},splitAncestorWithClass:function(ac,ae,ab){var ad=this.getSelfOrAncestorWithClass(ac);if(ad){R(ad,ac,ae,ab)}},undoToAncestor:function(ac,ab){if(this.isRemovable(ac)){M(ac,ab)}else{s(ac,this.className)}},applyToRange:function(ad,ah){var ae=this;ah=ah||[];var ac=N(ah||[]);ad.splitBoundariesPreservingPositions(ac);if(ae.removeEmptyElements){ae.removeEmptyContainers(ad)}var ag=J(ad);if(ag.length){c(ag,function(ai){if(!ae.isIgnorableWhiteSpaceNode(ai)&&!ae.getSelfOrAncestorWithClass(ai)&&ae.isModifiable(ai)){ae.applyToTextNode(ai,ac)}});var ab=ag[ag.length-1];ad.setStartAndEnd(ag[0],0,ab,ab.length);if(ae.normalize){ae.postApply(ag,ad,ac,false)}V(ah,ac)}var af=ae.getEmptyElements(ad);c(af,function(ai){z(ai,ae.className)})},applyToRanges:function(ab){var ac=ab.length;while(ac--){this.applyToRange(ab[ac],ab)}return ab},applyToSelection:function(ac){var ab=k.getSelection(ac);ab.setRanges(this.applyToRanges(ab.getAllRanges()))},undoToRange:function(af,aj){var al=this;aj=aj||[];var ad=N(aj);af.splitBoundariesPreservingPositions(ad);if(al.removeEmptyElements){al.removeEmptyContainers(af,ad)}var ah=J(af);var ab,ac;var ai=ah[ah.length-1];if(ah.length){al.splitAncestorWithClass(af.endContainer,af.endOffset,ad);al.splitAncestorWithClass(af.startContainer,af.startOffset,ad);for(var ae=0,ag=ah.length;ae<ag;++ae){ab=ah[ae];ac=al.getSelfOrAncestorWithClass(ab);if(ac&&al.isModifiable(ab)){al.undoToAncestor(ac,ad)}}af.setStartAndEnd(ah[0],0,ai,ai.length);if(al.normalize){al.postApply(ah,af,ad,true)}V(aj,ad)}var ak=al.getEmptyElements(af);c(ak,function(am){s(am,al.className)})},undoToRanges:function(ab){var ac=ab.length;while(ac--){this.undoToRange(ab[ac],ab)}return ab},undoToSelection:function(ad){var ac=k.getSelection(ad);var ab=k.getSelection(ad).getAllRanges();this.undoToRanges(ab);ac.setRanges(ab)},isAppliedToRange:function(ab){if(ab.collapsed||ab.toString()==""){return !!this.getSelfOrAncestorWithClass(ab.commonAncestorContainer)}else{var ad=ab.getNodes([3]);if(ad.length){for(var ac=0,ae;ae=ad[ac++];){if(!this.isIgnorableWhiteSpaceNode(ae)&&D(ab,ae)&&this.isModifiable(ae)&&!this.getSelfOrAncestorWithClass(ae)){return false}}}return true}},isAppliedToRanges:function(ab){var ac=ab.length;if(ac==0){return false}while(ac--){if(!this.isAppliedToRange(ab[ac])){return false}}return true},isAppliedToSelection:function(ac){var ab=k.getSelection(ac);return this.isAppliedToRanges(ab.getAllRanges())},toggleRange:function(ab){if(this.isAppliedToRange(ab)){this.undoToRange(ab)}else{this.applyToRange(ab)}},toggleSelection:function(ab){if(this.isAppliedToSelection(ab)){this.undoToSelection(ab)}else{this.applyToSelection(ab)}},getElementsWithClassIntersectingRange:function(ab){var ad=[];var ac=this;ab.getNodes([3],function(af){var ae=ac.getSelfOrAncestorWithClass(af);if(ae&&!F(ad,ae)){ad.push(ae)}});return ad},detach:function(){}};function L(ad,ac,ab){return new I(ad,ac,ab)}I.util={hasClass:Q,addClass:z,removeClass:s,getClass:m,hasSameClasses:r,hasAllClasses:y,replaceWithOwnChildren:M,elementsHaveSameNonClassAttributes:W,elementHasNonClassAttributes:X,splitNodeAt:R,isEditableElement:v,isEditingHost:g,isEditable:f};k.CssClassApplier=k.ClassApplier=I;k.createCssClassApplier=k.createClassApplier=L});return a},this);
var Ntxtmp={Components:{Singleton:{}},Behaviors:{},Model:{},Collection:{},View:{},Router:{},Singleton:{},API:{},CourseId:null,oApiTracking:null};
(function(){var ak=this,ae=ak._,ag={},au=Array.prototype,ad=Object.prototype,ap=Function.prototype,ay=au.push,aj=au.slice,aw=au.concat,am=ad.toString,at=ad.hasOwnProperty,af=au.forEach,ai=au.map,aq=au.reduce,ac=au.reduceRight,ar=au.filter,av=au.every,al=au.some,Z=au.indexOf,ax=au.lastIndexOf,aa=Array.isArray,ab=Object.keys,az=ap.bind,ao=function(a){return a instanceof ao?a:this instanceof ao?void (this._wrapped=a):new ao(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=ao),exports._=ao):ak._=ao,ao.VERSION="1.6.0";var X=ao.each=ao.forEach=function(h,f,g){if(null==h){return h}if(af&&h.forEach===af){h.forEach(f,g)}else{if(h.length===+h.length){for(var c=0,d=h.length;d>c;c++){if(f.call(g,h[c],c,h)===ag){return}}}else{for(var b=ao.keys(h),c=0,d=b.length;d>c;c++){if(f.call(g,h[b[c]],b[c],h)===ag){return}}}}return h};ao.map=ao.collect=function(d,a,b){var c=[];return null==d?c:ai&&d.map===ai?d.map(a,b):(X(d,function(g,e,f){c.push(a.call(b,g,e,f))}),c)};var J="Reduce of empty array with no initial value";ao.reduce=ao.foldl=ao.inject=function(f,b,c,d){var a=arguments.length>2;if(null==f&&(f=[]),aq&&f.reduce===aq){return d&&(b=ao.bind(b,d)),a?f.reduce(b,c):f.reduce(b)}if(X(f,function(h,g,e){a?c=b.call(d,c,h,g,e):(c=h,a=!0)}),!a){throw new TypeError(J)}return c},ao.reduceRight=ao.foldr=function(j,f,g,h){var c=arguments.length>2;if(null==j&&(j=[]),ac&&j.reduceRight===ac){return h&&(f=ao.bind(f,h)),c?j.reduceRight(f,g):j.reduceRight(f)}var d=j.length;if(d!==+d){var b=ao.keys(j);d=b.length}if(X(j,function(e,i,a){i=b?b[--d]:--d,c?g=f.call(h,g,j[i],i,a):(g=j[i],c=!0)}),!c){throw new TypeError(J)}return g},ao.find=ao.detect=function(d,a,b){var c;return an(d,function(g,e,f){return a.call(b,g,e,f)?(c=g,!0):void 0}),c},ao.filter=ao.select=function(d,a,b){var c=[];return null==d?c:ar&&d.filter===ar?d.filter(a,b):(X(d,function(g,e,f){a.call(b,g,e,f)&&c.push(g)}),c)},ao.reject=function(c,a,b){return ao.filter(c,function(g,f,d){return !a.call(b,g,f,d)},b)},ao.every=ao.all=function(d,b,c){b||(b=ao.identity);var a=!0;return null==d?a:av&&d.every===av?d.every(b,c):(X(d,function(g,f,e){return(a=a&&b.call(c,g,f,e))?void 0:ag}),!!a)};var an=ao.some=ao.any=function(d,b,c){b||(b=ao.identity);var a=!1;return null==d?a:al&&d.some===al?d.some(b,c):(X(d,function(g,f,e){return a||(a=b.call(c,g,f,e))?ag:void 0}),!!a)};ao.contains=ao.include=function(b,a){return null==b?!1:Z&&b.indexOf===Z?b.indexOf(a)!=-1:an(b,function(c){return c===a})},ao.invoke=function(d,a){var b=aj.call(arguments,2),c=ao.isFunction(a);return ao.map(d,function(e){return(c?a:e[a]).apply(e,b)})},ao.pluck=function(b,a){return ao.map(b,ao.property(a))},ao.where=function(b,a){return ao.filter(b,ao.matches(a))},ao.findWhere=function(b,a){return ao.find(b,ao.matches(a))},ao.max=function(f,b,c){if(!b&&ao.isArray(f)&&f[0]===+f[0]&&f.length<65535){return Math.max.apply(Math,f)}var d=-1/0,a=-1/0;return X(f,function(j,g,e){var h=b?b.call(c,j,g,e):j;h>a&&(d=j,a=h)}),d},ao.min=function(f,b,c){if(!b&&ao.isArray(f)&&f[0]===+f[0]&&f.length<65535){return Math.min.apply(Math,f)}var d=1/0,a=1/0;return X(f,function(j,g,e){var h=b?b.call(c,j,g,e):j;a>h&&(d=j,a=h)}),d},ao.shuffle=function(d){var a,b=0,c=[];return X(d,function(e){a=ao.random(b++),c[b-1]=c[a],c[a]=e}),c},ao.sample=function(c,a,b){return null==a||b?(c.length!==+c.length&&(c=ao.values(c)),c[ao.random(c.length-1)]):ao.shuffle(c).slice(0,Math.max(0,a))};var U=function(a){return null==a?ao.identity:ao.isFunction(a)?a:ao.property(a)};ao.sortBy=function(c,a,b){return a=U(a),ao.pluck(ao.map(c,function(g,f,d){return{value:g,index:f,criteria:a.call(b,g,f,d)}}).sort(function(h,d){var f=h.criteria,g=d.criteria;if(f!==g){if(f>g||f===void 0){return 1}if(g>f||g===void 0){return -1}}return h.index-d.index}),"value")};var Q=function(a){return function(c,d,f){var b={};return d=U(d),X(c,function(g,e){var h=d.call(f,g,e,c);a(b,h,g)}),b}};ao.groupBy=Q(function(c,a,b){ao.has(c,a)?c[a].push(b):c[a]=[b]}),ao.indexBy=Q(function(c,a,b){c[a]=b}),ao.countBy=Q(function(b,a){ao.has(b,a)?b[a]++:b[a]=1}),ao.sortedIndex=function(k,f,g,h){g=U(g);for(var c=g.call(h,f),d=0,b=k.length;b>d;){var j=d+b>>>1;g.call(h,k[j])<c?d=j+1:b=j}return d},ao.toArray=function(a){return a?ao.isArray(a)?aj.call(a):a.length===+a.length?ao.map(a,ao.identity):ao.values(a):[]},ao.size=function(a){return null==a?0:a.length===+a.length?a.length:ao.keys(a).length},ao.first=ao.head=ao.take=function(c,a,b){return null==c?void 0:null==a||b?c[0]:0>a?[]:aj.call(c,0,a)},ao.initial=function(c,a,b){return aj.call(c,0,c.length-(null==a||b?1:a))},ao.last=function(c,a,b){return null==c?void 0:null==a||b?c[c.length-1]:aj.call(c,Math.max(c.length-a,0))},ao.rest=ao.tail=ao.drop=function(c,a,b){return aj.call(c,null==a||b?1:a)},ao.compact=function(a){return ao.filter(a,ao.identity)};var L=function(c,a,b){return a&&ao.every(c,ao.isArray)?aw.apply(b,c):(X(c,function(d){ao.isArray(d)||ao.isArguments(d)?a?ay.apply(b,d):L(d,a,b):b.push(d)}),b)};ao.flatten=function(b,a){return L(b,a,[])},ao.without=function(a){return ao.difference(a,aj.call(arguments,1))},ao.partition=function(d,a){var b=[],c=[];return X(d,function(e){(a(e)?b:c).push(e)}),[b,c]},ao.uniq=ao.unique=function(j,f,g,h){ao.isFunction(f)&&(h=g,g=f,f=!1);var c=g?ao.map(j,g,h):j,d=[],b=[];return X(c,function(a,i){(f?i&&b[b.length-1]===a:ao.contains(b,a))||(b.push(a),d.push(j[i]))}),d},ao.union=function(){return ao.uniq(ao.flatten(arguments,!0))},ao.intersection=function(b){var a=aj.call(arguments,1);return ao.filter(ao.uniq(b),function(c){return ao.every(a,function(d){return ao.contains(d,c)})})},ao.difference=function(b){var a=aw.apply(au,aj.call(arguments,1));return ao.filter(b,function(c){return !ao.contains(a,c)})},ao.zip=function(){for(var c=ao.max(ao.pluck(arguments,"length").concat(0)),a=new Array(c),b=0;c>b;b++){a[b]=ao.pluck(arguments,""+b)}return a},ao.object=function(f,b){if(null==f){return{}}for(var c={},d=0,a=f.length;a>d;d++){b?c[f[d]]=b[d]:c[f[d][0]]=f[d][1]}return c},ao.indexOf=function(f,b,c){if(null==f){return -1}var d=0,a=f.length;if(c){if("number"!=typeof c){return d=ao.sortedIndex(f,b),f[d]===b?d:-1}d=0>c?Math.max(0,a+c):c}if(Z&&f.indexOf===Z){return f.indexOf(b,c)}for(;a>d;d++){if(f[d]===b){return d}}return -1},ao.lastIndexOf=function(f,b,c){if(null==f){return -1}var d=null!=c;if(ax&&f.lastIndexOf===ax){return d?f.lastIndexOf(b,c):f.lastIndexOf(b)}for(var a=d?c:f.length;a--;){if(f[a]===b){return a}}return -1},ao.range=function(g,c,d){arguments.length<=1&&(c=g||0,g=0),d=arguments[2]||1;for(var f=Math.max(Math.ceil((c-g)/d),0),a=0,b=new Array(f);f>a;){b[a++]=g,g+=d}return b};var H=function(){};ao.bind=function(d,a){var b,c;if(az&&d.bind===az){return az.apply(d,aj.call(arguments,1))}if(!ao.isFunction(d)){throw new TypeError}return b=aj.call(arguments,2),c=function(){if(!(this instanceof c)){return d.apply(a,b.concat(aj.call(arguments)))}H.prototype=d.prototype;var e=new H;H.prototype=null;var f=d.apply(e,b.concat(aj.call(arguments)));return Object(f)===f?f:e}},ao.partial=function(b){var a=aj.call(arguments,1);return function(){for(var f=0,g=a.slice(),c=0,d=g.length;d>c;c++){g[c]===ao&&(g[c]=arguments[f++])}for(;f<arguments.length;){g.push(arguments[f++])}return b.apply(this,g)}},ao.bindAll=function(b){var a=aj.call(arguments,1);if(0===a.length){throw new Error("bindAll must be passed function names")}return X(a,function(c){b[c]=ao.bind(b[c],b)}),b},ao.memoize=function(c,a){var b={};return a||(a=ao.identity),function(){var d=a.apply(this,arguments);return ao.has(b,d)?b[d]:b[d]=c.apply(this,arguments)}},ao.delay=function(c,a){var b=aj.call(arguments,2);return setTimeout(function(){return c.apply(null,b)},a)},ao.defer=function(a){return ao.delay.apply(ao,[a,1].concat(aj.call(arguments,1)))},ao.throttle=function(f,m,b){var h,l,g,k=null,d=0;b||(b={});var j=function(){d=b.leading===!1?0:ao.now(),k=null,g=f.apply(h,l),h=l=null};return function(){var a=ao.now();d||b.leading!==!1||(d=a);var c=m-(a-d);return h=this,l=arguments,0>=c?(clearTimeout(k),k=null,d=a,g=f.apply(h,l),h=l=null):k||b.trailing===!1||(k=setTimeout(j,c)),g}},ao.debounce=function(f,m,b){var h,l,g,k,d,j=function(){var a=ao.now()-k;m>a?h=setTimeout(j,m-a):(h=null,b||(d=f.apply(g,l),g=l=null))};return function(){g=this,l=arguments,k=ao.now();var a=b&&!h;return h||(h=setTimeout(j,m)),a&&(d=f.apply(g,l),g=l=null),d}},ao.once=function(c){var a,b=!1;return function(){return b?a:(b=!0,a=c.apply(this,arguments),c=null,a)}},ao.wrap=function(b,a){return ao.partial(a,b)},ao.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--){b=[a[c].apply(this,b)]}return b[0]}},ao.after=function(b,a){return function(){return --b<1?a.apply(this,arguments):void 0}},ao.keys=function(c){if(!ao.isObject(c)){return[]}if(ab){return ab(c)}var a=[];for(var b in c){ao.has(c,b)&&a.push(b)}return a},ao.values=function(f){for(var b=ao.keys(f),c=b.length,d=new Array(c),a=0;c>a;a++){d[a]=f[b[a]]}return d},ao.pairs=function(f){for(var b=ao.keys(f),c=b.length,d=new Array(c),a=0;c>a;a++){d[a]=[b[a],f[b[a]]]}return d},ao.invert=function(f){for(var b={},c=ao.keys(f),d=0,a=c.length;a>d;d++){b[f[c[d]]]=c[d]}return b},ao.functions=ao.methods=function(c){var a=[];for(var b in c){ao.isFunction(c[b])&&a.push(b)}return a.sort()},ao.extend=function(a){return X(aj.call(arguments,1),function(b){if(b){for(var c in b){a[c]=b[c]}}}),a},ao.pick=function(c){var a={},b=aw.apply(au,aj.call(arguments,1));return X(b,function(d){d in c&&(a[d]=c[d])}),a},ao.omit=function(d){var b={},c=aw.apply(au,aj.call(arguments,1));for(var a in d){ao.contains(c,a)||(b[a]=d[a])}return b},ao.defaults=function(a){return X(aj.call(arguments,1),function(b){if(b){for(var c in b){a[c]===void 0&&(a[c]=b[c])}}}),a},ao.clone=function(a){return ao.isObject(a)?ao.isArray(a)?a.slice():ao.extend({},a):a},ao.tap=function(b,a){return a(b),b};var G=function(g,q,b,k){if(g===q){return 0!==g||1/g==1/q}if(null==g||null==q){return g===q}g instanceof ao&&(g=g._wrapped),q instanceof ao&&(q=q._wrapped);var p=am.call(g);if(p!=am.call(q)){return !1}switch(p){case"[object String]":return g==String(q);case"[object Number]":return g!=+g?q!=+q:0==g?1/g==1/q:g==+q;case"[object Date]":case"[object Boolean]":return +g==+q;case"[object RegExp]":return g.source==q.source&&g.global==q.global&&g.multiline==q.multiline&&g.ignoreCase==q.ignoreCase}if("object"!=typeof g||"object"!=typeof q){return !1}for(var h=b.length;h--;){if(b[h]==g){return k[h]==q}}var m=g.constructor,d=q.constructor;if(m!==d&&!(ao.isFunction(m)&&m instanceof m&&ao.isFunction(d)&&d instanceof d)&&"constructor" in g&&"constructor" in q){return !1}b.push(g),k.push(q);var l=0,j=!0;if("[object Array]"==p){if(l=g.length,j=l==q.length){for(;l--&&(j=G(g[l],q[l],b,k));){}}}else{for(var v in g){if(ao.has(g,v)&&(l++,!(j=ao.has(q,v)&&G(g[v],q[v],b,k)))){break}}if(j){for(v in q){if(ao.has(q,v)&&!l--){break}}j=!l}}return b.pop(),k.pop(),j};ao.isEqual=function(b,a){return G(b,a,[],[])},ao.isEmpty=function(b){if(null==b){return !0}if(ao.isArray(b)||ao.isString(b)){return 0===b.length}for(var a in b){if(ao.has(b,a)){return !1}}return !0},ao.isElement=function(a){return !(!a||1!==a.nodeType)},ao.isArray=aa||function(a){return"[object Array]"==am.call(a)},ao.isObject=function(a){return a===Object(a)},X(["Arguments","Function","String","Number","Date","RegExp"],function(a){ao["is"+a]=function(b){return am.call(b)=="[object "+a+"]"}}),ao.isArguments(arguments)||(ao.isArguments=function(a){return !(!a||!ao.has(a,"callee"))}),"function"!=typeof/./&&(ao.isFunction=function(a){return"function"==typeof a}),ao.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},ao.isNaN=function(a){return ao.isNumber(a)&&a!=+a},ao.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==am.call(a)},ao.isNull=function(a){return null===a},ao.isUndefined=function(a){return a===void 0},ao.has=function(b,a){return at.call(b,a)},ao.noConflict=function(){return ak._=ae,this},ao.identity=function(a){return a},ao.constant=function(a){return function(){return a}},ao.property=function(a){return function(b){return b[a]}},ao.matches=function(a){return function(b){if(b===a){return !0}for(var c in a){if(a[c]!==b[c]){return !1}}return !0}},ao.times=function(f,b,c){for(var d=Array(Math.max(0,f)),a=0;f>a;a++){d[a]=b.call(c,a)}return d},ao.random=function(b,a){return null==a&&(a=b,b=0),b+Math.floor(Math.random()*(a-b+1))},ao.now=Date.now||function(){return(new Date).getTime()};var C={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};C.unescape=ao.invert(C.escape);var P={escape:new RegExp("["+ao.keys(C.escape).join("")+"]","g"),unescape:new RegExp("("+ao.keys(C.unescape).join("|")+")","g")};ao.each(["escape","unescape"],function(a){ao[a]=function(b){return null==b?"":(""+b).replace(P[a],function(c){return C[a][c]})}}),ao.result=function(c,a){if(null==c){return void 0}var b=c[a];return ao.isFunction(b)?b.call(c):b},ao.mixin=function(a){X(ao.functions(a),function(b){var c=ao[b]=a[b];ao.prototype[b]=function(){var d=[this._wrapped];return ay.apply(d,arguments),Y.call(this,c.apply(ao,d))}})};var K=0;ao.uniqueId=function(b){var a=++K+"";return b?b+a:a},ao.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var ah=/(.)^/,W={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;ao.template=function(f,m,b){var h;b=ao.defaults({},b,ao.templateSettings);var l=new RegExp([(b.escape||ah).source,(b.interpolate||ah).source,(b.evaluate||ah).source].join("|")+"|$","g"),g=0,k="__p+='";f.replace(l,function(c,i,n,a,p){return k+=f.slice(g,p).replace(V,function(e){return"\\"+W[e]}),i&&(k+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(k+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),a&&(k+="';\n"+a+"\n__p+='"),g=p+c.length,c}),k+="';\n",b.variable||(k="with(obj||{}){\n"+k+"}\n"),k="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+k+"return __p;\n";try{h=new Function(b.variable||"obj","_",k)}catch(d){throw d.source=k,d}if(m){return h(m,ao)}var j=function(a){return h.call(this,a,ao)};return j.source="function("+(b.variable||"obj")+"){\n"+k+"}",j},ao.chain=function(a){return ao(a).chain()};var Y=function(a){return this._chain?ao(a).chain():a};ao.mixin(ao),X(["pop","push","reverse","shift","sort","splice","unshift"],function(b){var a=au[b];ao.prototype[b]=function(){var c=this._wrapped;return a.apply(c,arguments),"shift"!=b&&"splice"!=b||0!==c.length||delete c[0],Y.call(this,c)}}),X(["concat","join","slice"],function(b){var a=au[b];ao.prototype[b]=function(){return Y.call(this,a.apply(this._wrapped,arguments))}}),ao.extend(ao.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return ao})}).call(this);
(function(b,c){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(d,f,e){b.Backbone=c(b,e,d,f)})}else{if(typeof exports!=="undefined"){var a=require("underscore");c(b,exports,a)}else{b.Backbone=c(b,{},b._,b.jQuery||b.Zepto||b.ender||b.$)}}})(this,function(af,av,aq,ah){var ag=af.Backbone;var al=[];var az=al.push;var ak=al.slice;var ar=al.splice;av.VERSION="1.1.2";av.$=ah;av.noConflict=function(){af.Backbone=ag;return this};av.emulateHTTP=false;av.emulateJSON=false;var ae=av.Events={on:function(b,d,a){if(!ax(this,"on",b,[d,a])||!d){return this}this._events||(this._events={});var c=this._events[b]||(this._events[b]=[]);c.push({callback:d,context:a,ctx:a||this});return this},once:function(a,d,c){if(!ax(this,"once",a,[d,c])||!d){return this}var b=this;var f=aq.once(function(){b.off(a,f);d.apply(this,arguments)});f._callback=d;return this.on(a,f,c)},off:function(q,k,b){var v,d,m,c,i,p,g,j;if(!this._events||!ax(this,"off",q,[k,b])){return this}if(!q&&!k&&!b){this._events=void 0;return this}c=q?[q]:aq.keys(this._events);for(i=0,p=c.length;i<p;i++){q=c[i];if(m=this._events[q]){this._events[q]=v=[];if(k||b){for(g=0,j=m.length;g<j;g++){d=m[g];if(k&&k!==d.callback&&k!==d.callback._callback||b&&b!==d.context){v.push(d)}}}if(!v.length){delete this._events[q]}}}return this},trigger:function(b){if(!this._events){return this}var d=ak.call(arguments,1);if(!ax(this,"trigger",b,d)){return this}var a=this._events[b];var c=this._events.all;if(a){au(a,d)}if(c){au(c,arguments)}return this},stopListening:function(c,g,f){var d=this._listeningTo;if(!d){return this}var h=!g&&!f;if(!f&&typeof g==="object"){f=this}if(c){(d={})[c._listenId]=c}for(var b in d){c=d[b];c.off(g,f,this);if(h||aq.isEmpty(c._events)){delete this._listeningTo[b]}}return this}};var an=/\s+/;var ax=function(d,h,c,g){if(!c){return true}if(typeof c==="object"){for(var f in c){d[h].apply(d,[f,c[f]].concat(g))}return false}if(an.test(c)){var k=c.split(an);for(var b=0,j=k.length;b<j;b++){d[h].apply(d,[k[b]].concat(g))}return false}return true};var au=function(d,h){var c,g=-1,f=d.length,k=h[0],b=h[1],j=h[2];switch(h.length){case 0:while(++g<f){(c=d[g]).callback.call(c.ctx)}return;case 1:while(++g<f){(c=d[g]).callback.call(c.ctx,k)}return;case 2:while(++g<f){(c=d[g]).callback.call(c.ctx,k,b)}return;case 3:while(++g<f){(c=d[g]).callback.call(c.ctx,k,b,j)}return;default:while(++g<f){(c=d[g]).callback.apply(c.ctx,h)}return}};var aw={listenTo:"on",listenToOnce:"once"};aq.each(aw,function(a,b){ae[b]=function(g,f,d){var h=this._listeningTo||(this._listeningTo={});var c=g._listenId||(g._listenId=aq.uniqueId("l"));h[c]=g;if(!d&&typeof f==="object"){d=this}g[a](f,d,this);return this}});ae.bind=ae.on;ae.unbind=ae.off;aq.extend(av,ae);var aj=av.Model=function(a,c){var b=a||{};c||(c={});this.cid=aq.uniqueId("c");this.attributes={};if(c.collection){this.collection=c.collection}if(c.parse){b=this.parse(b,c)||{}}b=aq.defaults({},b,aq.result(this,"defaults"));this.set(b,c);this.changed={};this.initialize.apply(this,arguments)};aq.extend(aj.prototype,ae,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return aq.clone(this.attributes)},sync:function(){return av.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return aq.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(y,p,b){var A,i,w,g,k,x,j,v;if(y==null){return this}if(typeof y==="object"){i=y;b=p}else{(i={})[y]=p}b||(b={});if(!this._validate(i,b)){return false}w=b.unset;k=b.silent;g=[];x=this._changing;this._changing=true;if(!x){this._previousAttributes=aq.clone(this.attributes);this.changed={}}v=this.attributes,j=this._previousAttributes;if(this.idAttribute in i){this.id=i[this.idAttribute]}for(A in i){p=i[A];if(!aq.isEqual(v[A],p)){g.push(A)}if(!aq.isEqual(j[A],p)){this.changed[A]=p}else{delete this.changed[A]}w?delete v[A]:v[A]=p}if(!k){if(g.length){this._pending=b}for(var m=0,q=g.length;m<q;m++){this.trigger("change:"+g[m],this,v[g[m]],b)}}if(x){return this}if(!k){while(this._pending){b=this._pending;this._pending=false;this.trigger("change",this,b)}}this._pending=false;this._changing=false;return this},unset:function(a,b){return this.set(a,void 0,aq.extend({},b,{unset:true}))},clear:function(a){var c={};for(var b in this.attributes){c[b]=void 0}return this.set(c,aq.extend({},a,{unset:true}))},hasChanged:function(a){if(a==null){return !aq.isEmpty(this.changed)}return aq.has(this.changed,a)},changedAttributes:function(a){if(!a){return this.hasChanged()?aq.clone(this.changed):false}var d,c=false;var b=this._changing?this._previousAttributes:this.attributes;for(var f in a){if(aq.isEqual(b[f],d=a[f])){continue}(c||(c={}))[f]=d}return c},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return aq.clone(this._previousAttributes)},fetch:function(a){a=a?aq.clone(a):{};if(a.parse===void 0){a.parse=true}var c=this;var b=a.success;a.success=function(d){if(!c.set(c.parse(d,a),a)){return false}if(b){b(c,d,a)}c.trigger("sync",c,d,a)};ai(this,a);return this.sync("read",this,a)},save:function(k,g,b){var l,d,i,c=this.attributes;if(k==null||typeof k==="object"){l=k;b=g}else{(l={})[k]=g}b=aq.extend({validate:true},b);if(l&&!b.wait){if(!this.set(l,b)){return false}}else{if(!this._validate(l,b)){return false}}if(l&&b.wait){this.attributes=aq.extend({},c,l)}if(b.parse===void 0){b.parse=true}var f=this;var j=b.success;b.success=function(a){f.attributes=c;var h=f.parse(a,b);if(b.wait){h=aq.extend(l||{},h)}if(aq.isObject(h)&&!f.set(h,b)){return false}if(j){j(f,a,b)}f.trigger("sync",f,a,b)};ai(this,b);d=this.isNew()?"create":b.patch?"patch":"update";if(d==="patch"){b.attrs=l}i=this.sync(d,this,b);if(l&&b.wait){this.attributes=c}return i},destroy:function(a){a=a?aq.clone(a):{};var d=this;var c=a.success;var b=function(){d.trigger("destroy",d,d.collection,a)};a.success=function(e){if(a.wait||d.isNew()){b()}if(c){c(d,e,a)}if(!d.isNew()){d.trigger("sync",d,e,a)}};if(this.isNew()){a.success();return false}ai(this,a);var f=this.sync("delete",this,a);if(!a.wait){b()}return f},url:function(){var a=aq.result(this,"urlRoot")||aq.result(this.collection,"url")||L();if(this.isNew()){return a}return a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(a){return this._validate({},aq.extend(a||{},{validate:true}))},_validate:function(a,c){if(!c.validate||!this.validate){return true}a=aq.extend({},this.attributes,a);var b=this.validationError=this.validate(a,c)||null;if(!b){return true}this.trigger("invalid",this,b,aq.extend(c,{validationError:b}));return false}});var ad=["keys","values","pairs","invert","pick","omit"];aq.each(ad,function(a){aj.prototype[a]=function(){var b=ak.call(arguments);b.unshift(this.attributes);return aq[a].apply(aq,b)}});var at=av.Collection=function(a,b){b||(b={});if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,aq.extend({silent:true},b))}};var am={add:true,remove:true,merge:true};var aa={add:true,remove:false};aq.extend(at.prototype,ae,{model:aj,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return av.sync.apply(this,arguments)},add:function(a,b){return this.set(a,aq.extend({merge:false},b,aa))},remove:function(c,g){var f=!aq.isArray(c);c=f?[c]:aq.clone(c);g||(g={});var d,i,b,h;for(d=0,i=c.length;d<i;d++){h=c[d]=this.get(c[d]);if(!h){continue}delete this._byId[h.id];delete this._byId[h.cid];b=this.indexOf(h);this.models.splice(b,1);this.length--;if(!g.silent){g.index=b;h.trigger("remove",h,this,g)}this._removeReference(h,g)}return f?c[0]:c},set:function(C,U){U=aq.defaults({},U,am);if(U.parse){C=this.parse(C,U)}var I=!aq.isArray(C);C=I?C?[C]:[]:aq.clone(C);var H,N,aE,M,R,q,O;var aC=U.at;var T=this.model;var aB=this.comparator&&aC==null&&U.sort!==false;var p=aq.isString(this.comparator)?this.comparator:null;var S=[],i=[],aF={};var aD=U.add,m=U.merge,j=U.remove;var A=!aB&&aD&&j?[]:false;for(H=0,N=C.length;H<N;H++){R=C[H]||{};if(R instanceof aj){aE=M=R}else{aE=R[T.prototype.idAttribute||"id"]}if(q=this.get(aE)){if(j){aF[q.cid]=true}if(m){R=R===M?M.attributes:R;if(U.parse){R=q.parse(R,U)}q.set(R,U);if(aB&&!O&&q.hasChanged(p)){O=true}}C[H]=q}else{if(aD){M=C[H]=this._prepareModel(R,U);if(!M){continue}S.push(M);this._addReference(M,U)}}M=q||M;if(A&&(M.isNew()||!aF[M.id])){A.push(M)}aF[M.id]=true}if(j){for(H=0,N=this.length;H<N;++H){if(!aF[(M=this.models[H]).cid]){i.push(M)}}if(i.length){this.remove(i,U)}}if(S.length||A&&A.length){if(aB){O=true}this.length+=S.length;if(aC!=null){for(H=0,N=S.length;H<N;H++){this.models.splice(aC+H,0,S[H])}}else{if(A){this.models.length=0}var P=A||S;for(H=0,N=P.length;H<N;H++){this.models.push(P[H])}}}if(O){this.sort({silent:true})}if(!U.silent){for(H=0,N=S.length;H<N;H++){(M=S[H]).trigger("add",M,this,U)}if(O||A&&A.length){this.trigger("sort",this,U)}}return I?C[0]:C},reset:function(a,d){d||(d={});for(var c=0,b=this.models.length;c<b;c++){this._removeReference(this.models[c],d)}d.previousModels=this.models;this._reset();a=this.add(a,aq.extend({silent:true},d));if(!d.silent){this.trigger("reset",this,d)}return a},push:function(a,b){return this.add(a,aq.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,aq.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return ak.apply(this.models,arguments)},get:function(a){if(a==null){return void 0}return this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){if(aq.isEmpty(a)){return b?void 0:[]}return this[b?"find":"filter"](function(d){for(var c in a){if(a[c]!==d.get(c)){return false}}return true})},findWhere:function(a){return this.where(a,true)},sort:function(a){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}a||(a={});if(aq.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(aq.bind(this.comparator,this))}if(!a.silent){this.trigger("sort",this,a)}return this},pluck:function(a){return aq.invoke(this.models,"get",a)},fetch:function(a){a=a?aq.clone(a):{};if(a.parse===void 0){a.parse=true}var c=a.success;var b=this;a.success=function(d){var e=a.reset?"reset":"set";b[e](d,a);if(c){c(b,d,a)}b.trigger("sync",b,d,a)};ai(this,a);return this.sync("read",this,a)},create:function(a,d){d=d?aq.clone(d):{};if(!(a=this._prepareModel(a,d))){return false}if(!d.wait){this.add(a,d)}var c=this;var b=d.success;d.success=function(f,e){if(d.wait){c.add(f,d)}if(b){b(f,e,d)}};a.save(null,d);return a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,c){if(a instanceof aj){return a}c=c?aq.clone(c):{};c.collection=this;var b=new this.model(a,c);if(!b.validationError){return b}this.trigger("invalid",this,b.validationError,c);return false},_addReference:function(a,b){this._byId[a.cid]=a;if(a.id!=null){this._byId[a.id]=a}if(!a.collection){a.collection=this}a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){if(this===a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,d,a,c){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(d,c)}if(d&&b==="change:"+d.idAttribute){delete this._byId[d.previous(d.idAttribute)];if(d.id!=null){this._byId[d.id]=d}}this.trigger.apply(this,arguments)}});var aA=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];aq.each(aA,function(a){at.prototype[a]=function(){var b=ak.call(arguments);b.unshift(this.models);return aq[a].apply(aq,b)}});var ay=["groupBy","countBy","sortBy","indexBy"];aq.each(ay,function(a){at.prototype[a]=function(d,c){var b=aq.isFunction(d)?d:function(e){return e.get(d)};return aq[a](this.models,b,c)}});var ac=av.View=function(a){this.cid=aq.uniqueId("view");a||(a={});aq.extend(this,aq.pick(a,W));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var ab=/^(\S+)\s*(.*)$/;var W=["model","collection","el","id","attributes","className","tagName","events"];aq.extend(ac.prototype,ae,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(b,a){if(this.$el){this.undelegateEvents()}this.$el=b instanceof av.$?b:av.$(b);this.el=this.$el[0];if(a!==false){this.delegateEvents()}return this},delegateEvents:function(c){if(!(c||(c=aq.result(this,"events")))){return this}this.undelegateEvents();for(var g in c){var f=c[g];if(!aq.isFunction(f)){f=this[c[g]]}if(!f){continue}var d=g.match(ab);var h=d[1],b=d[2];f=aq.bind(f,this);h+=".delegateEvents"+this.cid;if(b===""){this.$el.on(h,f)}else{this.$el.on(h,b,f)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var a=aq.extend({},aq.result(this,"attributes"));if(this.id){a.id=aq.result(this,"id")}if(this.className){a["class"]=aq.result(this,"className")}var b=av.$("<"+aq.result(this,"tagName")+">").attr(a);this.setElement(b,false)}else{this.setElement(aq.result(this,"el"),false)}}});av.sync=function(c,f,e){var i=B[c];aq.defaults(e||(e={}),{emulateHTTP:av.emulateHTTP,emulateJSON:av.emulateJSON});var b={type:i,dataType:"json"};if(!e.url){b.url=aq.result(f,"url")||L()}if(e.data==null&&f&&(c==="create"||c==="update"||c==="patch")){b.contentType="application/json";b.data=JSON.stringify(e.attrs||f.toJSON(e))}if(e.emulateJSON){b.contentType="application/x-www-form-urlencoded";b.data=b.data?{model:b.data}:{}}if(e.emulateHTTP&&(i==="PUT"||i==="DELETE"||i==="PATCH")){b.type="POST";if(e.emulateJSON){b.data._method=i}var g=e.beforeSend;e.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",i);if(g){return g.apply(this,arguments)}}}if(b.type!=="GET"&&!e.emulateJSON){b.processData=false}if(b.type==="PATCH"&&ao){b.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var d=e.xhr=av.ajax(aq.extend(b,e));f.trigger("request",f,d,e);return d};var ao=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var B={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};av.ajax=function(){return av.$.ajax.apply(av.$,arguments)};var Z=av.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var D=/\((.*?)\)/g;var V=/(\(\?)?:\w+/g;var Y=/\*\w+/g;var Q=/[\-{}\[\]+?.,\\\^$|#\s]/g;aq.extend(Z.prototype,ae,{initialize:function(){},route:function(a,c,b){if(!aq.isRegExp(a)){a=this._routeToRegExp(a)}if(aq.isFunction(c)){b=c;c=""}if(!b){b=this[c]}var d=this;av.history.route(a,function(f){var e=d._extractParameters(a,f);d.execute(b,e);d.trigger.apply(d,["route:"+c].concat(e));d.trigger("route",c,e);av.history.trigger("route",d,c,e)});return this},execute:function(a,b){if(a){a.apply(this,b)}},navigate:function(b,a){av.history.navigate(b,a);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=aq.result(this,"routes");var a,b=aq.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(Q,"\\$&").replace(D,"(?:$1)?").replace(V,function(b,c){return c?b:"([^/?]+)"}).replace(Y,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,c){var b=a.exec(c).slice(1);return aq.map(b,function(d,f){if(f===b.length-1){return d||null}return d?decodeURIComponent(d):null})}});var K=av.History=function(){this.handlers=[];aq.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var F=/^[#\/]|\s+$/g;var J=/^\/+|\/+$/g;var G=/msie [\w.]+/;var X=/\/$/;var ap=/#.*$/;K.started=false;aq.extend(K.prototype,ae,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(b,c){if(b==null){if(this._hasPushState||!this._wantsHashChange||c){b=decodeURI(this.location.pathname+this.location.search);var a=this.root.replace(X,"");if(!b.indexOf(a)){b=b.slice(a.length)}}else{b=this.getHash()}}return b.replace(F,"")},start:function(c){if(K.started){throw new Error("Backbone.history has already been started")}K.started=true;this.options=aq.extend({root:"/"},this.options,c);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var d=document.documentMode;var g=G.exec(navigator.userAgent.toLowerCase())&&(!d||d<=7);this.root=("/"+this.root+"/").replace(J,"/");if(g&&this._wantsHashChange){var b=av.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=b.hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){av.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&"onhashchange" in window&&!g){av.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=e;var f=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else{if(this._hasPushState&&this.atRoot()&&f.hash){this.fragment=this.getHash().replace(F,"");this.history.replaceState({},document.title,this.root+this.fragment)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){av.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}K.started=false},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getFragment(this.getHash(this.iframe))}if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()},loadUrl:function(a){a=this.fragment=this.getFragment(a);return aq.any(this.handlers,function(b){if(b.route.test(a)){b.callback(a);return true}})},navigate:function(b,c){if(!K.started){return false}if(!c||c===true){c={trigger:!!c}}var a=this.root+(b=this.getFragment(b||""));b=b.replace(ap,"");if(this.fragment===b){return}this.fragment=b;if(b===""&&a!=="/"){a=a.slice(0,-1)}if(this._hasPushState){this.history[c.replace?"replaceState":"pushState"]({},document.title,a)}else{if(this._wantsHashChange){this._updateHash(this.location,b,c.replace);if(this.iframe&&b!==this.getFragment(this.getHash(this.iframe))){if(!c.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,b,c.replace)}}else{return this.location.assign(a)}}if(c.trigger){return this.loadUrl(b)}},_updateHash:function(b,d,a){if(a){var c=b.href.replace(/(javascript:|#).*$/,"");b.replace(c+"#"+d)}else{b.hash="#"+d}}});av.history=new K;var z=function(a,d){var c=this;var b;if(a&&aq.has(a,"constructor")){b=a.constructor}else{b=function(){return c.apply(this,arguments)}}aq.extend(b,c,d);var f=function(){this.constructor=b};f.prototype=c.prototype;b.prototype=new f;if(a){aq.extend(b.prototype,a)}b.__super__=c.prototype;return b};aj.extend=at.extend=Z.extend=ac.extend=K.extend=z;var L=function(){throw new Error('A "url" property or function must be specified')};var ai=function(b,c){var a=c.error;c.error=function(d){if(a){a(b,d,c)}b.trigger("error",b,d,c)}};return av});
(function(d,c){typeof exports=="object"&&typeof require=="function"?module.exports=c(require("underscore"),require("backbone")):typeof define=="function"&&define.amd?define(["underscore","backbone"],function(b,a){return c(b||d._,a||d.Backbone)}):c(_,Backbone)})(this,function(f,e){function h(){return((1+Math.random())*65536|0).toString(16).substring(1)}function g(){return h()+h()+"-"+h()+"-"+h()+"-"+h()+"-"+h()+h()+h()}return e.LocalStorage=window.Store=function(d){if(!this.localStorage){throw"Backbone.localStorage: Environment does not support localStorage."}this.name=d;var c=this.localStorage().getItem(this.name);this.records=c&&c.split(",")||[]},f.extend(e.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(b){return b.id||(b.id=g(),b.set(b.idAttribute,b.id)),this.localStorage().setItem(this.name+"-"+b.id,JSON.stringify(b)),this.records.push(b.id.toString()),this.save(),this.find(b)},update:function(a){return this.localStorage().setItem(this.name+"-"+a.id,JSON.stringify(a)),f.include(this.records,a.id.toString())||this.records.push(a.id.toString()),this.save(),this.find(a)},find:function(b){return this.jsonData(this.localStorage().getItem(this.name+"-"+b.id))},findAll:function(){return(f.chain||f)(this.records).map(function(b){return this.jsonData(this.localStorage().getItem(this.name+"-"+b))},this).compact().value()},destroy:function(a){return a.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+a.id),this.records=f.reject(this.records,function(b){return b===a.id.toString()}),this.save(),a)},localStorage:function(){return localStorage},jsonData:function(b){return b&&JSON.parse(b)},_clear:function(){var a=this.localStorage(),d=new RegExp("^"+this.name+"-");a.removeItem(this.name),(f.chain||f)(a).keys().filter(function(b){return d.test(b)}).each(function(b){a.removeItem(b)}),this.records.length=0},_storageSize:function(){return this.localStorage().length}}),e.LocalStorage.sync=window.Store.sync=e.localSync=function(b,p,o){var n=p.localStorage||p.collection.localStorage,m,l,k=e.$.Deferred&&e.$.Deferred();try{switch(b){case"read":m=p.id!=undefined?n.find(p):n.findAll();break;case"create":m=n.create(p);break;case"update":m=n.update(p);break;case"delete":m=n.destroy(p)}}catch(j){j.code===22&&n._storageSize()===0?l="Private browsing is unsupported":l=j.message}return m?(o&&o.success&&(e.VERSION==="0.9.10"?o.success(p,m,o):o.success(m)),k&&k.resolve(m)):(l=l?l:"Record Not Found",o&&o.error&&(e.VERSION==="0.9.10"?o.error(p,l,o):o.error(l)),k&&k.reject(l)),o&&o.complete&&o.complete(m),k&&k.promise()},e.ajaxSync=e.sync,e.getSyncMethod=function(b){return b.localStorage||b.collection&&b.collection.localStorage?e.localSync:e.ajaxSync},e.sync=function(b,j,i){return e.getSyncMethod(j).apply(this,[b,j,i])},e.LocalStorage});
var NetexUtils={isLandscape:(function(){return $("#page-wrap").hasClass("landscape")})(),CalcSupported:(function(){var a=document.createElement("div");a.style.cssText="width:calc(10px); width:-webkit-calc(10px);";return(!!a.style.length)})(),isLocalAndIE:(function(){return(((/MSIE (\d+\.\d+);/.test(navigator.userAgent)===true)||(!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/))))&&((location.protocol!=="file:")===false))})(),androidVersion:(function(){var b=b||navigator.userAgent;var a=b.match(/Android\s([0-9\.]*)/);return a?parseFloat(a[1],10):-1})(),getNavigatorLang:(function(){return(navigator.browserLanguage?navigator.browserLanguage:navigator.language).substring(0,2)})(),insideTimeLimit:function(c,a,b){return(a-c<=b)},isIpad:(function(){return navigator.userAgent.match(/iPad/i)!==null})(),hasFileApi:(function(){return window.File&&window.FileReader&&window.FileList&&window.Blob})(),hasFlash:(function(){var b=false;try{if(window.ActiveXObject){var h=null;try{h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(g){return}if(h){b=new Boolean(true);b.version=h.GetVariable("$version").substring(4);b.version=b.version.split(",")[0]}}else{var f="Shockwave Flash";var i="application/x-shockwave-flash";var c=navigator.plugins[f];if(c===undefined){return false}else{b=new Boolean(true);var d=c.description;if(d&&!(typeof c.mimeTypes!="undefined"&&c.mimeTypes[i]&&!c.mimeTypes[i].enabledPlugin)){var a=d.replace(f,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".");b.version=parseInt(a[0].match(/\d+/),10)}}}return b}catch(g){return false}})(),getStringDate:function(a){return new Date(a).toLocaleDateString()},removeMedia:function(b){try{$(b).find("audio").each(function(c,d){$(d)[0].pause();$(d)[0].src="";$(d).children("source").prop("src","").remove();$(d).remove().length=0;delete (this)});$(b).find("video").each(function(c,d){$(d)[0].pause();$(d)[0].src="";$(d).children("source").prop("src","").remove();$(d).remove().length=0;delete (this)})}catch(a){}},getCurrentMatchMedia:function(){var b=["xxlarge","xlarge","large","medium","small"];return"ntx-tmp-"+b[_.indexOf(_.map(b,function(c,a){return matchMedia(Foundation.media_queries[c]).matches}),true)]}};
Ntxtmp.CourseId=document.getElementsByTagName("body")[0].getAttribute("data-course-id");Ntxtmp.Main=(function(){var f=function(){Ntxtmp.Singleton.RouterModel=new Ntxtmp.Model.RouterModel();Ntxtmp.Singleton.HeaderModel=new Ntxtmp.Model.HeaderModel();Ntxtmp.Singleton.PopupModel=new Ntxtmp.Model.PopupModel();Ntxtmp.Singleton.DialogModel=new Ntxtmp.Model.DialogModel();Ntxtmp.Singleton.ContainerModel=new Ntxtmp.Model.ContainerModel();Ntxtmp.Singleton.BookmarkModel=new Ntxtmp.Model.BookmarkModel();Ntxtmp.Singleton.FlashcardModel=new Ntxtmp.Model.FlashcardModel();Ntxtmp.Singleton.NotepadModel=new Ntxtmp.Model.NotepadModel();Ntxtmp.Singleton.CarrouselModel=new Ntxtmp.Model.CarrouselModel();Ntxtmp.Singleton.DrawToolbarModel=new Ntxtmp.Model.DrawToolbarModel();Ntxtmp.Singleton.AnswerKeyWidgetModel=new Ntxtmp.Model.AnswerKeyWidgetModel();Ntxtmp.Singleton.DbModel=new Ntxtmp.Model.DbModel();Ntxtmp.Singleton.AnalyticsApiModel=new Ntxtmp.Model.AnalyticsApiModel()},d=function(){Ntxtmp.Singleton.PageCollection=new Ntxtmp.Collection.PageCollection();Ntxtmp.Singleton.PopupCollection=new Ntxtmp.Collection.PopupCollection();Ntxtmp.Singleton.BookmarkCollection=new Ntxtmp.Collection.BookmarkCollection();Ntxtmp.Singleton.NoteCollection=new Ntxtmp.Collection.NoteCollection();Ntxtmp.Singleton.AttachmentCollection=new Ntxtmp.Collection.AttachmentCollection();Ntxtmp.Singleton.CanvasCollection=new Ntxtmp.Collection.CanvasCollection();Ntxtmp.Singleton.LinkCollection=new Ntxtmp.Collection.LinkCollection();Ntxtmp.Singleton.MaskCollection=new Ntxtmp.Collection.MaskCollection();Ntxtmp.Singleton.AnswerKeyCollection=new Ntxtmp.Collection.AnswerKeyCollection();Ntxtmp.Singleton.ActivityCollection=new Ntxtmp.Collection.ActivityCollection()},b=function(){Ntxtmp.Singleton.PageView=new Ntxtmp.View.PageView({model:Ntxtmp.Singleton.PageCollection,el:$("#pageView")});Ntxtmp.Singleton.PopupView=new Ntxtmp.View.PopupView({model:Ntxtmp.Singleton.PopupCollection,el:$("#popupView")});Ntxtmp.Singleton.DialogView=new Ntxtmp.View.DialogView({model:Ntxtmp.Singleton.DialogModel,el:$("#dialog-overlay")});Ntxtmp.Singleton.CourseView=new Ntxtmp.View.CourseView({model:Ntxtmp.Singleton.PageCollection,el:$("body")});Ntxtmp.Singleton.HeaderView=new Ntxtmp.View.HeaderView({model:Ntxtmp.Singleton.HeaderModel,el:$("#main-menu-wrap")});Ntxtmp.Singleton.ContainerView=new Ntxtmp.View.ContainerView({model:Ntxtmp.Singleton.ContainerModel,el:$("#item-container")});Ntxtmp.Singleton.FlashcardView=new Ntxtmp.View.FlashcardView({model:Ntxtmp.Singleton.FlashcardModel,el:$("#item-container-placeholder")});Ntxtmp.Singleton.BookmarkView=new Ntxtmp.View.BookmarkView({model:Ntxtmp.Singleton.BookmarkCollection});Ntxtmp.Singleton.NoteView=new Ntxtmp.View.NoteView({model:Ntxtmp.Singleton.NoteCollection,el:$("#pageView")});Ntxtmp.Singleton.AttachmentView=new Ntxtmp.View.AttachmentView({model:Ntxtmp.Singleton.AttachmentCollection,el:$("#pageView")});Ntxtmp.Singleton.MaskView=new Ntxtmp.View.MaskView({model:Ntxtmp.Singleton.MaskCollection,el:$("#pageView")});Ntxtmp.Singleton.AnswerKeyView=new Ntxtmp.View.AnswerKeyView({model:Ntxtmp.Singleton.AnswerKeyWidgetModel,el:$("#answer-key-widget")});Ntxtmp.Singleton.NotepadView=new Ntxtmp.View.NotepadView({model:Ntxtmp.Singleton.NotepadModel,el:$("#notepad-container")});Ntxtmp.Singleton.CanvasView=new Ntxtmp.View.CanvasView({model:Ntxtmp.Singleton.CanvasCollection});Ntxtmp.Singleton.DrawToolbarView=new Ntxtmp.View.DrawToolbarView({model:Ntxtmp.Singleton.DrawToolbarModel,el:$("#draw-toolbar")})},e=function(h){return h.text()||h.html()},g=function(){if(!NetexUtils.isLocalAndIE){Ntxtmp.Singleton.BookmarkCollection.fetch();Ntxtmp.Singleton.NoteCollection.fetch();Ntxtmp.Singleton.LinkCollection.fetch();Ntxtmp.Singleton.CanvasCollection.fetch();Ntxtmp.Singleton.AttachmentCollection.fetch()}$("noscript[data-type='content']").each(function(h,k){var i=$(k),j=e(i);Ntxtmp.Singleton.PageCollection.add({html:j,pageId:i.attr("data-page-id"),pageTitle:i.attr("data-page-title"),pageNumber:i.attr("data-page-number"),book:i.attr("data-book"),position:Ntxtmp.Singleton.PageCollection.where({book:i.attr("data-book")}).length});var l="page-canvas-"+i.attr("data-page-id");if(!Ntxtmp.Singleton.CanvasCollection.getById(l)){Ntxtmp.Singleton.CanvasCollection.addModel({id:l})}i.remove()});if(!Ntxtmp.Singleton.CanvasCollection.getById("notepad-canvas-1")){Ntxtmp.Singleton.CanvasCollection.addModel({id:"notepad-canvas-1"})}if(!Ntxtmp.Singleton.CanvasCollection.getById("notepad-canvas-2")){Ntxtmp.Singleton.CanvasCollection.addModel({id:"notepad-canvas-2"})}if(!Ntxtmp.Singleton.CanvasCollection.getById("notepad-canvas-3")){Ntxtmp.Singleton.CanvasCollection.addModel({id:"notepad-canvas-3"})}$("noscript[data-type='popup']").each(function(h,k){var i=$(k),j=e(i);Ntxtmp.Singleton.PopupCollection.add({html:j,popupId:i.attr("data-id")});i.remove()});$("noscript[data-type='answer-key']").each(function(h,k){var i=$(k),j=e(i);Ntxtmp.Singleton.AnswerKeyCollection.add({page:i.attr("data-page-id"),book:i.attr("data-book"),active:i.attr("data-active"),number:i.attr("data-number")||"&nbsp;",color:i.attr("data-color"),id:i.attr("data-answer-key-id"),title:i.attr("data-title"),html:j});i.remove()});$("noscript[data-type='activity']").each(function(h,l){var i=$(l),k=e(i),m=$(k).find("[data-activity-type]"),j="T0-Presentation";if(m.length>0){_.each(m,function(o){var n=$(o).data("activity-type");if(n!=="T0-Presentation"){j=n}})}Ntxtmp.Singleton.ActivityCollection.add({id:i.data("id"),html:k,type:j});i.remove()})},a=function(){$("[data-ntx-component]").each(function(h,j){var i=$(j),k=Ntxtmp.Components[i.attr("data-ntx-component")];if(k){k.inserted(i)}})},c=function(){Ntxtmp.Singleton.CourseRouter=new Ntxtmp.Router.CourseRouter();Backbone.history.start()};return{init:function(){if(NetexUtils.isIpad){$("body").addClass("ipad")}if(NetexUtils.hasFlash){$("body").addClass("flash")}f();d();g();b();a();c();if(Ntxtmp.Singleton.DbModel.requiredFeaturesSupported($("#attachment-upload"))){Ntxtmp.Singleton.DbModel.openDB()}$trackingConfig=$("noscript#gaTrackingConfig").remove();Ntxtmp.Singleton.AnalyticsApiModel.set({trackingId:$trackingConfig.data("ga-tracking-id"),productName:$trackingConfig.data("ga-tracking-product-name"),courseTitle:$trackingConfig.data("ga-tracking-course-name"),level:$trackingConfig.data("ga-tracking-level-name"),unit:$trackingConfig.data("ga-tracking-unit-name"),});Ntxtmp.Singleton.AnalyticsApiModel.loadScript()}}})();$(function(){Ntxtmp.Main.init()});function ipaddebuginit(){$("body").append('<div id="ipaddebug"></div>');$("#ipaddebug").css({position:"fixed",background:"white",bottom:0,left:0,right:0,height:"140px",color:"red","overflow-y":"auto"})}function ipaddebug(a){$("#ipaddebug").html(a)}function ipaddebuga(a){$("#ipaddebug").prepend(a)};
Ntxtmp.Model.PageModel=Backbone.Model.extend({defaults:{html:null,pageId:null,pageTitle:null,pageNumber:null,book:null,position:null,status:"N",rendered:null,activeMask:null},aStatus:["N","I","C","F","P"],validate:function(a,b){if(a.status){if(_.indexOf(this.aStatus,a.status)===-1){return"valor no vlido"}if(_.indexOf(this.aStatus,a.status)<_.indexOf(this.aStatus,this.get("status"))){return"valor no vlido"}}}});
Ntxtmp.Model.PopupModel=Backbone.Model.extend({defaults:{html:null,popupId:null}});
Ntxtmp.Model.DialogModel=Backbone.Model.extend({defaults:{html:null,customHtml:null}});
Ntxtmp.Model.ContainerModel=Backbone.Model.extend({defaults:{activeContainer:null,contentType:null}});
Ntxtmp.Model.RouterModel=Backbone.Model.extend({defaults:{book:null,page:null,activeContainer:null},validate:function(b,c){var a=b.book||this.get("book")||Ntxtmp.Singleton.CourseRouter.getDefaultBook(),d=b.page||this.get("page")||Ntxtmp.Singleton.PageCollection.getFirstPageOfBook(a);if(b.book){if(_.indexOf(Ntxtmp.Singleton.PageCollection.pluck("book"),b.book)===-1){Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+this.get("book")+"/pag/"+d,{trigger:false});return"Libro no encontrado"}}if(b.page){if(Ntxtmp.Singleton.PageCollection.where({book:a,pageId:b.page}).length!==1){Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+a+"/pag/"+this.get("page"),{trigger:false});return"Pgina no encontrada"}}},goNext:function(){var a=Ntxtmp.Singleton.PageCollection.getNextModel();if(a){Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+a.get("book")+"/pag/"+a.get("pageId"))}},goPrev:function(){var a=Ntxtmp.Singleton.PageCollection.getPrevModel();if(a){Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+a.get("book")+"/pag/"+a.get("pageId"))}},goStart:function(){var a=Ntxtmp.Singleton.PageCollection.getFirstPageOfBook(this.get("book"));if(a!==null){Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+a.get("book")+"/pag/"+a.get("pageId"))}},gotoPagePositionCurrentBook:function(a){var b=Ntxtmp.Singleton.PageCollection.getModelByPositionAndBook(a,this.get("book"));if(b!==null){Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+b.get("book")+"/pag/"+b.get("pageId"))}},gotoBook:function(b){var a=Ntxtmp.Singleton.PageCollection.getFirstPageOfBook(b);if(a!==null){Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+b+"/pag/"+a.get("pageId"))}}});
Ntxtmp.Model.HeaderModel=Backbone.Model.extend({defaults:{disabled:false,activeSubmenu:null,activePopup:null,activeTool:null,zoomLevel:0,titleActivityBook:null,titlePupilBook:null}});
Ntxtmp.Model.FlashcardModel=Backbone.Model.extend({defaults:{title:null,imageSrc:null}});
Ntxtmp.Model.BookmarkModel=Backbone.Model.extend({defaults:{book:null,pageId:null,pageNumber:null}});
Ntxtmp.Model.NoteModel=Backbone.Model.extend({defaults:{id:null,book:null,page:null,text:null,top:null,left:null,width:null,height:null,order:0,expanded:true}});
Ntxtmp.Model.CarrouselModel=Backbone.Model.extend({defaults:{itemCount:null,selectedItem:null,position:null,maxItems:null},nextPosition:function(){if(this.get("itemCount")<=this.get("maxItems")){}else{if(this.get("position")<this.get("itemCount")-this.get("maxItems")){this.set("position",this.get("position")+1)}}},prevPosition:function(){if(this.get("itemCount")<=this.get("maxItems")){}else{if(this.get("position")>0){this.set("position",this.get("position")-1)}}}});
Ntxtmp.Model.AttachmentModel=Backbone.Model.extend({defaults:{id:null,book:null,page:null,dbKey:null,top:null,left:null}});
Ntxtmp.Model.NotepadModel=Backbone.Model.extend({defaults:{currentCanvas:null},gotoPrev:function(){if(this.hasPrev()){this.set("currentCanvas",this.get("currentCanvas")-1)}},gotoNext:function(){if(this.hasNext()){this.set("currentCanvas",this.get("currentCanvas")+1)}},hasPrev:function(){return this.get("currentCanvas")>1},hasNext:function(){return this.get("currentCanvas")<3}});
Ntxtmp.Model.LinkModel=Backbone.Model.extend({defaults:{id:null,text:null,url:null}});
Ntxtmp.Model.MaskModel=Backbone.Model.extend({defaults:{id:null,active:null,top:null,left:null,width:null,height:null,order:0}});
Ntxtmp.Model.AnswerKeyModel=Backbone.Model.extend({defaults:{id:null,page:null,book:null,active:null,number:null,html:null,color:null,title:null}});
Ntxtmp.Model.AnswerKeyWidgetModel=Backbone.Model.extend({defaults:{maximized:false,top:null,left:null,width:null,height:null}});
Ntxtmp.Model.DrawToolbarModel=Backbone.Model.extend({defaults:{activeSubmenu:null,activeTool:"pointer",pencilStroke:6,markerStroke:6,rubberStroke:20,color:"#000",expanded:true},getStroke:function(){switch(this.get("activeTool")){case"pencil":return this.get("pencilStroke");break;case"marker":return this.get("markerStroke");break;case"rubber":return this.get("rubberStroke");break;default:return 0;break}}});
Ntxtmp.Model.CanvasModel=Backbone.Model.extend({defaults:{id:null,paintingEnabled:false,strokes:[],oldX:null,oldY:null}});
Ntxtmp.Model.ActivityModel=Backbone.Model.extend({defaults:{id:null,html:null,type:null}});
Ntxtmp.Model.AnalyticsApiModel=Backbone.Model.extend({defaults:{trackingEnabled:false,trackingId:null,productName:null,courseTitle:null,level:null,unit:null},loadScript:function(){this.set("trackingEnabled",(this.get("trackingId")+this.get("productName")+this.get("courseName")).trim()!=="");if(this.get("trackingEnabled")){$("body").append("<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','http://www.google-analytics.com/analytics.js','ga');"+(window.location.protocol==="file:"?"ga('create', '"+this.get("trackingId")+"',{'storage': 'none','clientId': '"+this.getUserIdForFileProtocol()+"'});ga('set', 'checkProtocolTask', function(){ /* nothing */ });":"ga('create', '"+this.get("trackingId")+"','auto');")+"ga('set', 'location', 'http://www.cambridge.org/appanalytics/"+this.get("productName")+"/"+this.get("courseTitle")+"/"+this.get("level")+"/"+this.get("unit")+"');ga('send', 'pageview');<\/script>")}},trackEvent:function(b,c,a){if(this.get("trackingEnabled")&&window.ga){if(typeof a!=="undefined"){ga("send","event",b,c,a)}else{if(typeof c!=="undefined"){ga("send","event",b,c)}else{ga("send","event",b)}}}},getUserIdForFileProtocol:function(){var b;if("localStorage" in window&&window.localStorage!==null){var a=this.generateLocalStorageKey();b=localStorage.getItem(a);if(!b){b=this.generateUniqueId();localStorage.setItem(a,b)}}else{b=this.generateUniqueId()}return b},generateLocalStorageKey:function(){return this.get("productName")+"_"+this.get("courseTitle")+"_"+this.get("level")+"_"+this.get("unit")},generateUniqueId:function(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}});
Ntxtmp.Collection.PageCollection=Backbone.Collection.extend({model:Ntxtmp.Model.PageModel,initialize:function(){},getCurrentModel:function(){var a=this.where({book:Ntxtmp.Singleton.RouterModel.get("book"),pageId:Ntxtmp.Singleton.RouterModel.get("page")});return a.length===1?a[0]:null},getPositionCurrentModel:function(){return this.indexOf(this.getCurrentModel())},getCurrentHtml:function(){var a=this.getCurrentModel();return a===null?"":a.get("html")},existPageId:function(a){var b=this.where({pageId:a});return b.length>0},calculateStatusCurrentPage:function(){},getSuspend:function(){},updateStatusBySuspend:function(a){},getFirstPageOfBook:function(b){var a=this.getModelByPositionAndBook(0,b);return a!==null?a:this.length>0?this.at(0):null},getModelByPositionAndBook:function(c,b){var a=this.where({book:b,position:+c});return a.length===1?a[0]:null},getNextModel:function(b){var c=b||this.getCurrentModel(),d=c===null?null:c.get("position")+1,a=d===null?null:this.getModelByPositionAndBook(d,c.get("book"));return a},getPrevModel:function(b){var c=b||this.getCurrentModel(),d=c===null?null:c.get("position")-1,a=d===null?null:this.getModelByPositionAndBook(d,c.get("book"));return a},getPreviousPageIdByPageId:function(a){var c=this.where({pageId:a,book:Ntxtmp.Singleton.RouterModel.get("book")}),b=null;if(c.length===1){b=this.getPrevModel(c[0]);b=b!==null?b.get("pageId"):null}return b},getFirstModel:function(){},getPageDirection:function(){var d=Ntxtmp.Singleton.RouterModel.get("page"),e=Ntxtmp.Singleton.RouterModel.previousAttributes().page,c=this.where({pageId:d}),b=this.where({pageId:e}),a,f;if(e===null||c.length!==1||b.length!==1){return"unknow"}else{a=this.indexOf(c[0]);f=this.indexOf(b[0]);if(a>f){return"forward"}if(a<f){return"rewind"}return"unknow"}},countPageByBook:function(b){var a=this.where({book:b});return a.length},});
Ntxtmp.Collection.PopupCollection=Backbone.Collection.extend({model:Ntxtmp.Model.PopupModel,getById:function(a){var b=this.where({popupId:a});return b.length===1?b[0]:null},getActivePopup:function(){var a=this.where({popupId:Ntxtmp.Singleton.HeaderModel.get("activePopup")});return a.length===1?a[0]:null},getActivePopupHtml:function(){var a=this.getActivePopup();return a===null?"":a.get("html")}});
Ntxtmp.Collection.BookmarkCollection=Backbone.Collection.extend({model:Ntxtmp.Model.BookmarkModel,localStorage:NetexUtils.isLocalAndIE?null:new Backbone.LocalStorage("PresentationPlus_Bookmark_"+Ntxtmp.CourseId),initialize:function(){},existPageId:function(a){var b=this.where({pageId:a});return b.length>0},addBookmark:function(b){var a=new Ntxtmp.Model.BookmarkModel(b);this.add(a);a.save()},removeBookmark:function(a){this.findWhere({pageId:a}).destroy()}});
Ntxtmp.Collection.NoteCollection=Backbone.Collection.extend({model:Ntxtmp.Model.NoteModel,localStorage:NetexUtils.isLocalAndIE?null:new Backbone.LocalStorage("PresentationPlus_Note_"+Ntxtmp.CourseId),initialize:function(){},addNote:function(b){this.each(function(c){c.set("order",c.get("order")+1);c.save()});var a=new Ntxtmp.Model.NoteModel(b);this.add(a);a.save()},removeNote:function(a){this.findWhere({id:a}).destroy()},getModelByPageAndBook:function(c,b){var a=this.where({book:b,page:c});return a},getPrecedingModelsByOrder:function(d,c,a){var b=this.filter(function(e){return e.get("book")===c&&e.get("page")===d&&e.get("order")<a});return b},getById:function(b){var a=this.where({id:b});return a.length===1?a[0]:null}});
Ntxtmp.Collection.AttachmentCollection=Backbone.Collection.extend({model:Ntxtmp.Model.AttachmentModel,localStorage:NetexUtils.isLocalAndIE?null:new Backbone.LocalStorage("PresentationPlus_Attachment_"+Ntxtmp.CourseId),initialize:function(){},addAttachment:function(b){var a=new Ntxtmp.Model.AttachmentModel(b);this.add(a);a.save()},removeAttachment:function(c){var a=this.findWhere({id:c});if(a){var b=a.get("dbKey");a.destroy();Ntxtmp.Singleton.DbModel.removeAttachment(b)}},getModelByPageAndBook:function(c,b){var a=this.where({book:b,page:c});return a},getById:function(b){var a=this.where({id:b});return a.length===1?a[0]:null}});
Ntxtmp.Collection.LinkCollection=Backbone.Collection.extend({model:Ntxtmp.Model.LinkModel,localStorage:NetexUtils.isLocalAndIE?null:new Backbone.LocalStorage("PresentationPlus_Link_"+Ntxtmp.CourseId),initialize:function(){},addModel:function(b){var a=new Ntxtmp.Model.LinkModel(b);this.add(a);a.save()},modelExists:function(b,a){var c=this.where({text:b,url:a});return c.length>0}});
Ntxtmp.Collection.MaskCollection=Backbone.Collection.extend({model:Ntxtmp.Model.MaskModel,initialize:function(){},addMask:function(b){var a=new Ntxtmp.Model.MaskModel(b);this.add(a)},getCurrentModel:function(){var a=this.where({active:true});return a.length===1?a[0]:null},getPrecedingModelsByOrder:function(a){var b=this.filter(function(c){return c.get("order")<a});return b},getById:function(b){var a=this.where({id:b});return a.length===1?a[0]:null}});
Ntxtmp.Collection.AnswerKeyCollection=Backbone.Collection.extend({model:Ntxtmp.Model.AnswerKeyModel,initialize:function(){},getModelByPageAndBook:function(c,b){var a=this.where({book:b,page:c});return a},getModelByPageBookAndNumber:function(d,b,c){var a=this.where({book:b,page:d,number:c});return a[0]?a[0]:null},getById:function(b){var a=this.where({id:b});return a.length===1?a[0]:null}});
Ntxtmp.Collection.CanvasCollection=Backbone.Collection.extend({model:Ntxtmp.Model.CanvasModel,localStorage:NetexUtils.isLocalAndIE?null:new Backbone.LocalStorage("PresentationPlus_Canvas_"+Ntxtmp.CourseId),initialize:function(){},getById:function(b){var a=this.where({id:b});return a.length===1?a[0]:null},getCurrentModel:function(){var a=null;if(Ntxtmp.Singleton.HeaderModel.get("activeTool")==="notepad"){a=this.where({id:"notepad-canvas-"+Ntxtmp.Singleton.NotepadModel.get("currentCanvas")})}else{a=this.where({id:"page-canvas-"+Ntxtmp.Singleton.RouterModel.get("page")})}return a.length===1?a[0]:null},addModel:function(b){var a=new Ntxtmp.Model.CanvasModel(b);this.add(a);a.save()}});
Ntxtmp.Collection.ActivityCollection=Backbone.Collection.extend({model:Ntxtmp.Model.ActivityModel,initialize:function(){},getById:function(b){var a=this.where({id:b});return a.length===1?a[0]:null}});
Ntxtmp.View.PageView=Backbone.View.extend({events:{"click #nav-next":"nextPage","click #nav-prev":"prevPage","click .resources-tab .icon-toggle":"clickResourcesTab","click .activity-resource":"clickActivityResource","click .audio-resource":"clickAudioResource",pointerdown:"pointerdown",click:"clickPage"},initialize:function(){this.listenTo(Ntxtmp.Singleton.RouterModel,"change:page",this.transitionOut);this.listenTo(Ntxtmp.Singleton.RouterModel,"change:book",this.transitionOut);this.listenTo(Ntxtmp.Singleton.HeaderModel,"change:zoomLevel",this.changeZoomLevel);this.listenTo(Ntxtmp.Singleton.HeaderModel,"change:activeTool",this.changeHeaderActiveTool);this.listenTo(Ntxtmp.Singleton.DrawToolbarModel,"change:activeTool",this.changeActiveTool)},transitionOut:function(){var b=this.model.getPageDirection(),a;switch(b){case"forward":a=this.$el.attr("data-trans-out-forward");break;case"rewind":a=this.$el.attr("data-trans-out-rewind");break;default:a="none"}Ntxtmp.Singleton.AnswerKeyView.hide();Ntxtmp.Singleton.CourseView.closeAudioResourcePlayer();if(Modernizr.cssanimations&&a!=="none"){this.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){Ntxtmp.Singleton.PageView.$el.removeClass("animated "+a);Ntxtmp.Singleton.PageView.render()});this.$el.addClass("animated "+a)}else{this.render()}},render:function(){var a=Ntxtmp.Singleton.PageCollection.getCurrentModel();if(a){a.set("rendered",false)}var b=this.model.getCurrentHtml(),d=this,c;if(b!==""){$("html, body").scrollTop(0);this.notifyComponents("removed");c=$(b);c.whenLive({visibility:true},function(){Ntxtmp.Singleton.PageView.notifyComponents("inserted");Ntxtmp.Singleton.PageView.transitionIn();if(Ntxtmp.Singleton.PageCollection.getPrevModel()){d.$("#nav-prev").show()}else{d.$("#nav-prev").hide()}if(Ntxtmp.Singleton.PageCollection.getNextModel()){d.$("#nav-next").show()}else{d.$("#nav-next").hide()}});this.$el.empty();if(Ntxtmp.Singleton.HeaderModel.get("zoomLevel")===1){Ntxtmp.Singleton.HeaderModel.set({zoomLevel:0})}this.$el.append(c);Ntxtmp.Singleton.CanvasView.canvasInitialize()}return this},transitionIn:function(){var a=this.$el.attr("data-trans-in");if(Modernizr.cssanimations&&a!=="none"){this.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){Ntxtmp.Singleton.PageView.$el.removeClass("animated "+a);Ntxtmp.Singleton.PageView.rendered()});this.$el.addClass("animated "+a)}else{this.rendered()}},rendered:function(){var a=Ntxtmp.Singleton.PageCollection.getCurrentModel();a.set("rendered",true);Ntxtmp.Singleton.NoteView.setDragableResizable(".noteContainer");Ntxtmp.Singleton.MaskView.setDragableResizable(".maskContainer")},nextPage:function(){Ntxtmp.Singleton.HeaderModel.set({activePopup:null,activeSubmenu:null});Ntxtmp.Singleton.RouterModel.goNext()},prevPage:function(){Ntxtmp.Singleton.HeaderModel.set({activePopup:null,activeSubmenu:null});Ntxtmp.Singleton.RouterModel.goPrev()},notifyComponents:function(a){this.$("[data-ntx-component]").each(function(b,d){var c=$(d),e=Ntxtmp.Components[c.attr("data-ntx-component")];if(e){if(a==="inserted"){e.inserted(c)}if(a==="removed"){e.removed(c)}}})},clickResourcesTab:function(a){this.$(a.currentTarget).parent().toggleClass("expanded")},clickActivityResource:function(d){var c=$(d.currentTarget).attr("rel-activity");var b=Ntxtmp.Singleton.ActivityCollection.getById(c);if(b){$("#activity-placeholder").html(b.get("html"));$("#activity-overlay").fadeIn(300);var a=Number($("#pageView").css("height").split("px")[0]);var f=0;if($(".ntx-item-test-container").length>0){$(".ntx-item-test-container").each(function(e,g){f=$(this).css("height").split("px")[0];if(Number(f)>a){a=f}})}else{$(".itemTestLCComponent").each(function(e,g){f=$(this).css("height").split("px")[0];if(Number(f)>a){a=f}})}pageHeight=a+"px";$("#pageView").css("height",pageHeight);window.scrollTo(0,0)}},clickAudioResource:function(c){var a=$(c.target);Ntxtmp.Singleton.CourseView.resetAudioResourcePlayerState();$("#audio-resource-player").attr("data-id",a.attr("id"));$("#audio-resource-player").removeClass("hidden");$("#audio-resource-player").css("left","-600px");$("#audio-resource-player").animate({left:"80px"},600,"easeInOutQuint");$("#audio-resource-player").draggable({containment:"#pageView",cancel:".close",handle:".header"});$("#audio-resource-player #audio-player-wrap").html($("#audio-player-template").text());var b=$("#"+$("#audio-resource-player").attr("data-id")).find(".transcript").text();if(b.length==0){$("#transcript-buttons").removeClass("active")}else{$("#transcript-buttons").addClass("active")}$("#audio-resource-player audio source").attr("src",a.data("audio-src"));$("#audio-resource-player audio").get(0).load();$("#audio-resource-player").find(".netex-audio-player").audioNetex({mode:"html"})},pointerdown:function(c){var b=Ntxtmp.Singleton.PageCollection.getCurrentModel(),a=c.pageX-$("#pageView").offset().left,d=c.pageY-$("#pageView").offset().top;switch(Ntxtmp.Singleton.HeaderModel.get("activeTool")){case"mask":if(!$(c.target).hasClass("maskContainer")){c.preventDefault();c.stopPropagation();Ntxtmp.Singleton.MaskCollection.addMask({id:_.uniqueId("mask_"),left:a-20,top:d-20,order:Ntxtmp.Singleton.MaskCollection.size()+1,active:true});b.set("activeMask",true);Ntxtmp.Singleton.MaskView.setDragableResizable(".maskContainer");break}else{Ntxtmp.Singleton.HeaderModel.set("activeTool",null)}}},clickPage:function(b){var a=b.pageX-$("#pageView").offset().left,d=b.pageY-$("#pageView").offset().top;switch(Ntxtmp.Singleton.HeaderModel.get("activeTool")){case"note":var c=_.uniqueId("note_");while(Ntxtmp.Singleton.NoteCollection.getById(c)){c=_.uniqueId("note_")}Ntxtmp.Singleton.NoteCollection.addNote({id:c,book:Ntxtmp.Singleton.RouterModel.get("book"),page:Ntxtmp.Singleton.RouterModel.get("page"),text:"",top:d,left:a,order:0,state:"expanded"});Ntxtmp.Singleton.HeaderModel.set("activeTool",null);Ntxtmp.Singleton.NoteView.setDragableResizable(".noteContainer");break;case"attachment":$("#attachment-upload").data("left",a).data("top",d).trigger("click");Ntxtmp.Singleton.HeaderModel.set("activeTool",null);break;case"mask":break}},changeZoomLevel:function(){var d=NetexUtils.isLandscape?890:630,b=d*1.65,c=this,a=".resources-tab";if(this.$(".draggable-image-wrap").length>0){if(Ntxtmp.Singleton.HeaderModel.get("zoomLevel")===1){Ntxtmp.Singleton.HeaderModel.set({activeTool:null,activePopup:null,activeSubmenu:null});this.$(a).fadeOut(400);this.$(".content-image , canvas ").animate({width:b},400,"easeInOutQuint",function(){c.$(".draggable-image-wrap").draggable({disabled:false,stop:c.onZoomDragStop})});this.$(".draggable-image-wrap").animate({height:this.$(".content-image , canvas ").height()},400,"easeInOutQuint");this.$(".content-image-wrap").animate({width:"100%"},400,"easeInOutQuint")}else{this.$(".content-image , canvas ").animate({width:d},400,"easeInOutQuint",function(){c.$(".draggable-image-wrap").draggable("disable");c.$(".draggable-image-wrap").removeClass("ui-draggable ui-draggable-handle ui-draggable-disabled");c.$(a).fadeIn(400)});this.$(".draggable-image-wrap").animate({top:0,left:0},400,"easeInOutQuint");this.$(".content-image-wrap").animate({width:c.$(".content-image-wrap").data("original-width")+"px"},400,"easeInOutQuint")}}},onZoomDragStop:function(){var k=$(".draggable-image-wrap"),g=k.position().top,c=k.position().left,a=k.position().top+k.find("img").height(),i=k.position().left+k.find("img").width();var e=$(".image-wrap"),d=e.offset().top,b=e.offset().left,f=e.height(),h=e.width();var j={top:"auto",left:"auto",bottom:"auto",right:"auto"};if(g>0){j.top=0}if(c>0){j.left=0}if(a<f){j.top=f-k.find("img").height()}if(i<h){j.left=h-k.find("img").width()}k.animate(j)},changeActiveTool:function(){if(Ntxtmp.Singleton.DrawToolbarModel.get("activeTool")!=="pointer"){this.$el.attr("touch-action","none")}else{this.$el.attr("touch-action","scroll")}},changeHeaderActiveTool:function(){switch(Ntxtmp.Singleton.HeaderModel.get("activeTool")){case"mask":case"note":case"attachment":this.$el.attr("touch-action","none");this.$el.addClass("cursorCrosshair");break;default:this.$el.attr("touch-action","scroll");this.$el.removeClass("cursorCrosshair");break}}});
Ntxtmp.View.PopupView=Backbone.View.extend({events:{"click .close-popup":"clickClosePopup","click #prev-flashcard.active.enabled":"prevFlashcard","click #next-flashcard.active.enabled":"nextFlashcard","click .flashcard-thumb":"clickFlashcardThumb","click .page-thumb":"clickPageThumb","click .video-thumb":"clickVideoThumb","click .video #toggle-transcript":"clickToggleVideoTranscript","click .audio-title":"clickAudioTitle","click .audio.active #toggle-transcript":"clickToggleAudioTranscript","touchstart #transcript-highlight":"highlightText","mousedown #transcript-highlight":"highlightText","click #add-link-button":"clickAddLinkButton","click .remove-link":"clickRemoveLink"},initialize:function(){this.listenTo(Ntxtmp.Singleton.HeaderModel,"change:activePopup",this.render);this.listenTo(Ntxtmp.Singleton.LinkCollection,"add",this.addNewLink);this.listenTo(Ntxtmp.Singleton.RouterModel,"change",this.changePage)},render:function(){var b=this.model.getActivePopup();var a=this;if(b){this.showPopup()}else{this.hidePopup()}return this},showPopup:function(){Ntxtmp.Singleton.HeaderModel.set("disabled",true);var b=this.model.getActivePopup();this.$el.css({top:"-900px"});this.$el.html(b.get("html"));this.$el.addClass("active");var a=this;this.$el.css("max-height",$("#page-wrap").height()-76);switch(Ntxtmp.Singleton.HeaderModel.get("activePopup")){case"pupil-popup":case"activity-popup":Ntxtmp.Singleton.BookmarkCollection.each(function(c){a.$('.page-thumb[data-page-id="'+c.get("pageId")+'"]').addClass("bookmark")});this.changePage();break;case"flashcard-popup":if(a.$(".carousel-content").find("li").length>6){a.$(".nav-next").addClass("active")}break;case"video-popup":this.$(".video-thumb").first().trigger("click");break;case"bookmark-list-popup":Ntxtmp.Singleton.BookmarkView.setElement("#bookmark-list");Ntxtmp.Singleton.BookmarkView.render();break;case"link-popup":Ntxtmp.Singleton.LinkCollection.each(function(d){var c=$('<li><span class="sprite remove-link" data-link-id="'+d.id+'"></span><a href="http://'+d.attributes.url+'" target="_blank">'+d.attributes.text+"</li>");a.$("#list-link").append($(c))});break;case"resource-popup":this.$(".resource-popup > ul").css("height",this.$(".resource-popup").height()-50);break}this.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){});this.$el.animate({top:"76px"},1000,"easeInOutQuint",function(){Ntxtmp.Singleton.HeaderModel.set("disabled",false)})},hidePopup:function(){Ntxtmp.Singleton.HeaderModel.set("disabled",true);var a=this;this.$el.animate({top:"-900px"},500,"easeInOutQuint",function(){a.$el.removeClass("active");a.$el.empty();Ntxtmp.Singleton.HeaderModel.set("disabled",false)})},clickClosePopup:function(){Ntxtmp.Singleton.HeaderModel.set("activePopup",null)},prevFlashcard:function(f){$(f.currentTarget).removeClass("enabled");var c=this.$(".carousel-content").css("margin-left").replace("px",""),b=102;this.$(".carousel-content").animate({"margin-left":parseInt(c)+b+"px"},400,"easeInOutQuint",function(){$(f.currentTarget).addClass("enabled")});$("#next-flashcard").addClass("active");var d=this.$(".carousel-content").css("width"),a=d.substr(0,d.indexOf("px"));if(a==720){$(f.currentTarget).removeClass("active")}},nextFlashcard:function(h){$(h.currentTarget).removeClass("enabled");var f=this.$(".carousel-content").css("margin-left").replace("px",""),c=102;this.$(".carousel-content").animate({"margin-left":parseInt(f)-c+"px"},400,"easeInOutQuint",function(){$(h.currentTarget).addClass("enabled")});$("#prev-flashcard").addClass("active");var a=this.$(".carousel-content").find("li").length,d=c*a,g=this.$(".carousel-content").css("width"),b=g.substr(0,g.indexOf("px"));if(b>d){$(h.currentTarget).removeClass("active")}},clickFlashcardThumb:function(b){var a=$($(b.currentTarget).find("img"));this.$(".flashcard-thumb img").removeClass("current");a.addClass("current");Ntxtmp.Singleton.FlashcardModel.set({title:a.data("title"),imageSrc:a.data("rel-fullscreen")});Ntxtmp.Singleton.ContainerModel.set({activeContainer:true,contentType:"flashcard"})},clickPageThumb:function(b){var a=$(b.currentTarget);Ntxtmp.Singleton.HeaderModel.set("activePopup",null);Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+a.data("book")+"/pag/"+a.data("page-id"))},clickVideoThumb:function(b){this.removeAllHighlights();var a=$(b.currentTarget);this.$("#video-player-placeholder").html($("#"+a.data("id")).text());if(this.$(".transcript").length>0){this.$("#transcript-buttons").removeClass("hidden")}else{this.$("#transcript-buttons").addClass("hidden")}this.$("#toggle-transcript").html("Show transcript").removeClass("hidden");this.$("#transcript-highlight").addClass("hidden");this.$("#transcript-wrap").empty().addClass("hidden");this.$(".netex-video-player").videoNetex({mode:"html"})},clickAudioTitle:function(b){this.removeAllHighlights();var a=$(b.currentTarget);this.$(".audio-title").removeClass("current");a.addClass("current");this.$("#audio-player-wrap").html($("#"+a.data("id")).text());this.$("#transcript-buttons").removeClass("hidden");this.$("#toggle-transcript").html("Show transcript").removeClass("hidden");this.$("#transcript-highlight").addClass("hidden");this.$("#transcript-wrap").empty().addClass("hidden");if(this.$(".transcript").length===0){this.$("#transcript-buttons").removeClass("active")}else{this.$("#transcript-buttons").addClass("active")}this.$(".netex-audio-player").audioNetex({mode:"html"})},clickToggleVideoTranscript:function(){if(this.$("#transcript-wrap").hasClass("hidden")){this.$("#transcript-wrap").removeClass("hidden");if(this.$("#transcript-wrap").html()===""){this.$("#transcript-wrap").html(this.$(".transcript").html())}this.$("#transcript-highlight").removeClass("hidden");this.$("#toggle-transcript").html("Hide transcript");this.$("#transcript-wrap").scrollTop(0)}else{this.$("#transcript-wrap").addClass("hidden");this.$("#transcript-highlight").addClass("hidden");this.$("#toggle-transcript").html("Show transcript")}},clickToggleAudioTranscript:function(){console.log("audio");if(this.$("#transcript-wrap").hasClass("hidden")){this.$("#transcript-wrap").removeClass("hidden");if(this.$("#transcript-wrap").html()===""){this.$("#transcript-wrap").html(this.$(".transcript").html())}this.$("#transcript-highlight").removeClass("hidden");this.$("#toggle-transcript").html("Hide transcript");this.$("#transcript-wrap").scrollTop(0)}else{this.$("#transcript-wrap").addClass("hidden");this.$("#transcript-highlight").addClass("hidden");this.$("#toggle-transcript").html("Show transcript")}},highlightText:function(a){a.preventDefault();if(!this.highlighter){this.highlighter=rangy.createHighlighter();this.highlighter.addClassApplier(rangy.createCssClassApplier("highlighted"))}this.highlighter.highlightSelection("highlighted",null,$("#transcript-wrap").attr("id"))},removeAllHighlights:function(){if(this.highlighter){this.highlighter.removeAllHighlights()}},clickAddLinkButton:function(){Ntxtmp.Singleton.DialogModel.set("html",$("#new-link-dialog-template").text())},addNewLink:function(){var b=Ntxtmp.Singleton.LinkCollection.at(Ntxtmp.Singleton.LinkCollection.size()-1);var a=$('<li><span data-link-id="'+b.id+'" class="sprite remove-link"></span><a href="http://'+b.attributes.url+'" target="_blank">'+b.attributes.text+"</li>");this.$("#list-link").append($(a))},clickRemoveLink:function(b){var a=$(b.currentTarget).data("link-id");$('li span[data-link-id="'+a+'"]').parent().remove();Ntxtmp.Singleton.LinkCollection.findWhere({id:a}).destroy()},changePage:function(g){var d=Ntxtmp.Singleton.RouterModel.get("page");if(Ntxtmp.Singleton.HeaderModel.get("activePopup")==="pupil-popup"){var a=parseInt(Ntxtmp.Singleton.PageCollection.getCurrentModel().get("position")),f=Ntxtmp.Singleton.PageCollection.countPageByBook("pupil"),b=a,c=6;if(Ntxtmp.Singleton.RouterModel.get("book")==="pupil"){this.$(".page-thumb").removeClass("current");this.$('.page-thumb[data-page-id="'+d+'"]').addClass("current");if(b<=5){b=0}if(b>f-c){b=f-c}if(f<=c){b=0}Ntxtmp.Singleton.CarrouselModel.set({itemCount:f,selectedItem:a,position:b,maxItems:c})}else{Ntxtmp.Singleton.CarrouselModel.set({itemCount:f,selectedItem:0,position:0,maxItems:c})}}else{if(Ntxtmp.Singleton.HeaderModel.get("activePopup")==="activity-popup"){var a=parseInt(Ntxtmp.Singleton.PageCollection.getCurrentModel().get("position")),f=Ntxtmp.Singleton.PageCollection.countPageByBook("activity"),b=a,c=6;if(Ntxtmp.Singleton.RouterModel.get("book")==="activity"){this.$(".page-thumb").removeClass("current");this.$('.page-thumb[data-page-id="'+d+'"]').addClass("current");if(b<=5){b=0}if(b>f-c){b=f-c}if(f<=c){b=0}Ntxtmp.Singleton.CarrouselModel.set({itemCount:f,selectedItem:a,position:b,maxItems:c})}else{Ntxtmp.Singleton.CarrouselModel.set({itemCount:f,selectedItem:0,position:0,maxItems:c})}}}}});
Ntxtmp.View.DialogView=Backbone.View.extend({events:{"click #new-link-button-accept":"clickNewLinkButtonAccept","keypress #link-address":"keypressLinkAddress","click #new-link-button-cancel":"closeDialog","click #delete-note-button-accept":"clickDeleteNoteButtonAccept","click #delete-note-button-cancel":"closeDialog","click #delete-attachment-button-cancel":"closeDialog","click #delete-attachment-button-accept":"clickDeleteAttachmentButtonAccept","click #generic-button-accept":"closeDialog"},initialize:function(){this.listenTo(this.model,"change:html",this.render)},render:function(){if(!this.model.get("html")){this.$el.addClass("hidden");this.$("#dialog-placeholder").empty()}else{var a=$(this.model.get("html"));if(this.model.get("customHtml")){a.find("#custom-html-placeholder").html(this.model.get("customHtml"))}this.$("#dialog-placeholder").html(a);this.$el.removeClass("hidden")}return this},clickNewLinkButtonAccept:function(){var b=$("#link-name").val(),a=$("#link-address").val();if(b.trim()!==""&&a.trim()!==""){Ntxtmp.Singleton.LinkCollection.addModel({id:_.uniqueId("link_"),text:$("#link-name").val(),url:$("#link-address").val()});this.model.set("html",null)}else{alert("Please, fill the fields in the form")}},keypressLinkAddress:function(b){var a=b.keyCode||b.which;if(a===13){this.clickNewLinkButtonAccept()}},clickDeleteNoteButtonAccept:function(){var a=this.$el.attr("data-item-id");$("#"+a).remove();Ntxtmp.Singleton.NoteCollection.removeNote(a);this.model.set("html",null)},clickDeleteAttachmentButtonAccept:function(){var a=this.$el.attr("data-item-id");$("#"+a).remove();Ntxtmp.Singleton.AttachmentCollection.removeAttachment(a);this.model.set("html",null)},closeDialog:function(){this.model.set({html:null,customHtml:null})}});
Ntxtmp.View.ContainerView=Backbone.View.extend({events:{"click .close-item-container":"closeItemContainer"},initialize:function(){this.listenTo(this.model,"change:activeContainer",this.activeContainer)},activeContainer:function(){if(this.model.get("activeContainer")===true){if(this.model.get("contentType")==="flashcard"){Ntxtmp.Singleton.FlashcardView.render()}$("#item-container").addClass("active")}else{$("#item-container").removeClass("active")}},closeItemContainer:function(){this.model.set("activeContainer",false)}});
Ntxtmp.View.CourseView=Backbone.View.extend({events:{"click .close-item-container":"closeItemContainer","click .close-activity":"clickCloseActivity","change #attachment-upload":"changeAttachmentUpload","click #audio-resource-player .audio.active #toggle-transcript":"clickToggleAudioTranscript","mousedown #audio-resource-player .close":"clickAudioResourcePlayerClose","touchstart #audio-resource-player #transcript-highlight":"highlightText","mousedown #audio-resource-player #transcript-highlight":"highlightText","click .pupil-popup .page-thumb":"trackClickPupilBook","click .activity-popup .page-thumb":"trackClickActivityBook","click .netex-video-button-play":"trackClickPlayVideo","click .audio-popup .netex-audio-button-play":"trackClickPlayAudioPopup","click #audio-resource-player .netex-audio-button-play":"trackClickPlayAudioResource","click .resource-popup .resource a":"trackClickResource","click .link-popup .link a":"trackClickLink","click .bookmark-list-popup li":"trackClickBookmark","click  .answer-key-link.active":"trackClickAnswerKeyOpen","click .activity-resource":"trackOpenActivity","mousedown .comprobarComponent.active":"trackCkeckActivity","touchstart .comprobarComponent.active":"trackCkeckActivity",pointerup:"pointerup",},initialize:function(){this.listenTo(Ntxtmp.Singleton.RouterModel,"change:page",this.trackPageView);this.listenTo(Ntxtmp.Singleton.RouterModel,"change:activeContainer",this.activeContainer);this.listenTo(Ntxtmp.Singleton.HeaderModel,"change:activePopup",this.trackActivePopup);this.listenTo(Ntxtmp.Singleton.HeaderModel,"change:activeTool",this.trackActiveTool);this.listenTo(Ntxtmp.Singleton.ContainerModel,"change:activeContainer",this.trackFlashcardOpen);this.listenTo(Ntxtmp.Singleton.LinkCollection,"add",this.trackLinkAdd);this.listenTo(Ntxtmp.Singleton.BookmarkCollection,"add",this.trackBookmarkAdd);this.listenTo(Ntxtmp.Singleton.NoteCollection,"add",this.trackNoteAdd);this.listenTo(Ntxtmp.Singleton.AttachmentCollection,"add",this.trackAttachmentAdd);this.listenTo(Ntxtmp.Singleton.MaskCollection,"add",this.trackMaskAdd);$("#pageView").attr("touch-action","scroll");$("#notepad-container").attr("touch-action","scroll")},activeContainer:function(){if(Ntxtmp.Singleton.RouterModel.get("activeContainer")===true){$("#item-container").addClass("active")}else{$("#item-container").removeClass("active")}},closeItemContainer:function(){Ntxtmp.Singleton.RouterModel.set("activeContainer",false)},clickCloseActivity:function(a){$("#activity-placeholder").empty();$("#activity-overlay").fadeOut(300);$("#pageView").css("height","auto")},changeAttachmentUpload:function(a){Ntxtmp.Singleton.DbModel.handleFileSelection(a)},clickToggleAudioTranscript:function(){if(this.$("#transcript-wrap").hasClass("hidden")){this.$("#transcript-wrap").removeClass("hidden");var a=$("#"+$("#audio-resource-player").attr("data-id")).find(".transcript").html();this.$("#transcript-wrap").html(a).removeClass("hidden");this.$("#transcript-highlight").removeClass("hidden");this.$("#toggle-transcript").html("Hide transcript");this.$("#transcript-wrap").scrollTop(0)}else{this.resetAudioResourcePlayerState()}},clickAudioResourcePlayerClose:function(){this.closeAudioResourcePlayer();this.removeAllHighlights()},resetAudioResourcePlayerState:function(){this.$("#audio-resource-player #transcript-wrap").addClass("hidden").empty();this.$("#audio-resource-player #transcript-highlight").addClass("hidden");this.$("#audio-resource-player #toggle-transcript").html("Show transcript")},closeAudioResourcePlayer:function(){this.$("#audio-resource-player").addClass("hidden");this.$("#audio-resource-player #audio-player-wrap").empty()},clickTranscriptHighlight:function(a){if(!this.highlighter){this.highlighter=rangy.createHighlighter();this.highlighter.addClassApplier(rangy.createCssClassApplier("highlighted"))}this.highlighter.highlightSelection("highlighted",null,$("#transcript-wrap").attr("id"))},highlightText:function(a){a.preventDefault();if(!this.highlighter){this.highlighter=rangy.createHighlighter();this.highlighter.addClassApplier(rangy.createCssClassApplier("highlighted"))}this.highlighter.highlightSelection("highlighted",null,$("#transcript-wrap").attr("id"))},removeAllHighlights:function(){this.highlighter.removeAllHighlights()},trackActivePopup:function(a){switch(Ntxtmp.Singleton.HeaderModel.get("activePopup")){case"pupil-popup":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","PUPIL_BOOK_GALLERY");break;case"activity-popup":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","ACTIVITY_BOOK_GALLERY");break;case"video-popup":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","VIDEO_GALLERY");break;case"audio-popup":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","AUDIO_GALLERY");break;case"flashcard-popup":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","FLASHCARD_GALLERY");break;case"resource-popup":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","RESOURCE_GALLERY");break;case"link-popup":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","LINK_GALLERY");break;case"bookmark-list-popup":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","BOOKMARK_GALLERY");break}},trackActiveTool:function(a){switch(Ntxtmp.Singleton.HeaderModel.get("activeTool")){case"notepad":Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MAIN_MENU","OPEN","NOTEPAD");break}},trackClickPupilBook:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("PUPIL_BOOK_GALLERY","CLICK")},trackClickActivityBook:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("ACTIVITY_BOOK_GALLERY","CLICK")},trackClickPlayVideo:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("VIDEO","PLAY")},trackClickPlayAudioPopup:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("AUDIO","PLAY")},trackClickPlayAudioResource:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("RESOURCE_AUDIO","PLAY")},trackFlashcardOpen:function(a){if(Ntxtmp.Singleton.ContainerModel.get("activeContainer")){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("FLASHCARD","CLICK")}},trackClickResource:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("RESOURCE_GALLERY","CLICK")},trackClickLink:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("LINK_GALLERY","CLICK")},trackLinkAdd:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("LINK_GALLERY","ADD")},trackClickBookmark:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("BOOKMARK_GALLERY","CLICK")},trackBookmarkAdd:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("BOOKMARK_GALLERY","ADD")},trackNoteAdd:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("NOTE","ADD")},trackAttachmentAdd:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("ATTACHMENT","ADD")},trackMaskAdd:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("MASK","ADD")},trackClickAnswerKeyOpen:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("ANSWER_KEY","OPEN",$(a.target).data("id"))},trackOpenActivity:function(b){var a=Ntxtmp.Singleton.ActivityCollection.getById($(b.currentTarget).attr("rel-activity"));Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("ACTIVITY","OPEN",a.get("type"))},trackCkeckActivity:function(b){if($(b.currentTarget).hasClass("active")){var a=$(b.currentTarget).closest(".itemTestLCComponent").data("type");Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("ACTIVITY","CHECK",a)}},trackPageView:function(a){Ntxtmp.Singleton.AnalyticsApiModel.trackEvent("page","view",Ntxtmp.Singleton.RouterModel.get("page"))},pointerup:function(a){Ntxtmp.Singleton.CanvasView.trigger("disablePaintCanvas")}});
Ntxtmp.View.HeaderView=Backbone.View.extend({events:{"click .enabled .pupil-book.active":"clickPupilBook","click .enabled .activity-book.active":"clickActivityBook","click .enabled .media.active":"clickMedia","click .enabled .resource-popup.active":"clickResourcePopup","click .enabled .link-popup.active":"clickLinkPopup","click .enabled .bookmark.active":"clickBookmark","click .enabled .note.active":"clickNote","click .enabled .mask.active":"clickMask","click .enabled .notepad.active":"clickNotepad","click .enabled .video-popup.active":"clickVideoPopup","click .enabled .audio-popup.active":"clickAudioPopup","click .enabled .flashcard-popup.active":"clickFlashcardPopup","click .enabled #sub-menu-bookmark .return.active":"clickBookmarkReturn","click .enabled #sub-menu-bookmark .add.active":"clickBookmarkAdd","click .enabled #sub-menu-bookmark .list-popup.active":"clickBookmarkListPopup","click .enabled #sub-menu-note .add-note.active":"clickAddNote","click .enabled #sub-menu-note .add-attachment.active":"clickAddAttachment","click .enabled #sub-menu-note .add-attachment":"clickAddAttachmentInactive","click  .zoom.zoom-in":"clickZoomIn","click  .zoom.zoom-out":"clickZoomOut","click  .answer-key-toggle":"clickAnswerKeyToggle","click  .answer-key-link.active":"clickAnswerKeyLinkActive"},initialize:function(){this.listenTo(this.model,"change:activeSubmenu",this.toggleSubmenu);this.listenTo(this.model,"change:activePopup",this.togglePopup);this.listenTo(this.model,"change:zoomLevel",this.changeZoomLevel);this.listenTo(this.model,"change:disabled",this.changeDisabled);this.listenTo(Ntxtmp.Singleton.BookmarkCollection,"add",this.togglePopup);this.listenTo(Ntxtmp.Singleton.BookmarkCollection,"remove",this.togglePopup);this.listenTo(Ntxtmp.Singleton.RouterModel,"change:page",this.updateTitleBar);this.model.set("titleActivityBook",this.$(".activity-book span").attr("title"));this.model.set("titlePupilBook",this.$(".pupil-book span").attr("title"));this.render()},render:function(){if(Ntxtmp.Singleton.PageCollection.countPageByBook("activity")>0){this.$(".activity-book").addClass("active")}$tmp=$(Ntxtmp.Singleton.PopupCollection.getById("video-popup").get("html"));if($tmp.find(".video-thumb").length>0){this.$(".video-popup").addClass("active")}$tmp=$(Ntxtmp.Singleton.PopupCollection.getById("audio-popup").get("html"));if($tmp.find(".audio-title").length>0){this.$(".audio-popup").addClass("active")}$tmp=$(Ntxtmp.Singleton.PopupCollection.getById("flashcard-popup").get("html"));if($tmp.find(".flashcard-thumb").length>0){this.$(".flashcard-popup").addClass("active")}if(this.$(".flashcard-popup").hasClass("active")||this.$(".audio-popup").hasClass("active")||this.$(".video-popup").hasClass("active")){this.$(".media").addClass("active")}$tmp=$(Ntxtmp.Singleton.PopupCollection.getById("resource-popup").get("html"));if($tmp.find(".resource").length>0){this.$(".resource-popup").addClass("active")}},clickPupilBook:function(){if(this.model.get("activePopup")==="pupil-popup"){this.model.set("activePopup",null)}else{this.model.set("activePopup","pupil-popup")}this.model.set("activeTool",null)},clickActivityBook:function(){if(this.model.get("activePopup")==="activity-popup"){this.model.set("activePopup",null)}else{this.model.set("activePopup","activity-popup")}this.model.set("activeTool",null)},clickResourcePopup:function(){if(this.model.get("activePopup")==="resource-popup"){this.model.set("activePopup",null)}else{this.model.set("activePopup","resource-popup")}this.model.set("activeTool",null)},clickLinkPopup:function(){if(this.model.get("activePopup")==="link-popup"){this.model.set("activePopup",null)}else{this.model.set("activePopup","link-popup")}this.model.set("activeTool",null)},clickMedia:function(){if(this.model.get("activeSubmenu")==="sub-menu-media"){this.model.set("activeSubmenu",null)}else{this.model.set("activeSubmenu","sub-menu-media")}this.model.set("activeTool",null)},clickBookmark:function(){if(this.model.get("activeSubmenu")==="sub-menu-bookmark"){this.model.set("activeSubmenu",null)}else{this.model.set("activeSubmenu","sub-menu-bookmark")}this.model.set("activeTool",null)},clickNote:function(){if(this.model.get("activeSubmenu")==="sub-menu-note"){this.model.set("activeSubmenu",null)}else{this.model.set("activeSubmenu","sub-menu-note")}this.model.set("activeTool",null)},clickMask:function(){this.model.set("activeTool","mask");this.model.set("activeSubmenu",null);this.model.set("activePopup",null)},clickNotepad:function(){if(this.model.get("activeTool")==="notepad"){this.model.set("activeTool",null)}else{this.model.set("activeTool","notepad");this.model.set("activeSubmenu",null);this.model.set("activePopup",null);this.hideAnswerKeyLinks();Ntxtmp.Singleton.AnswerKeyView.hide()}},toggleSubmenu:function(){var a=this.model.get("activeSubmenu");if(this.model.get("activeSubmenu")!==null){this.model.set("activePopup",null)}this.$(".sub-menu").removeClass("expanded");if(a){this.$("#"+a).addClass("expanded")}},togglePopup:function(){if(this.model.get("activePopup")!==null){this.model.set("activeSubmenu",null)}},clickVideoPopup:function(a){a.stopPropagation();this.model.set("activePopup","video-popup")},clickAudioPopup:function(a){a.stopPropagation();this.model.set("activePopup","audio-popup")},clickFlashcardPopup:function(a){a.stopPropagation();this.model.set("activePopup","flashcard-popup")},updateTitleBar:function(){var a=Ntxtmp.Singleton.RouterModel.get("book"),d=Ntxtmp.Singleton.RouterModel.get("page"),b="",c=null;this.$("#title-bar").removeClass().addClass(Ntxtmp.Singleton.RouterModel.get("book"));c=Ntxtmp.Singleton.AnswerKeyCollection.getModelByPageAndBook(d,a);_.each(c,function(e,f){b+='<li class=" answer-key-link '+(e.get("active")==="true"?"active":"")+" "+(e.get("number")==="&nbsp;"?"iconKey":"")+'"style=" color: '+e.get("color")+';"data-number="'+e.get("number")+'"data-id="'+e.get("id")+'" >'+e.get("number")+"</li>"});this.$("#answer-key-nav ul").html(b);if(c.length>0){this.$(".answer-key-toggle").addClass("active")}else{this.$(".answer-key-toggle").removeClass("active")}},clickBookmarkReturn:function(){var a=Ntxtmp.Singleton.BookmarkCollection.at(Ntxtmp.Singleton.BookmarkCollection.size()-1);if(a){Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+a.get("book")+"/pag/"+a.get("pageId"))}},clickBookmarkAdd:function(){var a=Ntxtmp.Singleton.RouterModel.get("book"),b=Ntxtmp.Singleton.RouterModel.get("page");if(!Ntxtmp.Singleton.BookmarkCollection.existPageId(b)){Ntxtmp.Singleton.BookmarkCollection.addBookmark({book:a,pageId:b,pageNumber:Ntxtmp.Singleton.PageCollection.getCurrentModel().get("pageNumber")})}},clickBookmarkListPopup:function(a){a.stopPropagation();this.model.set("activePopup","bookmark-list-popup")},clickAddNote:function(a){a.stopPropagation();this.model.set("activeTool","note")},clickAddAttachment:function(a){a.stopPropagation();if(!Ntxtmp.Singleton.DbModel.requiredFeaturesSupported($("#attachment-upload"))){Ntxtmp.Singleton.DialogModel.set({html:$("#attachment-not-supported-dialog-template").text()})}this.model.set("activeTool","attachment")},clickZoomIn:function(){this.model.set("zoomLevel",1)},clickZoomOut:function(){this.model.set("zoomLevel",0)},changeZoomLevel:function(){if(this.model.get("zoomLevel")===1){this.$(".zoom").removeClass("zoom-in").addClass("zoom-out");this.$(".zoom").attr("title","Zoom Out")}else{this.$(".zoom").removeClass("zoom-out").addClass("zoom-in");this.$(".zoom").attr("title","Zoom In")}},changeDisabled:function(){if(this.model.get("disabled")){this.$("#main-menu").removeClass("enabled").addClass("disabled")}else{this.$("#main-menu").removeClass("disabled").addClass("enabled")}},clickAnswerKeyToggle:function(){this.$("#answer-key-nav").toggleClass("active")},clickAnswerKeyLinkActive:function(a){this.$(".answer-key-link").removeClass("current");$(a.target).addClass("current");Ntxtmp.Singleton.AnswerKeyView.init($(a.target).data("number"),$(a.target).data("id"))},hideAnswerKeyLinks:function(){this.$("#answer-key-nav").removeClass("active");this.$(".answer-key-link").removeClass("current")},unselectAnswerKeyLinks:function(){this.$(".answer-key-link").removeClass("current")},desactiveAttachments:function(){this.$(".add-attachment").removeClass("active");this.$(".add-attachment span").attr("title","Attachments functionality not available in this configuration device")},clickAddAttachmentInactive:function(a){a.stopPropagation()}});
Ntxtmp.View.FlashcardView=Backbone.View.extend({events:{"click .flashcard-image":"clickImage","click .flashcard-title":"clickTitle"},template:_.template('<img class="flashcard-image" src="<%= imageSrc %>" /><div class="flashcard-title rotate90"><%= title %></div>'),initialize:function(){this.render()},clickImage:function(){if(Modernizr.csstransitions){this.$(".flashcard-image").addClass("rotate90");var a=this;setTimeout(function(){a.$(".flashcard-title").removeClass("rotate90")},300);this.$(".flashcard-image").addClass("rotate90")}else{this.$(".flashcard-image").fadeOut();this.$(".flashcard-title").fadeIn()}},clickTitle:function(){if(Modernizr.csstransitions){var a=this;setTimeout(function(){a.$(".flashcard-image").removeClass("rotate90")},300);this.$(".flashcard-title").addClass("rotate90")}else{this.$(".flashcard-title").fadeOut();this.$(".flashcard-image").fadeIn()}},render:function(){this.$el.html(this.template(this.model.attributes));return this},rotate:function(a,b){a.css({"-moz-transform":"rotateY("+b+"deg)","-webkit-transform":"rotateY("+b+"deg)","-o-transform":"rotateY("+b+"deg)","-ms-transform":"rotateY("+b+"deg)",transform:"rotateY("+b+"deg)"})}});
Ntxtmp.View.BookmarkView=Backbone.View.extend({events:{"click .delete-bookmark":"clickRemoveBookmark","click li":"clickNavigateBookmark"},template:_.template('<div class="bookmark-list-column"><h3><span class="sprite pupil-book-list"></span> <%= titlePupilBook %> </h3><ul id="pupil-bookmarks-placeholder"><% _.each(model.models, function(bookmark){ %><% if( bookmark.get("book") === "pupil"){ %><li data-book="<%= bookmark.get("book") %>" data-page-id="<%= bookmark.get("pageId") %>"><span class="sprite delete-bookmark"></span>Page <%= bookmark.get("pageNumber") %></li><% } %><% }); %></ul></div><div class="bookmark-list-column"><h3><span class="sprite activity-book-list"></span><%= titleActivityBook %></h3><ul id="activity-bookmarks-placeholder"><% _.each(model.models, function(bookmark){ %><% if( bookmark.get("book") === "activity"){ %><li data-book="<%= bookmark.get("book") %>" data-page-id="<%= bookmark.get("pageId") %>"><span class="sprite delete-bookmark"> </span>Page <%= bookmark.get("pageNumber") %></li><% } %><% }); %></ul></div>'),initialize:function(){this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"remove",this.render)},render:function(){this.$el.html(this.template({model:this.model,titlePupilBook:Ntxtmp.Singleton.HeaderModel.get("titlePupilBook"),titleActivityBook:Ntxtmp.Singleton.HeaderModel.get("titleActivityBook")}));return this},clickRemoveBookmark:function(b){b.stopPropagation();var a=$(b.currentTarget).parent().data("page-id");this.model.removeBookmark(a);return this},clickNavigateBookmark:function(b){var a=$(b.currentTarget);Ntxtmp.Singleton.HeaderModel.set("activePopup",null);Ntxtmp.Singleton.CourseRouter.navigate("#/book/"+a.data("book")+"/pag/"+a.data("page-id"));return this}});
Ntxtmp.View.NoteView=Backbone.View.extend({events:{"click .remove-note":"clickRemoveNote","click .update-note":"clickUpdateNote","click .toggle-note":"clickToggleNote",pointerdown:"pointerdown","keyup textarea":"keyupTextarea"},template:_.template("<div id='<%=attributes.id%>' class='noteContainer draggable-resizable <%=attributes.expanded ? 'expanded' : '' %> ' style='top:<%=attributes.top%>px;left:<%=attributes.left%>px; <%=attributes.expanded ? 'width:' + attributes.width + 'px;height:' + attributes.height + 'px;' : '' %>z-index:<%=20 - attributes.order%>;'><div class='note-header'><div class='sprite drag-note'></div><div class='sprite toggle-note'></div><div class='sprite remove-note'></div></div><div class='note-body'><textarea class='textareaNote' placeholder='Note...'><%= attributes.text%></textarea></div><div class='note-footer'><span class=' button button-small update-note'>Save</span></div></div>"),initialize:function(){this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"change:order",this.changeOrder);this.listenTo(this.model,"change:expanded",this.changeExpanded);this.listenTo(Ntxtmp.Singleton.PageCollection,"change:rendered",this.showNotes)},render:function(){this.$el.append(this.template(this.model.at(this.model.size()-1)));this.$(".noteContainer").trigger("resize");var b=this.model.at(this.model.size()-1);var a=this.$("#"+b.get("id"));if(b.get("left")>this.$el.width()-a.width()){a.animate({left:this.$el.width()-a.width()},400,function(){b.set("left",a.position().left);b.save()})}return this},clickRemoveNote:function(a){a.stopPropagation();Ntxtmp.Singleton.DialogView.$el.attr("data-item-id",$(a.target).closest(".noteContainer").attr("id"));Ntxtmp.Singleton.DialogModel.set("html",$("#delete-note-dialog-template").text())},clickUpdateNote:function(d){d.stopPropagation();var c=$(d.currentTarget).closest(".noteContainer").attr("id"),b=$("#"+c),a=$(b).find(".textareaNote").val();this.model.getById(c).set("text",a).save();this.$("#"+c+" .update-note").removeClass("unsaved-changes")},clickToggleNote:function(d){d.stopPropagation();var c=$(d.currentTarget).closest(".noteContainer").attr("id"),b=$("#"+c),a=$(b).find(".textareaNote").val();this.model.getById(c).set("expanded",!this.model.getById(c).get("expanded"))},showNotes:function(){var a=Ntxtmp.Singleton.RouterModel.get("book"),d=Ntxtmp.Singleton.RouterModel.get("page"),b=Ntxtmp.Singleton.NoteCollection.getModelByPageAndBook(d,a),c=this;if(b){_.each(b,function(f,e){c.$el.append(c.template(f))})}},setDragableResizable:function(a){this.$(a).draggable({stop:Ntxtmp.Singleton.NoteView.draggEnd,handle:".note-header",cancel:".toggle-note , .remove-note",containment:"#pageView"}).resizable({stop:Ntxtmp.Singleton.NoteView.resizeEnd,containment:"#pageView"})},resizeEnd:function(a,b){var c=Ntxtmp.Singleton.NoteCollection.getById($(a.target).attr("id"));c.set({width:b.size.width,height:b.size.height},{silent:true});c.save()},draggEnd:function(a,b){var c=Ntxtmp.Singleton.NoteCollection.getById($(a.target).attr("id"));c.set({top:b.position.top,left:b.position.left},{silent:true});c.save()},changeOrder:function(){this.model.each(function(a){this.$("#"+a.get("id")).css("z-index",20-a.get("order"))})},changeExpanded:function(){this.model.each(function(a){var b=$("#"+a.get("id"));if(a.get("expanded")){b.addClass("expanded");b.css({width:a.get("width")+"px",height:a.get("height")+"px",})}else{b.removeClass("expanded");b.css({width:"100px",height:"40px",})}a.save()})},pointerdown:function(f){var c=$(f.target).closest(".noteContainer").attr("id"),g=null,a=null,d=Ntxtmp.Singleton.RouterModel.get("page"),b=Ntxtmp.Singleton.RouterModel.get("book");g=Ntxtmp.Singleton.NoteCollection.getById(c);if(g){a=Ntxtmp.Singleton.NoteCollection.getPrecedingModelsByOrder(d,b,g.get("order"));_.each(a,function(e){e.set("order",e.get("order")+1);e.save()});g.set("order",0);g.save()}},keyupTextarea:function(b){var a=$(b.target).closest(".noteContainer").attr("id"),c=Ntxtmp.Singleton.NoteCollection.getById(a);if(this.$("#"+a+" textarea").val()!==c.get("text")){this.$("#"+a+" .update-note").addClass("unsaved-changes")}else{this.$("#"+a+" .update-note").removeClass("unsaved-changes")}}});
Ntxtmp.View.AttachmentView=Backbone.View.extend({events:{"click .open":"clickOpen","click .remove":"clickRemove"},template:_.template("<div id='<%=attributes.id%>' class='attachment-wrap' data-id='<%=attributes.id%>'  style='top:<%=attributes.top%>px;left:<%=attributes.left%>px;'><span class='sprite remove'></span><span class='sprite clip'></span><span class='sprite open'></span></div>"),initialize:function(){this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"delete",this.render);this.listenTo(Ntxtmp.Singleton.PageCollection,"change:rendered",this.showAttachments);this.listenTo(Ntxtmp.Singleton.DbModel,"change:attachmentData",this.onAttachmentReady)},render:function(){this.$el.append(this.template(this.model.at(this.model.size()-1)));$(".attachment-wrap").draggable({stop:Ntxtmp.Singleton.AttachmentView.draggEnd,handle:".clip",cancel:".remove",containment:"#pageView"});var a=this.model.at(this.model.size()-1);var b=this.$("#"+a.get("id"));if(a.get("left")>this.$el.width()-b.width()){b.animate({left:this.$el.width()-b.width()},400,function(){a.set("left",b.position().left);a.save()})}return this},showAttachments:function(){var b=Ntxtmp.Singleton.RouterModel.get("book"),d=Ntxtmp.Singleton.RouterModel.get("page"),a=Ntxtmp.Singleton.AttachmentCollection.getModelByPageAndBook(d,b),c=this;if(a){_.each(a,function(f,e){c.$el.append(c.template(f))})}$(".attachment-wrap").draggable({stop:Ntxtmp.Singleton.AttachmentView.draggEnd,handle:".clip",cancel:".remove",containment:"#pageView"})},draggEnd:function(b,c){var a=$(b.target).attr("id"),d=Ntxtmp.Singleton.AttachmentCollection.getById(a);d.set({top:c.position.top,left:c.position.left},{silent:true});d.save()},clickOpen:function(b){b.stopPropagation();var a=$($(b.currentTarget).closest(".attachment-wrap"));var c=this.model.getById(a.attr("id"));Ntxtmp.Singleton.DbModel.getAttachment(c.get("dbKey"))},onAttachmentReady:function(b){var a=Ntxtmp.Singleton.DbModel.get("attachmentData");if(a){window.open(a,"_blank");Ntxtmp.Singleton.DbModel.set({attachmentData:null},{trigger:false})}},clickRemove:function(c){c.stopPropagation();var a=$($(c.currentTarget).closest(".attachment-wrap")),b=a.attr("id");Ntxtmp.Singleton.DialogView.$el.attr("data-item-id",b);Ntxtmp.Singleton.DialogModel.set("html",$("#delete-attachment-dialog-template").text())}});
Ntxtmp.View.NotepadView=Backbone.View.extend({androidVersion:(function(){var b=b||navigator.userAgent;var a=b.match(/Android\s([0-9\.]*)/);return a?parseFloat(a[1],10):-1})(),events:{"click #notepad-nav-prev.active":"clickNavPrev","click #notepad-nav-next.active":"clickNavNext","click .close-popup":"clickClosePopup"},initialize:function(){this.listenTo(this.model,"change:currentCanvas",this.changeCurrentCanvas);this.listenTo(Ntxtmp.Singleton.HeaderModel,"change:activeTool",this.changeHeaderActiveTool);this.listenTo(Ntxtmp.Singleton.DrawToolbarModel,"change:activeTool",this.changeActiveTool);this.updateNavButtons()},clickNavPrev:function(){this.model.gotoPrev()},clickNavNext:function(){this.model.gotoNext()},changeCurrentCanvas:function(){this.$("canvas").removeClass("active");if(this.model.get("currentCanvas")){var a=this.$("#notepad-canvas-"+this.model.get("currentCanvas"));this.$el.addClass("active");a.attr("width",$("#notepad-container").width());a.attr("height",$("#notepad-container").height());a.addClass("active");this.$("#notepad-breadcrumb .current-page").html(this.model.get("currentCanvas"));this.updateNavButtons()}else{this.$el.removeClass("active")}},updateNavButtons:function(){if(this.model.hasPrev()){this.$("#notepad-nav-prev").addClass("active")}else{this.$("#notepad-nav-prev").removeClass("active")}if(this.model.hasNext()){this.$("#notepad-nav-next").addClass("active")}else{this.$("#notepad-nav-next").removeClass("active")}},clickClosePopup:function(a){a.preventDefault();a.stopPropagation();Ntxtmp.Singleton.HeaderModel.set("activeTool",null);this.model.set("currentCanvas",null)},changeActiveTool:function(){if(Ntxtmp.Singleton.DrawToolbarModel.get("activeTool")!=="pointer"){this.$el.attr("touch-action","none")}else{this.$el.attr("touch-action","scroll")}},changeHeaderActiveTool:function(){if(Ntxtmp.Singleton.HeaderModel.get("activeTool")==="notepad"){this.model.set("currentCanvas",1)}else{this.model.set("currentCanvas",null)}},});
Ntxtmp.View.MaskView=Backbone.View.extend({events:{"click .close-mask":"clickRemoveMask",pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",pointerleave:"pointerleave"},template:_.template("<div id='<%=attributes.id%>' class='maskContainer draggable-resizable new' style='top:<%=attributes.top%>px;left:<%=attributes.left%>px;width:<%=attributes.width%>px;height:<%=attributes.height%>px;'><div class='sprite close-mask'></div></div>"),initialize:function(){this.listenTo(this.model,"add",this.render);this.listenTo(this.model,"change",this.updateMask);this.listenTo(this.model,"change:order",this.changeOrder)},render:function(){this.$el.append(this.template(this.model.at(this.model.size()-1)));return this},pointerdown:function(d){var a=$(d.target).closest(".maskContainer").attr("id"),c=null,b=null;c=Ntxtmp.Singleton.MaskCollection.getById(a);if(c){b=Ntxtmp.Singleton.MaskCollection.getPrecedingModelsByOrder(c.get("order"));_.each(b,function(e){e.set("order",e.get("order")+1)});c.set("order",0)}},pointermove:function(d){var b=Ntxtmp.Singleton.PageCollection.getCurrentModel();if(b.get("activeMask")===true){d.preventDefault();var a=d.pageX-$("#pageView").offset().left,f=d.pageY-$("#pageView").offset().top,c=Ntxtmp.Singleton.MaskCollection.getCurrentModel();if(c){c.set("width",a-c.get("left")+20);c.set("height",f-c.get("top")+20)}}},pointerup:function(c){var f=Ntxtmp.Singleton.PageCollection.getCurrentModel();if(f.get("activeMask")===true){c.preventDefault();var a=c.pageX-$("#pageView").offset().left,d=c.pageY-$("#pageView").offset().top,b=Ntxtmp.Singleton.MaskCollection.getCurrentModel();if(b){Ntxtmp.Singleton.MaskCollection.each(function(e){if(e.get("active")===true){e.set("active",false)}});f.set("activeMask",false);$("#"+b.get("id")).draggable({cancel:".close-mask"}).resizable();Ntxtmp.Singleton.HeaderModel.set("activeTool",null)}$(".maskContainer").removeClass("new")}},updateMask:function(c){var b=this.model.getCurrentModel(),a=null;if(b){a=b.get("id");$("#"+a).css({width:b.get("width"),height:b.get("height")})}},clickRemoveMask:function(b){b.stopPropagation();var c=$(b.target).closest(".maskContainer").attr("id"),a=null;a=this.model.getById(c);if(a){this.model.remove(a);$(b.target).closest(".maskContainer").remove()}},changeOrder:function(){this.model.each(function(a){this.$("#"+a.get("id")).css("z-index",90-a.get("order"))})},setDragableResizable:function(a){this.$(a).draggable({stop:Ntxtmp.Singleton.MaskView.draggEnd,cancel:".close-mask",containment:"#pageView"}).resizable({stop:Ntxtmp.Singleton.MaskView.resizeEnd,containment:"#pageView"})},resizeEnd:function(a,b){},draggEnd:function(a,b){},pointerleave:function(a){if(Ntxtmp.Singleton.HeaderModel.get("activeTool")==="mask"){this.pointerup(a)}}});
Ntxtmp.View.AnswerKeyView=Backbone.View.extend({events:{"click .close":"clickClose","click .toggle":"clickToggle","click #show-all-keys.active":"clickShowAllKeys","click #prev-key.active":"clickPrevKey","click #next-key.active":"clickNextKey"},initialize:function(){this.listenTo(this.model,"change:maximized",this.changeMaximized)},render:function(){return this},init:function(c,d){var a=Ntxtmp.Singleton.AnswerKeyCollection.getById(d),b=this;if(a){this.$el.attr("data-number",c).draggable({handle:".header",containment:"#pageView"}).resizable({containment:"#pageView",resize:function(){}});this.$(".body").html(a.get("html"));$(".answer-paragraph p").addClass("hidden");if($(".statement p").text()==""||$(".statement p").text()=="Lorem ipsum dolor"){$(".statement p").html(a.get("title")+" "+c)}this.updateFooterButtons();this.$el.height(this.$el.height()+1);this.$el.height(this.$el.height()-1);this.show()}},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden");this.reset()},reset:function(){this.$(".body").empty()},clickClose:function(a){a.stopPropagation();this.hide();Ntxtmp.Singleton.HeaderView.unselectAnswerKeyLinks()},clickToggle:function(a){a.stopPropagation();this.model.set("maximized",!this.model.get("maximized"))},clickShowAllKeys:function(){var a=this;if(this.$(".answer.hidden, .answer-paragraph p.hidden").length>0){this.$(".answer.hidden,.answer-paragraph p.hidden").fadeIn(function(){$(this).removeClass("hidden");a.updateFooterButtons()})}},clickPrevKey:function(){var a=this;if(this.$(".answer, .answer-paragraph p").not(".hidden").length>0){this.$(".answer, .answer-paragraph p").not(".hidden").last().fadeOut(function(){$(this).addClass("hidden");a.updateFooterButtons()})}},clickNextKey:function(){var a=this;if(this.$(".answer.hidden, .answer-paragraph p.hidden").length>0){this.$(".answer.hidden, .answer-paragraph p.hidden").first().fadeIn(function(){$(this).removeClass("hidden");a.updateFooterButtons();a.$(".body").animate({scrollTop:a.$(".body").prop("scrollHeight")},1000)})}},updateFooterButtons:function(){if(this.$(".answer.hidden, .answer-paragraph p.hidden").length===0){this.$("#next-key , #show-all-keys").removeClass("active")}else{this.$("#next-key , #show-all-keys").addClass("active")}if(this.$(".answer, .answer-paragraph p").not(".hidden").length===0){this.$("#prev-key").removeClass("active")}else{this.$("#prev-key").addClass("active")}},changeMaximized:function(){if(this.model.get("maximized")===true){this.model.set({top:this.$el.css("top").replace("px",""),left:this.$el.css("left").replace("px",""),width:this.$el.width(),height:this.$el.height(),});this.$el.animate({top:200,left:0,width:$("#pageView").width(),height:$("#pageView").height()-300});this.$el.addClass("max")}else{this.$el.animate({top:this.model.get("top"),left:this.model.get("left"),width:this.model.get("width"),height:this.model.get("height")});this.$el.removeClass("max")}}});
Ntxtmp.View.DrawToolbarView=Backbone.View.extend({events:{"click .toggle":"clickToggle","click .draw-tool":"clickDrawTool","click .submenu-item.pencil-stroke":"clickPencilStroke","click .submenu-item.marker-stroke":"clickMarkerStroke","click .submenu-item.clear-line":"clickClearLine","click .submenu-item.clear-all":"clickClearAll","click .submenu-item.color":"clickColor"},initialize:function(){this.listenTo(this.model,"change:expanded",this.toggleToolbar);this.listenTo(this.model,"change:activeSubmenu",this.changeActiveSubmenu);this.listenTo(this.model,"change:activeTool",this.changeActiveTool);this.listenTo(this.model,"change:color",this.changeColor);this.listenTo(Ntxtmp.Singleton.HeaderModel,"change:zoomLevel",this.changeZoomLevel);this.changeActiveTool();this.changeColor();this.$el.draggable({handle:".drag",containment:"#pageView",stop:this.onDragEnd})},render:function(){return this},clickToggle:function(){this.model.set("expanded",!this.model.get("expanded"))},clickDrawTool:function(b){var a=$(b.currentTarget).data("tool");switch(a){case"pointer":this.model.set("activeTool","pointer");break;case"pencil":case"marker":case"rubber":case"palette":if(this.model.get("activeSubmenu")===a){this.model.set("activeSubmenu",null)}else{this.model.set("activeSubmenu",a)}break}},clickColor:function(a){this.model.set("color",$(a.currentTarget).data("color"))},clickPencilStroke:function(a){a.stopPropagation();this.model.set({pencilStroke:$(a.currentTarget).data("size"),activeTool:"pencil",activeSubmenu:null})},clickMarkerStroke:function(a){a.stopPropagation();this.model.set({markerStroke:$(a.currentTarget).data("size"),activeTool:"marker",activeSubmenu:null})},clickClearLine:function(a){a.stopPropagation();this.model.set({activeTool:"rubber",activeSubmenu:null})},clickClearAll:function(a){Ntxtmp.Singleton.CanvasView.clearAndSave()},toggleToolbar:function(){if(this.model.get("expanded")){this.$el.addClass("expanded");this.fixRightOverflow()}else{this.$el.removeClass("expanded");this.model.set("activeSubmenu",null)}},changeActiveSubmenu:function(){this.$(".submenu").removeClass("active");if(this.model.get("activeSubmenu")){this.$(".submenu."+this.model.get("activeSubmenu")).addClass("active");this.fixTopOverflow()}},onDragEnd:function(){Ntxtmp.Singleton.DrawToolbarView.fixTopOverflow();Ntxtmp.Singleton.DrawToolbarView.fixRightOverflow()},fixTopOverflow:function(){if(this.$(".submenu.active").length>0){var b=this.$el.position().top+this.$(".submenu.active").position().top,a=$("#pageView").offset().top,c=b-a;if(c<0){this.$el.animate({top:this.$el.position().top-c})}}},fixRightOverflow:function(){var b=this.$el.position().left+this.$el.width(),a=$("#pageView").width(),c=a-b;if(b>a){this.$el.animate({left:this.$el.position().left+c})}},changeActiveTool:function(){this.$(".draw-tool").removeClass("active");if(this.model.get("activeTool")){this.$(".draw-tool."+this.model.get("activeTool")).addClass("active")}},changeColor:function(){if(this.model.get("color")==="#fff"){this.$(".draw-tool.palette").animate({"background-color":"rgba(0,0,0,0.35)"})}else{this.$(".draw-tool.palette").animate({"background-color":this.model.get("color")})}},changeZoomLevel:function(){if(Ntxtmp.Singleton.HeaderModel.get("zoomLevel")===1){this.$el.removeClass("active")}else{this.$el.addClass("active")}}});
Ntxtmp.View.CanvasView=Backbone.View.extend({ctx:null,events:{pointermove:"paint",pointerdown:"enablePaint",pointerup:"disablePaint"},initialize:function(){this.listenTo(Ntxtmp.Singleton.HeaderModel,"change:activeTool",this.changeActiveTool);this.listenTo(Ntxtmp.Singleton.NotepadModel,"change:currentCanvas",this.canvasInitialize);this.listenTo(this,"disablePaintCanvas",this.disablePaint)},clear:function(){this.ctx.clearRect(0,0,this.$el.width(),this.$el.height())},clearAndSave:function(){this.clear();this.model.getCurrentModel().set("strokes",[]);this.model.getCurrentModel().save()},changeActiveTool:function(){if(Ntxtmp.Singleton.HeaderModel.get("activeTool")==="notepad"){this.$el.addClass("active")}else{this.$el.removeClass("active")}},canvasInitialize:function(){var a=this.model.getCurrentModel();this.setElement("#"+a.get("id"));a.set({size:this.$el.width()});this.$el.attr("width",this.$el.width()).attr("height",this.$el.height());this.ctx=this.el.getContext("2d");this.ctx.lineJoin="round";this.redraw()},redraw:function(){var a=this.ctx,b=this.model.getCurrentModel(),c=Ntxtmp.Singleton.HeaderModel.get("zoomLevel")===0?b.get("size"):b.get("size");a.clearRect(0,0,$(window).width(),$(window).height());var d=this;_.each(this.model.getCurrentModel().get("strokes"),function(h){if(h.tool==="pencil"){a.beginPath();a.lineCap="round";a.lineWidth=(c*h.stroke)/1000;a.strokeStyle=h.color;a.moveTo(h.oldX*c,h.oldY*c);a.lineTo(h.newX*c,h.newY*c);a.stroke()}else{if(h.tool==="marker"){a.beginPath();a.lineCap="square";a.lineWidth=(c*h.stroke)/1000;a.strokeStyle=d.hexToRgba(h.color,0.2);a.moveTo(h.oldX*c,h.oldY*c);a.lineTo(h.newX*c,h.newY*c);a.stroke()}else{if(h.tool==="rubber"){var f=h.newX*c;var k=h.newY*c;var e=((c*h.stroke)/1000)*2;for(var g=0;g<Math.round(Math.PI*e);g++){var j=(g/Math.round(Math.PI*e))*360;d.ctx.clearRect(f,k,Math.sin(j*(Math.PI/180))*e,Math.cos(j*(Math.PI/180))*e)}}}}})},setOldPos:function(c){var b=c.originalEvent.clientY-this.$el.offset().top+(window.pageYOffset||document.documentElement.scrollTop);var a=c.originalEvent.clientX-this.$el.offset().left+(window.pageXOffset||document.documentElement.scrollLeft);this.model.getCurrentModel().set({oldX:a,oldY:b})},enablePaint:function(c){var b=Ntxtmp.Singleton.HeaderModel.get("activeTool");if((!b||b==="notepad")&&(Ntxtmp.Singleton.DrawToolbarModel.get("activeTool")==="pencil"||Ntxtmp.Singleton.DrawToolbarModel.get("activeTool")==="marker"||Ntxtmp.Singleton.DrawToolbarModel.get("activeTool")==="rubber")){c.preventDefault();c.stopPropagation();var a=this.model.getCurrentModel();if(NetexUtils.androidVersion!==-1&&c.originalEvent.pointerType==="mouse"){return}a.set("paintingEnabled",true);this.setOldPos(c);switch(Ntxtmp.Singleton.DrawToolbarModel.get("activeTool")){case"pencil":this.ctx.strokeStyle=Ntxtmp.Singleton.DrawToolbarModel.get("color");this.ctx.lineCap="round";break;case"marker":this.ctx.strokeStyle=this.hexToRgba(Ntxtmp.Singleton.DrawToolbarModel.get("color"),0.2);this.ctx.lineCap="square";break;case"rubber":break}this.ctx.lineWidth=(a.get("size")*Ntxtmp.Singleton.DrawToolbarModel.getStroke())/1000}},disablePaint:function(b){var a=this.model.getCurrentModel();if(a.get("paintingEnabled")===true){if(b){b.preventDefault();b.stopPropagation()}a.set("paintingEnabled",false);a.save()}},paint:function(d){if(Ntxtmp.Singleton.PageCollection.getCurrentModel().get("activeMask")!==true){d.preventDefault();d.stopPropagation();var a=this.model.getCurrentModel();if(NetexUtils.androidVersion!==-1&&d.originalEvent.pointerType==="mouse"){return}if(a.get("paintingEnabled")===true){var c=d.originalEvent.clientY-this.$el.offset().top+(window.pageYOffset||document.documentElement.scrollTop);var b=d.originalEvent.clientX-this.$el.offset().left+(window.pageXOffset||document.documentElement.scrollLeft);switch(Ntxtmp.Singleton.DrawToolbarModel.get("activeTool")){case"pencil":this.paintPencil(a,c,b,d);break;case"marker":this.paintMarker(a,c,b,d);break;case"rubber":this.paintRubber(a,c,b,d);break}}}},paintPencil:function(a,d,c,b){this.ctx.beginPath();this.ctx.moveTo(a.get("oldX"),a.get("oldY"));this.ctx.lineTo(c,d);this.ctx.stroke();strokes=_.clone(a.get("strokes"));strokes.push({tool:"pencil",oldX:a.get("oldX")/a.get("size"),oldY:a.get("oldY")/a.get("size"),newX:c/a.get("size"),newY:d/a.get("size"),color:Ntxtmp.Singleton.DrawToolbarModel.get("color"),stroke:Ntxtmp.Singleton.DrawToolbarModel.getStroke()});a.set("strokes",strokes);this.setOldPos(b)},paintMarker:function(a,d,c,b){this.ctx.beginPath();this.ctx.moveTo(a.get("oldX"),a.get("oldY"));this.ctx.lineTo(c,d);this.ctx.stroke();strokes=_.clone(a.get("strokes"));strokes.push({tool:"marker",oldX:a.get("oldX")/a.get("size"),oldY:a.get("oldY")/a.get("size"),newX:c/a.get("size"),newY:d/a.get("size"),color:Ntxtmp.Singleton.DrawToolbarModel.get("color"),stroke:Ntxtmp.Singleton.DrawToolbarModel.getStroke()});a.set("strokes",strokes);this.setOldPos(b)},paintRubber:function(f,k,a,h){var m=Ntxtmp.Singleton.DrawToolbarModel.getStroke(),c=(m/2)*2,l=a,j=k,g=m;for(var d=0;d<Math.round(Math.PI*g);d++){var b=(d/Math.round(Math.PI*g))*360;this.ctx.clearRect(l,j,Math.sin(b*(Math.PI/180))*g,Math.cos(b*(Math.PI/180))*g)}f.get("strokes").push({tool:"rubber",newX:a/f.get("size"),newY:k/f.get("size"),stroke:m})},hexToRgba:function(d,c){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;d=d.replace(b,function(f,i,h,e){return i+i+h+h+e+e});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);if(a){return"rgba("+parseInt(a[1],16)+","+parseInt(a[2],16)+","+parseInt(a[3],16)+","+c+")"}else{return null}}});
Ntxtmp.Router.CourseRouter=Backbone.Router.extend({routes:{"":"index","book/:book":"book","book/:book/pag/:pag":"page","*path":"defaultRoute"},index:function(){this.navigate("#/book/"+this.getDefaultBook())},book:function(b){var a;Ntxtmp.Singleton.RouterModel.set({book:b},{validate:true});if(Ntxtmp.Singleton.RouterModel.get("page")===null||Ntxtmp.Singleton.RouterModel.get("book")!==b){a=Ntxtmp.Singleton.PageCollection.getFirstPageOfBook(b);if(a!==null){this.navigate("#/book/"+a.get("book")+"/pag/"+a.get("pageId"))}}},page:function(a,b){Ntxtmp.Singleton.RouterModel.set({book:a,page:b},{validate:true})},defaultRoute:function(a){this.navigate("#/book/"+this.getDefaultBook())},getDefaultBook:function(){return"pupil"}});
var NetexVideoBridge={fireEvent:function(c,b,a){$("[data-video-player-id='"+c+"']").trigger(b,a)}};var userAgent=window.navigator.userAgent.toLowerCase();(function(e){e.fn.videoNetex=function(o){var q=e.extend({},e.fn.videoNetex.defaults,o),r,p;return this.filter(".netex-video-player").each(function(){if(h.isTouch&&!h.isDesktop){e(this).addClass("touch")}n(j(e(this)),q);g(e(this),q,e(this).find(".netex-video-container"));var s=m(e(this),q);r=s.objApi;p=s.objApiListen;a(e(this),q,r,p);l(e(this),r,p);c(e(this))})};function m(s,p){var r,o;if(p.mode!=="html"){var q=e(s.find("source")[0]).attr("src");if(p.mode==="flash"){i(s,p,q);r=s.find("object");o=s}else{if(p.mode==="download"){}}}else{r=o=s.find("video")}return{objApi:r,objApiListen:o}}function i(r,p,q){var o=r.attr("data-video-player-id"),t=h.isIE?'classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"':"",s=r.attr("data-video-swf-url");r.find("video").after('<object id="'+o+'" name="'+o+'" '+t+' type="application/x-shockwave-flash" width="'+r.attr("data-width")+'" height="'+r.attr("data-height")+'" data="'+s+'"><param name="movie" value="'+s+'" /><param name="allowScriptAccess" value="always" /><param name="flashvars" value="file='+q+'" /><param name="wmode" value="transparent" /></object>');r.find("video").remove()}function j(o){return e.map(e(o).find("source"),function(r,q){var p=e.inArray(e(r).attr("type"),["video/ogg","video/mp4","video/webm"]);return p!==-1?["ogg","h264","webm"][p]:""})}function n(o,p){if(p.mode!=="download"){var q;q=(d!==false&&(e.inArray("probably",e.map(o,function(r){return d[r]}))!==-1)||e.inArray("maybe",e.map(o,function(r){return d[r]}))!==-1);if(p.mode==="html"){if(!q){p.mode=k!==false?"flash":"download"}}else{if(p.mode==="flash"&&!k){p.mode=q===true?"html":"download"}}}}function a(r,p,q,o){r.find(".netex-video-progress-bar").width("100%");o.on("play",function(s){r.find(".netex-video-poster").hide();r.find(".netex-video-button-play-pause-restart").removeClass("netex-video-button-play netex-video-button-restart").addClass("netex-video-button-pause")}).on("seeked",function(s){r.find(".netex-video-poster").hide();r.find(".netex-video-button-play-pause-restart").removeClass("netex-video-button-play netex-video-button-restart").addClass("netex-video-button-pause")}).on("pause",function(s){r.find(".netex-video-button-play-pause-restart").removeClass("netex-video-button-pause").addClass("netex-video-button-play")}).on("ended",function(s){r.find(".netex-video-poster").show();r.find(".netex-video-button-play-pause-restart").removeClass("netex-video-button-pause netex-video-button-play").addClass("netex-video-button-restart")}).on("timeupdate",function(w,u){var t=e(w.currentTarget)[0];if(u){t=u}if(h.isAndroid_40_41_42_43){var v=Math.floor((Math.random()*100)+1);r.find(".netex-video-subtitle-selector").css("z-index",v+1);r.find(".netex-video-subtitle-container").css("z-index",v)}var s=t.currentTime;p.formatDurationTime(r.find(".netex-video-time-current"),s);p.formatDurationTime(r.find(".netex-video-time-duration"),t.duration);r.find("video").each(function(){e.each(e(this)[0].textTracks||[],function(x,y){y.mode="hidden"})});r.find(".netex-video-subtitle-container:visible > div").each(function(x,y){e(y).removeClass("active").addClass(((s>=+e(y).attr("data-start"))&&(s<+e(y).attr("data-end")))?"active":"")});r.find(".netex-video-progress-bar-inner").width((s*100)/t.duration+"%");s=null}).on("durationchange",function(s){}).on("progress",function(t){var s=null;if(t.currentTarget&&t.currentTarget.buffered&&t.currentTarget.buffered.length>0&&t.currentTarget.buffered.end&&t.currentTarget.duration){s=t.currentTarget.buffered.end(0)/t.currentTarget.duration}else{if(t.currentTarget&&t.currentTarget.bytesTotal!==undefined&&t.currentTarget.bytesTotal>0&&t.currentTarget.bufferedBytes!==undefined){s=t.currentTarget.bufferedBytes/t.currentTarget.bytesTotal}else{if(t&&t.lengthComputable&&t.total!==0){s=t.loaded/t.total}}}if(s!==null){s=Math.min(1,Math.max(0,s))*100;r.find(".netex-video-progress-bar").width("100%")}}).on("volumechange",function(t,s){var u;if(s){u=s.volume}else{u=t.currentTarget.muted?0:t.currentTarget.volume}r.find(".netex-video-volume-button").removeClass("netex-video-volume-small netex-video-volume-medium netex-video-volume-large netex-video-volume-mute").addClass(u===0?"netex-video-volume-mute":"").addClass(u>0&&u<=0.2?"netex-video-volume-small":"").addClass(u>0.2&&u<=0.8?"netex-video-volume-medium":"").addClass(u>0.8?"netex-video-volume-large":"");r.find(".netex-video-volume-slider-foreground").width(u*100+"%")})}function l(q,p,o){q.find(".netex-video-button-play-pause-restart").off("click").on("click",function(r){if(e(this).hasClass("netex-video-button-play")){if(p[0].playMedia){p[0].playMedia()}else{p[0].play()}}if(e(this).hasClass("netex-video-button-pause")){if(p[0].pauseMedia){p[0].pauseMedia()}else{p[0].pause()}}if(e(this).hasClass("netex-video-button-restart")){if(p[0].playMedia){p[0].playMedia()}else{p[0].play()}}}).end().find(".netex-video-volume-button").off("click").on("click",function(r){if(!e(this).hasClass("netex-video-volume-mute")){if(p[0].setMute){p[0].setMute(true)}else{p[0].muted=true}}if(e(this).hasClass("netex-video-volume-mute")){if(p[0].setMute){p[0].setMute(false)}else{p[0].muted=false}}}).end().find(".netex-video-button-fullscreen").off("click").on("click",function(r){if(e(this).hasClass("netex-video-button-fullscreen-enter")){q.addClass("netex-video-player-fullscreen");e(this).attr("title","Fullscreen Off");e("html").addClass("video-player-fullscreen");e(this).removeClass("netex-video-button-fullscreen-enter").addClass("netex-video-button-fullscreen-exit");q.find(".netex-video-subtitle-container").css("bottom",37).css("right",0).css("left",0).css("position","absolute");q.find(".netex-video-subtitle-selector").css("bottom",37).css("right",0).css("left",0).css("position","absolute")}else{if(e(this).hasClass("netex-video-button-fullscreen-exit")){e(this).attr("title","Fullscreen On");q.removeClass("netex-video-player-fullscreen");e("html").removeClass("video-player-fullscreen");e(this).removeClass("netex-video-button-fullscreen-exit").addClass("netex-video-button-fullscreen-enter");q.find(".netex-video-subtitle-container").css("bottom",0).css("right",0).css("left",0).css("position","absolute");q.find(".netex-video-subtitle-selector").css("bottom",0).css("right",0).css("left",0).css("position","absolute")}}q.find(".netex-video-subtitle-selector").hide()}).end().find(".netex-video-progress-bar").off("click").on("click",function(r){var s=(r.pageX-e(r.currentTarget).parent().offset().left)/e(r.currentTarget).width();if(p[0].setCurrentTime){p[0].setCurrentTime(p[0].getDuration()*s);p[0].playMedia()}else{p[0].currentTime=p[0].duration*s;p[0].play()}}).end().find(".netex-video-volume-slider").off("click").on("click",function(r){var s=(r.pageX-e(r.currentTarget).parent().offset().left)/e(r.currentTarget).width();if(p[0].setVolume){p[0].setVolume(s)}else{p[0].volume=s}}).end().find(".netex-video-captions").off("click").on("click",function(r){q.find(".netex-video-subtitle-selector").toggle()}).end().find(".netex-video-subtitle-selector .netex-video-subtitle-option").click(function(r){q.find(".netex-video-subtitle-selector .netex-video-subtitle-option").removeClass("active");e(this).addClass("active");q.find(".netex-video-subtitle-selector").hide();q.find(".netex-video-subtitle-container").hide().filter("[lang="+e(r.currentTarget).attr("lang")+"]").show()})}function g(q,p,o){e("video").each(function(){e.each(e(this)[0].textTracks||[],function(r,s){s.mode="hidden"})});q.find("track").each(function(r,s){e.ajax({url:e(s).attr("src"),dataType:"text",lang:e(s).attr("srclang"),success:function(v){var u=new WebVTTParser().parse(v,"subtitles"),t=o.find(".netex-video-subtitle-container[lang='"+this.lang+"']");e.each(u.cues,function(x,w){t.append("<div data-start='"+w.startTime+"' data-end='"+w.endTime+"'>"+w.text+"</div>")});if(e(s).attr("default")===undefined){t.hide()}}})})}function c(o){if(o.find("track[default]").index()!=-1){o.find(".netex-video-subtitle-selector .netex-video-subtitle-option").removeClass("active");o.find(".netex-video-subtitle-selector .netex-video-subtitle-option:eq("+o.find("track[default]").index()+")").addClass("active")}}function f(){var t=b("ipad"),B=b("android"),r=B&&!b("mobile"),C=b("blackberry")||b("bb10")||b("rim"),w=C&&b("tablet"),A=b("windows"),s=A&&b("phone"),o=A&&(b("touch")&&!s),D=(b("(mobile;")||b("(tablet;"))&&b("; rv:"),p=D&&b("tablet"),y=t||r||w||o||p,x=B&&b("mobile"),v=b("iphone"),q=b("ipod"),E=C&&!y,z=D&&b("mobile"),F=b("meego"),u=x||v||q||s||E||z||F;return(!y&&!u)}function b(o){return userAgent.indexOf(o)!=-1}var d=(function(){var p=document.createElement("video"),o=false;try{if(o=!!p.canPlayType){o=new Boolean(o);o.ogg=p.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"");o.h264=p.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"");o.webm=p.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(q){}return o})();var k=(function(){var p=false;if(window.ActiveXObject){var u=null;try{u=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){return}if(u){p=new Boolean(true);p.version=u.GetVariable("$version").substring(4);p.version=p.version.split(",")[0]}}else{var s="Shockwave Flash";var v="application/x-shockwave-flash";var q=navigator.plugins[s];if(q===undefined){return undefined}else{p=new Boolean(true);var r=q.description;if(r&&!(typeof q.mimeTypes!="undefined"&&q.mimeTypes[v]&&!q.mimeTypes[v].enabledPlugin)){var o=r.replace(s,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".");p.version=parseInt(o[0].match(/\d+/),10)}}}return p})();var h=(function(){var o={};o.isIE=((/MSIE (\d+\.\d+);/.test(navigator.userAgent)===true)||(!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/))));o.isTouch=(function(){var p=false;if(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch){p=true}return p})();o.isAndroid_40_41_42_43=(function(){var p=false;var r=r||navigator.userAgent;var q=r.match(/Android\s([0-9\.]*)/);if(q&&parseFloat(q[1],10)<4.4){p=true}return p})();o.isDesktop=f();return o})();e.fn.videoNetex.defaults={formatDurationTime:function(r,p){var o,t,s,q;if(!e.isNumeric(p)){s="00";q="00"}else{o=Math.floor(Math.round(p)/60);t=Math.round(parseFloat(Math.round(p)-(o*60))*100)/100;s=o;if(o<10){s="0"+o}q=t;if(t<10){q="0"+t}}r.text(s+":"+q)},formatCurrentTime:function(t,p){var o,s,r,q;if(!e.isNumeric(p)){Min="00";q="00"}else{o=Math.floor(Math.round(p)/60);s=Math.round(parseFloat(Math.round(p)-(o*60))*100)/100;r=o;if(o<10){r="0"+o}q=s;if(s<10){q="0"+s}}t.text(r+":"+q)},success:function(o,p){},buttonFullScreen:true,buttonSettings:false,buttonComments:false,buttonDownload:false,buttonFavorite:false,showTime:true,mode:"html"}}(jQuery));var WebVTTParser=function(){this.parse=function(k,h){var n=/\r\n|\r|\n/,a=new Date(),j=0,o=k.split(n),i=false,g=[],l=[];function c(q,p){l.push({message:q,line:j+1,col:p})}if(o[j].length<6||o[j].indexOf("WEBVTT")!==0||o[j].length>6&&o[j][6]!=" "&&o[j][6]!="\t"){c('No valid signature. (File needs to start with "WEBVTT".)')}j++;while(o[j]!==""&&o[j]!==undefined){c("No blank line after the signature.");if(o[j].indexOf("-->")!=-1){i=true;break}j++}while(o[j]!==undefined){var e;while(!i&&o[j]===""){j++}if(!i&&o[j]===undefined){break}e={id:"",startTime:0,endTime:0,pauseOnExit:false,direction:"horizontal",snapToLines:true,linePosition:"auto",textPosition:50,size:100,alignment:"middle",text:"",tree:null};var b=true;if(o[j].indexOf("-->")===-1){e.id=o[j];if(/^NOTE($|[ \t])/.test(e.id)){j++;while(o[j]!==""&&o[j]!==undefined){if(o[j].indexOf("-->")!=-1){c("Cannot have timestamp in a comment.")}j++}continue}j++;if(o[j]===""||o[j]===undefined){c("Cue identifier cannot be standalone.");continue}if(o[j].indexOf("-->")==-1){b=false;c("Cue identifier needs to be followed by timestamp.")}}i=false;var d=new WebVTTCueTimingsAndSettingsParser(o[j],c);var f=0;if(g.length>0){f=g[g.length-1].startTime}if(b&&!d.parse(e,f)){e=null;j++;while(o[j]!==""&&o[j]!==undefined){if(o[j].indexOf("-->")!=-1){i=true;break}j++}continue}j++;while(o[j]!==""&&o[j]!==undefined){if(o[j].indexOf("-->")!=-1){c("Blank line missing before cue.");i=true;break}if(e.text!==""){e.text+="\n"}e.text+=o[j];j++}var m=new WebVTTCueTextParser(e.text,c,h);e.tree=m.parse(e.startTime,e.endTime);g.push(e)}g.sort(function(q,p){if(q.startTime<p.startTime){return -1}if(q.startTime>p.startTime){return 1}if(q.endTime>p.endTime){return -1}if(q.endTime<p.endTime){return 1}return 0});return{cues:g,errors:l,time:(new Date())-a}}};var WebVTTCueTimingsAndSettingsParser=function(k,c){var h=/[\u0020\t\f]/,a=/[^\u0020\t\f]/,k=k,g=0,b=function(l){c(l,g+1)},j=true;function i(l){while(k[g]!==undefined&&l.test(k[g])){g++}}function f(l){var m="";while(k[g]!==undefined&&l.test(k[g])){m+=k[g];g++}return m}function d(){var l="minutes",p,o,n,m;if(k[g]===undefined){b("No timestamp found.");return}if(!/\d/.test(k[g])){b("Timestamp must start with a character in the range 0-9.");return}p=f(/\d/);if(p.length>2||parseInt(p,10)>59){l="hours"}if(k[g]!=":"){b("No time unit separator found.");return}g++;o=f(/\d/);if(o.length!=2){b("Must be exactly two digits.");return}if(l=="hours"||k[g]==":"){if(k[g]!=":"){b("No seconds found or minutes is greater than 59.");return}g++;n=f(/\d/);if(n.length!=2){b("Must be exactly two digits.");return}}else{n=o;o=p;p="0"}if(k[g]!="."){b('No decimal separator (".") found.');return}g++;m=f(/\d/);if(m.length!=3){b("Milliseconds must be given in three digits.");return}if(parseInt(o,10)>59){b("You cannot have more than 59 minutes.");return}if(parseInt(n,10)>59){b("You cannot have more than 59 seconds.");return}return parseInt(p,10)*60*60+parseInt(o,10)*60+parseInt(n,10)+parseInt(m,10)/1000}function e(n,l){var r=n.split(h),m=[];for(var p=0;p<r.length;p++){if(r[p]===""){continue}var o=r[p].indexOf(":"),q=r[p].slice(0,o);value=r[p].slice(o+1);if(m.indexOf(q)!=-1){b("Duplicate setting.")}m.push(q);if(value===""){b("No value for setting defined.");return}if(q=="vertical"){if(value!="rl"&&value!="lr"){b("Writing direction can only be set to 'rl' or 'rl'.");continue}l.direction=value}else{if(q=="line"){if(!/\d/.test(value)){b("Line position takes a number or percentage.");continue}if(value.indexOf("-",1)!=-1){b("Line position can only have '-' at the start.");continue}if(value.indexOf("%")!=-1&&value.indexOf("%")!=value.length-1){b("Line position can only have '%' at the end.");continue}if(value[0]=="-"&&value[value.length-1]=="%"){b("Line position cannot be a negative percentage.");continue}if(value[value.length-1]=="%"){if(parseInt(value,10)>100){b("Line position cannot be >100%.");continue}l.snapToLines=false}l.linePosition=parseInt(value,10)}else{if(q=="position"){if(value[value.length-1]!="%"){b("Text position must be a percentage.");continue}if(parseInt(value,10)>100){b("Size cannot be >100%.");continue}l.textPosition=parseInt(value,10)}else{if(q=="size"){if(value[value.length-1]!="%"){b("Size must be a percentage.");continue}if(parseInt(value,10)>100){b("Size cannot be >100%.");continue}l.size=parseInt(value,10)}else{if(q=="align"){var s=["start","middle","end","left","right"];if(s.indexOf(value)==-1){b("Alignment can only be set to one of "+s.join(", ")+".");continue}l.alignment=value}else{b("Invalid setting.")}}}}}}}this.parse=function(l,m){i(h);l.startTime=d();if(l.startTime===undefined){return}if(l.startTime<m){b("Start timestamp is not greater than or equal to start timestamp of previous cue.")}if(a.test(k[g])){b("Timestamp not separated from '-->' by whitespace.")}i(h);if(k[g]!="-"){b("No valid timestamp separator found.");return}g++;if(k[g]!="-"){b("No valid timestamp separator found.");return}g++;if(k[g]!=">"){b("No valid timestamp separator found.");return}g++;if(a.test(k[g])){b("'-->' not separated from timestamp by whitespace.")}i(h);l.endTime=d();if(l.endTime===undefined){return}if(l.endTime<=l.startTime){b("End timestamp is not greater than start timestamp.")}if(a.test(k[g])){j=false}i(h);e(k.substring(g),l);return true};this.parseTimestamp=function(){var l=d();if(k[g]!==undefined){b("Timestamp must not have trailing characters.");return}return l}};var WebVTTCueTextParser=function(b,c,e){var b=b,f=0,d=function(g){if(e=="metadata"){return}c(g,f+1)};this.parse=function(o,h){var q={children:[]},n=q,p=[];function l(r){n.children.push({type:"object",name:r[1],classes:r[2],children:[],parent:n});n=n.children[n.children.length-1]}function j(r){var s=n;while(s){if(s.name==r){return true}s=s.parent}return}while(b[f]!==undefined){var i=a();if(i[0]=="text"){n.children.push({type:"text",value:i[1],parent:n})}else{if(i[0]=="start tag"){if(e=="chapters"){d("Start tags not allowed in chapter title text.")}var g=i[1];if(g!="v"&&g!="lang"&&i[3]!==""){d("Only <v> and <lang> can have an annotation.")}if(g=="c"||g=="i"||g=="b"||g=="u"||g=="ruby"){l(i)}else{if(g=="rt"&&n.name=="ruby"){l(i)}else{if(g=="v"){if(j("v")){d("<v> cannot be nested inside itself.")}l(i);n.value=i[3];if(!i[3]){d("<v> requires an annotation.")}}else{if(g=="lang"){l(i);n.value=i[3]}else{d("Incorrect start tag.")}}}}}else{if(i[0]=="end tag"){if(e=="chapters"){d("End tags not allowed in chapter title text.")}if(i[1]==n.name){n=n.parent}else{if(i[1]=="ruby"&&n.name=="rt"){n=n.parent.parent}else{d("Incorrect end tag.")}}}else{if(i[0]=="timestamp"){if(e=="chapters"){d("Timestamp not allowed in chapter title text.")}var k=new WebVTTCueTimingsAndSettingsParser(i[1],d),m=k.parseTimestamp();if(m!==undefined){if(m<=o||m>=h){d("Timestamp must be between start timestamp and end timestamp.")}if(p.length>0&&p[p.length-1]>=m){d("Timestamp must be greater than any previous timestamp.")}n.children.push({type:"timestamp",value:m,parent:n});p.push(m)}}}}}}while(n.parent){if(n.name!="v"){d("Required end tag missing.")}n=n.parent}return q};function a(){var j="data",g="",h="",i=[];while(b[f-1]!==undefined||f===0){var k=b[f];if(j=="data"){if(k=="&"){h=k;j="escape"}else{if(k=="<"&&g===""){j="tag"}else{if(k=="<"||k===undefined){return["text",g]}else{g+=k}}}}else{if(j=="escape"){if(k=="&"){d("Incorrect escape.");g+=h;h=k}else{if(/[abglmnsprt]/.test(k)){h+=k}else{if(k==";"){if(h=="&amp"){g+="&"}else{if(h=="&lt"){g+="<"}else{if(h=="&gt"){g+=">"}else{if(h=="&lrm"){g+="\u200e"}else{if(h=="&rlm"){g+="\u200f"}else{if(h=="&nbsp"){g+="\u00A0"}else{d("Incorrect escape.");g+=h+";"}}}}}}j="data"}else{if(k=="<"||k===undefined){d("Incorrect escape.");g+=h;return["text",g]}else{d("Incorrect escape.");g+=h+k;j="data"}}}}}else{if(j=="tag"){if(k=="\t"||k=="\n"||k=="\f"||k==" "){j="start tag annotation"}else{if(k=="."){j="start tag class"}else{if(k=="/"){j="end tag"}else{if(/\d/.test(k)){g=k;j="timestamp tag"}else{if(k==">"||k===undefined){if(k==">"){f++}return["start tag","",[],""]}else{g=k;j="start tag"}}}}}}else{if(j=="start tag"){if(k=="\t"||k=="\f"||k==" "){j="start tag annotation"}else{if(k=="\n"){h=k;j="start tag annotation"}else{if(k=="."){j="start tag class"}else{if(k==">"||k===undefined){if(k==">"){f++}return["start tag",g,[],""]}else{g+=k}}}}}else{if(j=="start tag class"){if(k=="\t"||k=="\f"||k==" "){i.push(h);h="";j="start tag annotation"}else{if(k=="\n"){i.push(h);h=k;j="start tag annotation"}else{if(k=="."){i.push(h);h=""}else{if(k==">"||k===undefined){if(k==">"){f++}i.push(h);return["start tag",g,i,""]}else{h+=k}}}}}else{if(j=="start tag annotation"){if(k==">"||k===undefined){if(k==">"){f++}h=h.split(/[\u0020\t\f\r\n]+/).filter(function(l){if(l){return true}}).join(" ");return["start tag",g,i,h]}else{h+=k}}else{if(j=="end tag"){if(k==">"||k===undefined){if(k==">"){f++}return["end tag",g]}else{g+=k}}else{if(j=="timestamp tag"){if(k==">"||k===undefined){if(k==">"){f++}return["timestamp",g]}else{g+=k}}else{d("Never happens.")}}}}}}}}f++}}};var WebVTTSerializer=function(){function b(d){var c="";for(var e=0;e<d.length;e++){var f=d[e];if(f.type=="text"){c+=f.value}else{if(f.type=="object"){c+="<"+f.name;if(f.classes){for(var g=0;g<f.classes.length;g++){c+="."+f.classes[g]}}if(f.value){c+=" "+f.value}c+=">";if(f.children){c+=b(f.children)}c+="</"+f.name+">"}else{c+="<"+f.value+">"}}}return c}function a(c){return c.startTime+" "+c.endTime+"\n"+b(c.tree.children)+"\n\n"}this.serialize=function(d){var c="";for(var e=0;e<d.length;e++){c+=a(d[e])}return c}};
var NetexAudioBridge={fireEvent:function(c,b,a){$("[data-audio-player-id='"+c+"']").trigger(b,a)}};(function(c){c.fn.audioNetex=function(k){var m=c.extend({},c.fn.audioNetex.defaults,k),n,l;return this.filter(".netex-audio-player").each(function(){if(d.isTouch){c(this).addClass("touch")}j(f(c(this)),m);var o=i(c(this),m);n=o.objApi;l=o.objApiListen;a(c(this),m,n,l);h(c(this),n,l)})};function i(o,l){var n,k;if(l.mode!=="html"){var m=c(o.find("source")[0]).attr("src");if(l.mode==="flash"){e(o,l,m);n=o.find("object");k=o}else{if(l.mode==="download"){}}}else{n=k=o.find("audio")}return{objApi:n,objApiListen:k}}function e(n,l,m){var k=n.attr("data-audio-player-id"),p=d.isIE?'classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"':"",o=n.attr("data-audio-swf-url");n.find("audio").after('<object  id="'+k+'" name="'+k+'" '+p+' type="application/x-shockwave-flash" width="1" height="1" data="'+o+'"><param name="movie" value="'+o+'" /><param name="allowScriptAccess" value="always" /><param name="flashvars" value="file='+m+'" /><param name="wmode" value="transparent" /></object>');n.find("audio").remove()}function f(k){return c.map(c(k).find("source"),function(n,m){var l=c.inArray(c(n).attr("type"),["audio/ogg","audio/mpeg","audio/wav"]);return l!==-1?["ogg","mp3","wav"][l]:""})}function j(k,l){if(l.mode!=="download"){var m;m=(b!==false&&(c.inArray("probably",c.map(k,function(n){return b[n]}))!==-1)||c.inArray("maybe",c.map(k,function(n){return b[n]}))!==-1);if(l.mode==="html"){if(!m){l.mode=g!==false?"flash":"download"}}else{if(l.mode==="flash"&&!g){l.mode=m===true?"html":"download"}}}}function a(n,l,m,k){n.find(".netex-audio-progress-bar").width("100%");k.on("play",function(o){n.find(".netex-audio-button-play-pause-restart").removeClass("netex-audio-button-play netex-audio-button-restart").addClass("netex-audio-button-pause")}).on("seeked",function(o){n.find(".netex-audio-button-play-pause-restart").removeClass("netex-audio-button-play netex-audio-button-restart").addClass("netex-audio-button-pause")}).on("pause",function(o){n.find(".netex-audio-button-play-pause-restart").removeClass("netex-audio-button-pause").addClass("netex-audio-button-play")}).on("ended",function(o){n.find(".netex-audio-button-play-pause-restart").removeClass("netex-audio-button-pause netex-audio-button-play").addClass("netex-audio-button-restart")}).on("timeupdate",function(r,q){var p=c(r.currentTarget)[0];if(q){p=q}var o=p.currentTime;l.formatDurationTime(n.find(".netex-audio-time-current"),o);l.formatDurationTime(n.find(".netex-audio-time-duration"),p.duration);n.find(".netex-audio-subtitle-container:visible > div").each(function(s,t){c(t).removeClass("active").addClass(((o>=+c(t).attr("data-start"))&&(o<+c(t).attr("data-end")))?"active":"")});n.find(".netex-audio-progress-bar-inner").width((o*100)/p.duration+"%");o=null}).on("durationchange",function(o){}).on("progress",function(p){var o=null;if(p.currentTarget&&p.currentTarget.buffered&&p.currentTarget.buffered.length>0&&p.currentTarget.buffered.end&&p.currentTarget.duration){o=p.currentTarget.buffered.end(0)/p.currentTarget.duration}else{if(p.currentTarget&&p.currentTarget.bytesTotal!==undefined&&p.currentTarget.bytesTotal>0&&p.currentTarget.bufferedBytes!==undefined){o=p.currentTarget.bufferedBytes/p.currentTarget.bytesTotal}else{if(p&&p.lengthComputable&&p.total!==0){o=p.loaded/p.total}}}if(o!==null){o=Math.min(1,Math.max(0,o))*100;n.find(".netex-audio-progress-bar").width("100%")}}).on("volumechange",function(p,o){var q;if(o){q=o.volume}else{q=p.currentTarget.muted?0:p.currentTarget.volume}n.find(".netex-audio-volume-button").removeClass("netex-audio-volume-small netex-audio-volume-medium netex-audio-volume-large netex-audio-volume-mute").addClass(q===0?"netex-audio-volume-mute":"").addClass(q>0&&q<=0.2?"netex-audio-volume-small":"").addClass(q>0.2&&q<=0.8?"netex-audio-volume-medium":"").addClass(q>0.8?"netex-audio-volume-large":"");n.find(".netex-audio-volume-slider-foreground").width(q*100+"%")}).end().find(".netex-audio-button-transcription").click(function(o){if(!c(this).hasClass("desactive")){c(".texto_TranscriptPrepare").toggle();c(this).toggleClass("expanded")}})}function h(m,l,k){m.find(".netex-audio-button-play-pause-restart").off("click").on("click",function(n){if(c(this).hasClass("netex-audio-button-play")){if(l[0].playMedia){l[0].playMedia()}else{l[0].play()}}if(c(this).hasClass("netex-audio-button-pause")){if(l[0].pauseMedia){l[0].pauseMedia()}else{l[0].pause()}}if(c(this).hasClass("netex-audio-button-restart")){if(l[0].playMedia){l[0].playMedia()}else{l[0].play()}}}).end().find(".netex-audio-volume-button").off("click").on("click",function(n){if(!c(this).hasClass("netex-audio-volume-mute")){if(l[0].setMute){l[0].setMute(true)}else{l[0].muted=true}}if(c(this).hasClass("netex-audio-volume-mute")){if(l[0].setMute){l[0].setMute(false)}else{l[0].muted=false}}}).end().find(".netex-audio-progress-bar").off("click").on("click",function(n){var o=(n.pageX-c(n.currentTarget).parent().offset().left)/c(n.currentTarget).width();if(l[0].setCurrentTime){l[0].setCurrentTime(l[0].getDuration()*o);l[0].playMedia()}else{if(isNaN(l[0].duration)){return}l[0].currentTime=l[0].duration*o;l[0].play()}}).end().find(".netex-audio-volume-slider").off("click").on("click",function(n){var o=(n.pageX-c(n.currentTarget).parent().offset().left)/c(n.currentTarget).width();if(l[0].setVolume){l[0].setVolume(o)}else{l[0].volume=o}})}var b=(function(){var l=document.createElement("audio"),k=false;try{if(k=!!l.canPlayType){k=new Boolean(k);k.ogg=l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");k.mp3=l.canPlayType("audio/mpeg;").replace(/^no$/,"");k.wav=l.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");k.m4a=(l.canPlayType("audio/x-m4a;")||l.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(m){}return k})();var g=(function(){var l=false;if(window.ActiveXObject){var q=null;try{q=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(p){return}if(q){l=new Boolean(true);l.version=q.GetVariable("$version").substring(4);l.version=l.version.split(",")[0]}}else{var o="Shockwave Flash";var r="application/x-shockwave-flash";var m=navigator.plugins[o];if(m===undefined){return undefined}else{l=new Boolean(true);var n=m.description;if(n&&!(typeof m.mimeTypes!="undefined"&&m.mimeTypes[r]&&!m.mimeTypes[r].enabledPlugin)){var k=n.replace(o,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".");l.version=parseInt(k[0].match(/\d+/),10)}}}return l})();var d=(function(){var k={};k.isIE=((/MSIE (\d+\.\d+);/.test(navigator.userAgent)===true)||(!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/))));k.isTouch=(function(){var l=false;if(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch){l=true}return l})();k.isAndroid_40_41_42_43=(function(){var l=false;var n=n||navigator.userAgent;var m=n.match(/Android\s([0-9\.]*)/);if(m&&parseFloat(m[1],10)<4.4){l=true}return l})();return k})();c.fn.audioNetex.defaults={formatDurationTime:function(n,l){var k,p,o,m;if(!c.isNumeric(l)){o="00";m="00"}else{k=Math.floor(Math.round(l)/60);p=Math.round(parseFloat(Math.round(l)-(k*60))*100)/100;o=k;if(k<10){o="0"+k}m=p;if(p<10){m="0"+p}}n.text(o+":"+m)},formatCurrentTime:function(p,l){var k,o,n,m;if(!c.isNumeric(l)){Min="00";m="00"}else{k=Math.floor(Math.round(l)/60);o=Math.round(parseFloat(Math.round(l)-(k*60))*100)/100;n=k;if(k<10){n="0"+k}m=o;if(o<10){m="0"+o}}p.text(n+":"+m)},success:function(k,l){},showTime:true,buttonVolume:true,mode:"html"}}(jQuery));
